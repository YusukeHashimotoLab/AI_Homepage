<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'ja' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}">

  <!-- CSS -->
  <link rel="stylesheet" href="{{ '/assets/css/article.css' | relative_url }}">

  <!-- Mermaid for diagrams -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      themeVariables: {
        fontSize: '16px'
      }
    });
  </script>

  <!-- MathJax for formulas -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
      },
      svg: {
        fontCache: 'global'
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- Syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script>hljs.highlightAll();</script>

  {% seo %}
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="article-header">
      <nav class="breadcrumb">
        <a href="{{ '/' | relative_url }}">Home</a> /
        <a href="{{ '/content/' | relative_url }}">Content</a> /
        <a href="{{ '/content/basics/' | relative_url }}">Basics</a> /
        <span>{{ page.title }}</span>
      </nav>

      <h1>{{ page.title }}</h1>

      {% if page.description %}
      <p class="lead">{{ page.description }}</p>
      {% endif %}

      <!-- Metadata -->
      <div class="article-meta">
        {% if page.level %}
        <span class="badge badge-{{ page.level }}">{{ page.level }}</span>
        {% endif %}

        {% if page.target_audience %}
        <span class="meta-item">対象: {{ page.target_audience }}</span>
        {% endif %}

        {% if page.word_count %}
        <span class="meta-item">📝 {{ page.word_count }}語</span>
        {% endif %}

        {% if page.exercises %}
        <span class="meta-item">✏️ 演習{{ page.exercises }}問</span>
        {% endif %}

        {% if page.updated_at %}
        <span class="meta-item">🕒 更新: {{ page.updated_at }}</span>
        {% endif %}

        {% if page.quality_score %}
        <span class="meta-item">⭐ 品質: {{ page.quality_score }}</span>
        {% endif %}
      </div>
    </header>

    <!-- Main Content -->
    <main class="article-content">
      {{ content }}
    </main>

    <!-- Footer -->
    <footer class="article-footer">
      <hr>

      {% if page.reviewed_by %}
      <div class="review-info">
        <h3>レビュー情報</h3>
        <p>このコンテンツは以下のエージェントによって検証されています:</p>
        <p>{{ page.reviewed_by }}</p>
      </div>
      {% endif %}

      <div class="publication-info">
        <p>
          🤖 Generated with <a href="https://claude.ai/code" target="_blank">Claude Code Subagents</a><br>
          📅 Created: {{ page.created_at | date: "%Y年%m月%d日" }}<br>
          📅 Updated: {{ page.updated_at | date: "%Y年%m月%d日" }}<br>
          📊 Phase: {{ page.phase | default: "N/A" }}<br>
          ⭐ Quality Score: {{ page.quality_score | default: "N/A" }}
        </p>
      </div>

      <nav class="page-nav">
        <a href="{{ '/content/basics/' | relative_url }}">&larr; 基礎コンテンツ一覧に戻る</a>
        <a href="{{ '/' | relative_url }}">ホームに戻る &rarr;</a>
      </nav>
    </footer>
  </div>

  <!-- Progress indicator script -->
  <script>
    // Add smooth scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    // Reading progress indicator
    window.addEventListener('scroll', () => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;

      let progressBar = document.getElementById('reading-progress');
      if (!progressBar) {
        progressBar = document.createElement('div');
        progressBar.id = 'reading-progress';
        progressBar.style.cssText = 'position: fixed; top: 0; left: 0; width: 0%; height: 3px; background: linear-gradient(to right, #4CAF50, #2196F3); z-index: 9999; transition: width 0.1s;';
        document.body.appendChild(progressBar);
      }
      progressBar.style.width = scrolled + '%';
    });
  </script>
</body>
</html>
