<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬2ç« ï¼šé…åˆ—è§£æã¨æ©Ÿæ¢°å­¦ç¿’ - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ç¬¬2ç« ï¼šé…åˆ—è§£æã¨æ©Ÿæ¢°å­¦ç¿’</h1>
            <p class="subtitle">ã‚¿ãƒ³ãƒ‘ã‚¯è³ªæ©Ÿèƒ½äºˆæ¸¬ã®å®Ÿè·µ</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 25-30åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: åˆç´šã€œä¸­ç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 9å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 3å•</span>
            </div>
        </div>
    </header>

    <main class="container">

<h1>ç¬¬2ç« ï¼šé…åˆ—è§£æã¨æ©Ÿæ¢°å­¦ç¿’</h1>

<strong>ã‚¿ãƒ³ãƒ‘ã‚¯è³ªæ©Ÿèƒ½äºˆæ¸¬ã®å®Ÿè·µ</strong>

<h2>å­¦ç¿’ç›®æ¨™</h2>

- âœ… BLASTæ¤œç´¢ã‚’å®Ÿè¡Œã—ã€ç›¸åŒã‚¿ãƒ³ãƒ‘ã‚¯è³ªã‚’ç™ºè¦‹ã§ãã‚‹
- âœ… ã‚¢ãƒŸãƒé…¸é…åˆ—ã‹ã‚‰ç‰©ç†åŒ–å­¦çš„ç‰¹å¾´é‡ã‚’æŠ½å‡ºã§ãã‚‹
- âœ… æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã§ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã®å±€åœ¨ãƒ»æ©Ÿèƒ½ã‚’äºˆæ¸¬ã§ãã‚‹
- âœ… Random Forestã€LightGBMã‚’ä½¿ã£ãŸé…µç´ æ´»æ€§äºˆæ¸¬ãŒã§ãã‚‹
- âœ… ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½è©•ä¾¡ã¨æ”¹å–„ãŒã§ãã‚‹

<strong>èª­äº†æ™‚é–“</strong>: 25-30åˆ† | <strong>ã‚³ãƒ¼ãƒ‰ä¾‹</strong>: 9å€‹ | <strong>æ¼”ç¿’å•é¡Œ</strong>: 3å•

---

<h2>2.1 é…åˆ—ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ</h2>

<h3>ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã¨ã¯</h3>

<strong>é…åˆ—ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ</strong>ã¯ã€2ã¤ä»¥ä¸Šã®é…åˆ—ã‚’ä¸¦ã¹ã¦é¡ä¼¼æ€§ã‚’è©•ä¾¡ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚

<div class="mermaid">graph LR
    A[ã‚¯ã‚¨ãƒªé…åˆ—] --> B[ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ<br/>ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ]
    C[ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹] --> B
    B --> D[ç›¸åŒé…åˆ—]
    D --> E[æ©Ÿèƒ½æ¨å®š]
    D --> F[é€²åŒ–è§£æ]

    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style D fill:#e8f5e9
    style E fill:#ffebee
    style F fill:#fff9c4</div>

<strong>ç”¨é€”</strong>:
- æ©Ÿèƒ½æœªçŸ¥ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã®æ©Ÿèƒ½æ¨å®š
- é€²åŒ–çš„é–¢ä¿‚ã®è§£æ
- é‡è¦ãªæ®‹åŸºã®åŒå®š

---

<h3>BLASTæ¤œç´¢</h3>

<strong>BLASTï¼ˆBasic Local Alignment Search Toolï¼‰</strong>ã¯ã€æœ€ã‚‚åºƒãä½¿ã‚ã‚Œã‚‹é…åˆ—é¡ä¼¼æ€§æ¤œç´¢ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

<strong>Example 1: Biopythonã‚’ä½¿ã£ãŸBLASTæ¤œç´¢</strong>

<pre><code class="language-python">from Bio.Blast import NCBIWWW, NCBIXML
from Bio import SeqIO

<h1>ã‚¯ã‚¨ãƒªé…åˆ—ï¼ˆä¾‹: ã‚¤ãƒ³ã‚¹ãƒªãƒ³ï¼‰</h1>
query_sequence = """
MALWMRLLPLLALLALWGPDPAAAFVNQHLCGSHLVEALYLVCGERGFFYTPKTRREAEDLQVGQVELGGGPGAGSLQPLALEGSLQKRGIVEQCCTSICSLYQLENYCN
"""

print("BLASTæ¤œç´¢ã‚’å®Ÿè¡Œä¸­...")

<h1>NCBIã®BLASTã‚µãƒ¼ãƒãƒ¼ã§æ¤œç´¢</h1>
result_handle = NCBIWWW.qblast(
    "blastp",  # ã‚¿ãƒ³ãƒ‘ã‚¯è³ªBLAST
    "nr",  # non-redundantãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    query_sequence,
    hitlist_size=10  # ä¸Šä½10ä»¶
)

<h1>çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜</h1>
with open("blast_results.xml", "w") as out_handle:
    out_handle.write(result_handle.read())

result_handle.close()

print("æ¤œç´¢å®Œäº†ã€‚çµæœã‚’è§£æä¸­...")

<h1>çµæœã‚’è§£æ</h1>
with open("blast_results.xml") as result_handle:
    blast_records = NCBIXML.parse(result_handle)

    for blast_record in blast_records:
        print(f"\n=== BLASTæ¤œç´¢çµæœ ===")
        print(f"ã‚¯ã‚¨ãƒªé•·: {blast_record.query_length} aa")
        print(f"ãƒ’ãƒƒãƒˆæ•°: {len(blast_record.alignments)}")

        # ä¸Šä½5ä»¶ã‚’è¡¨ç¤º
        for alignment in blast_record.alignments[:5]:
            for hsp in alignment.hsps:
                print(f"\n--- ãƒ’ãƒƒãƒˆ ---")
                print(f"é…åˆ—: {alignment.title[:60]}...")
                print(f"E-value: {hsp.expect:.2e}")
                print(f"ã‚¹ã‚³ã‚¢: {hsp.score}")
                print(f"åŒä¸€æ€§: {hsp.identities}/{hsp.align_length} "
                      f"({100*hsp.identities/hsp.align_length:.1f}%)")
                print(f"ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ:")
                print(f"Query: {hsp.query[:60]}")
                print(f"       {hsp.match[:60]}")
                print(f"Sbjct: {hsp.sbjct[:60]}")</code></pre>

<strong>å‡ºåŠ›ä¾‹</strong>:
<pre><code>=== BLASTæ¤œç´¢çµæœ ===
ã‚¯ã‚¨ãƒªé•·: 110 aa
ãƒ’ãƒƒãƒˆæ•°: 50

--- ãƒ’ãƒƒãƒˆ ---
é…åˆ—: insulin [Homo sapiens]
E-value: 2.5e-75
ã‚¹ã‚³ã‚¢: 229
åŒä¸€æ€§: 110/110 (100.0%)
Align ment:
Query: MALWMRLLPLLALLALWGPDPAAAFVNQHLCGSHLVEALYLVCGERGFFYTPKTRREAED
       ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
Sbjct: MALWMRLLPLLALLALWGPDPAAAFVNQHLCGSHLVEALYLVCGERGFFYTPKTRREAED</code></pre>

---

<h3>ãƒ­ãƒ¼ã‚«ãƒ« vs ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ</h3>

<strong>ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆNeedleman-Wunschï¼‰</strong>:
- é…åˆ—å…¨ä½“ã‚’æ¯”è¼ƒ
- é¡ä¼¼ã—ãŸé•·ã•ã®é…åˆ—ã«é©ç”¨

<strong>ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆSmith-Watermanï¼‰</strong>:
- æœ€ã‚‚é¡ä¼¼ã—ãŸéƒ¨åˆ†é ˜åŸŸã‚’æ¤œå‡º
- é•·ã•ãŒç•°ãªã‚‹é…åˆ—ã«é©ç”¨ï¼ˆBLASTã§ä½¿ç”¨ï¼‰

<strong>Example 2: Biopythonã§ã®ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ</strong>

<pre><code class="language-python">from Bio import pairwise2
from Bio.pairwise2 import format_alignment

<h1>2ã¤ã®é…åˆ—</h1>
seq1 = "ACDEFGHIKLMNPQRSTVWY"
seq2 = "ACDEFGHIKLQNPQRSTVWY"  # 1æ–‡å­—ç•°ãªã‚‹

<h1>ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ</h1>
alignments = pairwise2.align.globalxx(seq1, seq2)

print("=== ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ ===")
print(format_alignment(*alignments[0]))

<h1>ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ</h1>
local_alignments = pairwise2.align.localxx(seq1, seq2)

print("\n=== ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ ===")
print(format_alignment(*local_alignments[0]))

<h1>ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°: match +2, mismatch -1, gap -0.5</h1>
gap_penalty = -0.5
alignments_scored = pairwise2.align.globalms(
    seq1, seq2,
    match=2,
    mismatch=-1,
    open=-0.5,
    extend=-0.1
)

print("\n=== ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ä»˜ãã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ ===")
print(format_alignment(*alignments_scored[0]))
print(f"ã‚¹ã‚³ã‚¢: {alignments_scored[0][2]:.1f}")</code></pre>

---

<h2>2.2 é…åˆ—ã‹ã‚‰ã®ç‰¹å¾´é‡æŠ½å‡º</h2>

<h3>ã‚¢ãƒŸãƒé…¸ã®ç‰©ç†åŒ–å­¦çš„æ€§è³ª</h3>

<strong>20ç¨®é¡ã®ã‚¢ãƒŸãƒé…¸</strong>ã¯ã€ç•°ãªã‚‹ç‰©ç†åŒ–å­¦çš„æ€§è³ªã‚’æŒã¡ã¾ã™ï¼š

| æ€§è³ª | ã‚¢ãƒŸãƒé…¸ |
|------|---------|
| ç–æ°´æ€§ | A, V, I, L, M, F, W, P |
| è¦ªæ°´æ€§ï¼ˆæ¥µæ€§ï¼‰ | S, T, N, Q, Y, C |
| å¡©åŸºæ€§ï¼ˆæ­£é›»è·ï¼‰ | K, R, H |
| é…¸æ€§ï¼ˆè² é›»è·ï¼‰ | D, E |
| èŠ³é¦™æ— | F, Y, W |

<strong>Example 3: ã‚¢ãƒŸãƒé…¸çµ„æˆã®è¨ˆç®—</strong>

<pre><code class="language-python">from collections import Counter
import numpy as np

def calculate_aa_composition(sequence):
    """
    ã‚¢ãƒŸãƒé…¸çµ„æˆã‚’è¨ˆç®—

    Returns:
    --------
    dict: å„ã‚¢ãƒŸãƒé…¸ã®å‡ºç¾é »åº¦ï¼ˆ%ï¼‰
    """
    # å¤§æ–‡å­—ã«çµ±ä¸€
    sequence = sequence.upper()

    # 20ç¨®é¡ã®æ¨™æº–ã‚¢ãƒŸãƒé…¸
    standard_aa = "ACDEFGHIKLMNPQRSTVWY"

    # ã‚«ã‚¦ãƒ³ãƒˆ
    aa_count = Counter(sequence)

    # é »åº¦ï¼ˆ%ï¼‰ã«å¤‰æ›
    total = len(sequence)
    composition = {aa: 100 * aa_count.get(aa, 0) / total
                   for aa in standard_aa}

    return composition

<h1>ãƒ†ã‚¹ãƒˆé…åˆ—</h1>
sequence = """
MALWMRLLPLLALLALWGPDPAAAFVNQHLCGSHLVEALYLVCGERGFFY
TPKTRREAEDLQVGQVELGGGPGAGSLQPLALEGSLQKRGIVEQCCTSIC
SLYQLENYCN
"""
sequence = sequence.replace("\n", "").replace(" ", "")

comp = calculate_aa_composition(sequence)

print("=== ã‚¢ãƒŸãƒé…¸çµ„æˆ ===")
for aa in sorted(comp.keys(), key=lambda x: comp[x], reverse=True):
    if comp[aa] > 0:
        print(f"{aa}: {comp[aa]:.1f}%")

<h1>ç‰©ç†åŒ–å­¦çš„æ€§è³ªã®é›†è¨ˆ</h1>
hydrophobic = ["A", "V", "I", "L", "M", "F", "W", "P"]
charged = ["K", "R", "H", "D", "E"]
polar = ["S", "T", "N", "Q", "Y", "C"]

hydrophobic_pct = sum(comp[aa] for aa in hydrophobic)
charged_pct = sum(comp[aa] for aa in charged)
polar_pct = sum(comp[aa] for aa in polar)

print(f"\nç–æ°´æ€§ã‚¢ãƒŸãƒé…¸: {hydrophobic_pct:.1f}%")
print(f"è·é›»ã‚¢ãƒŸãƒé…¸: {charged_pct:.1f}%")
print(f"æ¥µæ€§ã‚¢ãƒŸãƒé…¸: {polar_pct:.1f}%")</code></pre>

---

<h3>k-merè¡¨ç¾</h3>

<strong>k-mer</strong>ã¯ã€é•·ã•kã®é€£ç¶šéƒ¨åˆ†é…åˆ—ã§ã™ï¼ˆè‡ªç„¶è¨€èªå‡¦ç†ã®n-gramã«ç›¸å½“ï¼‰ã€‚

<strong>Example 4: k-merç‰¹å¾´é‡ã®æŠ½å‡º</strong>

<pre><code class="language-python">from collections import Counter

def extract_kmers(sequence, k=3):
    """
    k-merç‰¹å¾´é‡ã‚’æŠ½å‡º

    Parameters:
    -----------
    sequence : str
        ã‚¢ãƒŸãƒé…¸é…åˆ—
    k : int
        k-merã®é•·ã•

    Returns:
    --------
    dict: k-merã®å‡ºç¾é »åº¦
    """
    kmers = []
    for i in range(len(sequence) - k + 1):
        kmer = sequence[i:i+k]
        kmers.append(kmer)

    # é »åº¦è¨ˆç®—
    kmer_counts = Counter(kmers)
    total = len(kmers)

    # é »åº¦ï¼ˆ%ï¼‰ã«å¤‰æ›
    kmer_freq = {kmer: 100 * count / total
                 for kmer, count in kmer_counts.items()}

    return kmer_freq

<h1>ãƒ†ã‚¹ãƒˆ</h1>
sequence = "ACDEFGHIKLMNPQRSTVWY" * 3

<h1>3-mer</h1>
kmers_3 = extract_kmers(sequence, k=3)

print("=== ä¸Šä½10å€‹ã®3-mer ===")
for kmer, freq in sorted(kmers_3.items(),
                         key=lambda x: x[1],
                         reverse=True)[:10]:
    print(f"{kmer}: {freq:.2f}%")

<h1>ç‰¹å¾´ãƒ™ã‚¯ãƒˆãƒ«ã®ä½œæˆ</h1>
def create_kmer_vector(sequence, k=3):
    """
    k-merç‰¹å¾´ãƒ™ã‚¯ãƒˆãƒ«ã‚’ä½œæˆï¼ˆæ©Ÿæ¢°å­¦ç¿’ç”¨ï¼‰
    """
    # å…¨ã¦ã®å¯èƒ½ãªk-merã‚’ç”Ÿæˆï¼ˆã‚µã‚¤ã‚º: 20^kï¼‰
    # å®Ÿéš›ã«ã¯é »å‡ºk-merã®ã¿ä½¿ç”¨
    kmers = extract_kmers(sequence, k)

    # ãƒ™ã‚¯ãƒˆãƒ«åŒ–ï¼ˆé »åº¦ãƒ™ãƒ¼ã‚¹ï¼‰
    vector = list(kmers.values())
    return vector

<h1>æ©Ÿæ¢°å­¦ç¿’ç”¨ãƒ™ã‚¯ãƒˆãƒ«</h1>
feature_vector = create_kmer_vector(sequence, k=2)
print(f"\nç‰¹å¾´ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒ: {len(feature_vector)}")</code></pre>

---

<h3>ç‰©ç†åŒ–å­¦çš„è¨˜è¿°å­</h3>

<strong>Example 5: ç–æ°´æ€§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨ˆç®—</strong>

<pre><code class="language-python">import matplotlib.pyplot as plt
import numpy as np

<h1>Kyte-Doolittleç–æ°´æ€§ã‚¹ã‚±ãƒ¼ãƒ«</h1>
hydrophobicity_scale = {
    'A': 1.8, 'C': 2.5, 'D': -3.5, 'E': -3.5,
    'F': 2.8, 'G': -0.4, 'H': -3.2, 'I': 4.5,
    'K': -3.9, 'L': 3.8, 'M': 1.9, 'N': -3.5,
    'P': -1.6, 'Q': -3.5, 'R': -4.5, 'S': -0.8,
    'T': -0.7, 'V': 4.2, 'W': -0.9, 'Y': -1.3
}

def calculate_hydrophobicity_profile(sequence, window=9):
    """
    ç–æ°´æ€§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨ˆç®—

    Parameters:
    -----------
    sequence : str
        ã‚¢ãƒŸãƒé…¸é…åˆ—
    window : int
        ç§»å‹•å¹³å‡ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚º

    Returns:
    --------
    list: å„ä½ç½®ã®ç–æ°´æ€§ã‚¹ã‚³ã‚¢
    """
    profile = []

    for i in range(len(sequence) - window + 1):
        segment = sequence[i:i+window]
        # ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†…ã®å¹³å‡ç–æ°´æ€§
        hydrophobicity = np.mean([
            hydrophobicity_scale.get(aa, 0)
            for aa in segment
        ])
        profile.append(hydrophobicity)

    return profile

<h1>ãƒ†ã‚¹ãƒˆé…åˆ—</h1>
sequence = """
MALWMRLLPLLALLALWGPDPAAAFVNQHLCGSHLVEALYLVCGERGFFY
"""
sequence = sequence.replace("\n", "").replace(" ", "")

<h1>ç–æ°´æ€§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</h1>
profile = calculate_hydrophobicity_profile(sequence, window=9)

<h1>å¯è¦–åŒ–</h1>
plt.figure(figsize=(12, 5))
plt.plot(range(len(profile)), profile, linewidth=2)
plt.axhline(y=0, color='black', linestyle='--', alpha=0.5)
plt.xlabel('ä½ç½®', fontsize=12)
plt.ylabel('ç–æ°´æ€§ã‚¹ã‚³ã‚¢', fontsize=12)
plt.title('Kyte-Doolittleç–æ°´æ€§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«', fontsize=14)
plt.grid(alpha=0.3)
plt.tight_layout()
plt.savefig('hydrophobicity_profile.png', dpi=300)
plt.show()

<h1>è†œè²«é€šé ˜åŸŸã®äºˆæ¸¬ï¼ˆç–æ°´æ€§ãŒé«˜ã„é ˜åŸŸï¼‰</h1>
threshold = 1.6  # è†œè²«é€šé ˜åŸŸã®é–¾å€¤
tm_regions = []

for i, score in enumerate(profile):
    if score > threshold:
        tm_regions.append(i)

if tm_regions:
    print(f"è†œè²«é€šé ˜åŸŸå€™è£œ: {min(tm_regions)}-{max(tm_regions)}")
else:
    print("è†œè²«é€šé ˜åŸŸã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ")</code></pre>

---

<h2>2.3 æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹æ©Ÿèƒ½äºˆæ¸¬</h2>

<h3>ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã®å±€åœ¨äºˆæ¸¬</h3>

<strong>Example 6: ç´°èƒå†…å±€åœ¨ã®äºˆæ¸¬</strong>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report, confusion_matrix

<h1>ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆï¼ˆå®Ÿéš›ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ï¼‰</h1>
def generate_sample_data(n_samples=500):
    """
    ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
    """
    np.random.seed(42)

    data = []

    # æ ¸ï¼ˆNuclearï¼‰: å¡©åŸºæ€§ãŒé«˜ã„
    for _ in range(n_samples // 5):
        features = {
            'hydrophobic_pct': np.random.normal(30, 5),
            'charged_pct': np.random.normal(35, 5),  # é«˜ã„
            'polar_pct': np.random.normal(25, 5),
            'aromatic_pct': np.random.normal(10, 3),
            'length': np.random.normal(300, 50),
            'localization': 'Nuclear'
        }
        data.append(features)

    # ç´°èƒè³ªï¼ˆCytoplasmicï¼‰
    for _ in range(n_samples // 5):
        features = {
            'hydrophobic_pct': np.random.normal(35, 5),
            'charged_pct': np.random.normal(25, 5),
            'polar_pct': np.random.normal(30, 5),
            'aromatic_pct': np.random.normal(10, 3),
            'length': np.random.normal(350, 60),
            'localization': 'Cytoplasmic'
        }
        data.append(features)

    # è†œï¼ˆMembraneï¼‰: ç–æ°´æ€§ãŒé«˜ã„
    for _ in range(n_samples // 5):
        features = {
            'hydrophobic_pct': np.random.normal(50, 5),  # é«˜ã„
            'charged_pct': np.random.normal(15, 5),
            'polar_pct': np.random.normal(25, 5),
            'aromatic_pct': np.random.normal(10, 3),
            'length': np.random.normal(280, 40),
            'localization': 'Membrane'
        }
        data.append(features)

    # ãƒŸãƒˆã‚³ãƒ³ãƒ‰ãƒªã‚¢
    for _ in range(n_samples // 5):
        features = {
            'hydrophobic_pct': np.random.normal(38, 5),
            'charged_pct': np.random.normal(28, 5),
            'polar_pct': np.random.normal(24, 5),
            'aromatic_pct': np.random.normal(10, 3),
            'length': np.random.normal(320, 55),
            'localization': 'Mitochondrial'
        }
        data.append(features)

    # åˆ†æ³Œï¼ˆSecretedï¼‰
    for _ in range(n_samples // 5):
        features = {
            'hydrophobic_pct': np.random.normal(32, 5),
            'charged_pct': np.random.normal(22, 5),
            'polar_pct': np.random.normal(36, 5),  # é«˜ã„
            'aromatic_pct': np.random.normal(10, 3),
            'length': np.random.normal(250, 45),
            'localization': 'Secreted'
        }
        data.append(features)

    return pd.DataFrame(data)

<h1>ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</h1>
df = generate_sample_data(n_samples=500)

print("=== ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ¦‚è¦ ===")
print(df.head())
print(f"\nå±€åœ¨ã®åˆ†å¸ƒ:")
print(df['localization'].value_counts())

<h1>ç‰¹å¾´é‡ã¨ãƒ©ãƒ™ãƒ«ã‚’åˆ†é›¢</h1>
X = df.drop('localization', axis=1)
y = df['localization']

<h1>è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«åˆ†å‰²</h1>
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

<h1>Random Forestãƒ¢ãƒ‡ãƒ«</h1>
model = RandomForestClassifier(
    n_estimators=100,
    max_depth=10,
    random_state=42
)

model.fit(X_train, y_train)

<h1>äºˆæ¸¬</h1>
y_pred = model.predict(X_test)

<h1>è©•ä¾¡</h1>
print("\n=== è©•ä¾¡çµæœ ===")
print(classification_report(y_test, y_pred))

<h1>ç‰¹å¾´é‡é‡è¦åº¦</h1>
feature_importance = pd.DataFrame({
    'feature': X.columns,
    'importance': model.feature_importances_
}).sort_values('importance', ascending=False)

print("\n=== ç‰¹å¾´é‡é‡è¦åº¦ ===")
print(feature_importance)

<h1>æ–°ã—ã„ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã®äºˆæ¸¬</h1>
new_protein = {
    'hydrophobic_pct': 48.0,
    'charged_pct': 18.0,
    'polar_pct': 24.0,
    'aromatic_pct': 10.0,
    'length': 290.0
}

prediction = model.predict([list(new_protein.values())])
print(f"\næ–°ã—ã„ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã®äºˆæ¸¬å±€åœ¨: {prediction[0]}")</code></pre>

---

<h2>2.4 ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼šé…µç´ æ´»æ€§äºˆæ¸¬</h2>

<h3>ãƒ‡ãƒ¼ã‚¿åé›†ã¨å‰å‡¦ç†</h3>

<strong>Example 7: é…µç´ ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®æº–å‚™</strong>

<pre><code class="language-python">import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler

def extract_features_from_sequence(sequence):
    """
    é…åˆ—ã‹ã‚‰ç‰¹å¾´é‡ã‚’æŠ½å‡º
    """
    # ã‚¢ãƒŸãƒé…¸çµ„æˆ
    aa_count = {aa: sequence.count(aa) for aa in "ACDEFGHIKLMNPQRSTVWY"}
    aa_comp = {f"aa_{aa}": count / len(sequence)
               for aa, count in aa_count.items()}

    # ç‰©ç†åŒ–å­¦çš„æ€§è³ª
    hydrophobic = sum(sequence.count(aa) for aa in "AVILMFWP")
    charged = sum(sequence.count(aa) for aa in "KRHDE")
    polar = sum(sequence.count(aa) for aa in "STNQYC")

    features = {
        **aa_comp,
        'length': len(sequence),
        'hydrophobic_pct': 100 * hydrophobic / len(sequence),
        'charged_pct': 100 * charged / len(sequence),
        'polar_pct': 100 * polar / len(sequence),
        'molecular_weight': sum(
            aa_count.get(aa, 0) * mw
            for aa, mw in {
                'A': 89, 'C': 121, 'D': 133, 'E': 147,
                'F': 165, 'G': 75, 'H': 155, 'I': 131,
                'K': 146, 'L': 131, 'M': 149, 'N': 132,
                'P': 115, 'Q': 146, 'R': 174, 'S': 105,
                'T': 119, 'V': 117, 'W': 204, 'Y': 181
            }.items()
        )
    }

    return features

<h1>ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã¯UniProtãªã©ã‹ã‚‰å–å¾—ï¼‰</h1>
enzyme_data = [
    {
        'sequence': "ACDEFGHIKLMNPQRSTVWY" * 10,
        'activity': 8.5  # log(kcat/Km)
    },
    # å®Ÿéš›ã«ã¯æ•°ç™¾ã€œæ•°åƒã®ãƒ‡ãƒ¼ã‚¿
]

print("ç‰¹å¾´é‡æŠ½å‡ºã®ãƒ‡ãƒ¢:")
features = extract_features_from_sequence(enzyme_data[0]['sequence'])
print(f"ç‰¹å¾´é‡æ•°: {len(features)}")
print(f"ã‚µãƒ³ãƒ—ãƒ«ç‰¹å¾´é‡:")
for key, value in list(features.items())[:5]:
    print(f"  {key}: {value:.3f}")</code></pre>

---

<h3>ãƒ¢ãƒ‡ãƒ«è¨“ç·´ã¨è©•ä¾¡</h3>

<strong>Example 8: LightGBMã«ã‚ˆã‚‹é…µç´ æ´»æ€§äºˆæ¸¬</strong>

<pre><code class="language-python">import numpy as np
import pandas as pd
import lightgbm as lgb
from sklearn.model_selection import cross_val_score
from sklearn.metrics import mean_absolute_error, r2_score
import matplotlib.pyplot as plt

<h1>ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆå®Ÿéš›ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ï¼‰</h1>
np.random.seed(42)

n_samples = 200
X = np.random.randn(n_samples, 25)  # 25ç‰¹å¾´é‡
<h1>æ´»æ€§ã¯ç‰¹å®šã®ç‰¹å¾´ã«ä¾å­˜</h1>
y = (2.0 * X[:, 0] + 1.5 * X[:, 1] - 1.0 * X[:, 2] +
     np.random.randn(n_samples) * 0.5)

<h1>è¨“ç·´/ãƒ†ã‚¹ãƒˆåˆ†å‰²</h1>
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

<h1>LightGBMãƒ¢ãƒ‡ãƒ«</h1>
model = lgb.LGBMRegressor(
    n_estimators=100,
    learning_rate=0.1,
    max_depth=5,
    random_state=42
)

model.fit(X_train, y_train)

<h1>äºˆæ¸¬</h1>
y_pred = model.predict(X_test)

<h1>è©•ä¾¡</h1>
mae = mean_absolute_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

print(f"=== ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ ===")
print(f"MAE: {mae:.3f}")
print(f"RÂ²: {r2:.3f}")

<h1>å¯è¦–åŒ–</h1>
plt.figure(figsize=(8, 6))
plt.scatter(y_test, y_pred, alpha=0.6)
plt.plot([y_test.min(), y_test.max()],
         [y_test.min(), y_test.max()],
         'r--', lw=2)
plt.xlabel('å®Ÿæ¸¬å€¤ (log(kcat/Km))', fontsize=12)
plt.ylabel('äºˆæ¸¬å€¤', fontsize=12)
plt.title(f'é…µç´ æ´»æ€§äºˆæ¸¬ (RÂ²={r2:.3f})', fontsize=14)
plt.grid(alpha=0.3)
plt.tight_layout()
plt.savefig('enzyme_activity_prediction.png', dpi=300)
plt.show()

<h1>ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</h1>
cv_scores = cross_val_score(
    model, X_train, y_train,
    cv=5,
    scoring='r2'
)

print(f"\nCV RÂ²: {cv_scores.mean():.3f} Â± "
      f"{cv_scores.std():.3f}")</code></pre>

---

<h3>ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°</h3>

<strong>Example 9: Optunaã«ã‚ˆã‚‹æœ€é©åŒ–</strong>

<pre><code class="language-python">import optuna
import lightgbm as lgb
from sklearn.model_selection import cross_val_score

def objective(trial):
    """
    Optunaã®ç›®çš„é–¢æ•°
    """
    # ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¢ç´¢ç©ºé–“
    params = {
        'n_estimators': trial.suggest_int('n_estimators', 50, 200),
        'learning_rate': trial.suggest_float(
            'learning_rate', 0.01, 0.3
        ),
        'max_depth': trial.suggest_int('max_depth', 3, 10),
        'num_leaves': trial.suggest_int('num_leaves', 20, 100),
        'min_child_samples': trial.suggest_int(
            'min_child_samples', 5, 50
        ),
        'random_state': 42
    }

    # ãƒ¢ãƒ‡ãƒ«
    model = lgb.LGBMRegressor(**params)

    # ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    scores = cross_val_score(
        model, X_train, y_train,
        cv=3,
        scoring='r2'
    )

    return scores.mean()

<h1>æœ€é©åŒ–</h1>
study = optuna.create_study(direction='maximize')
study.optimize(objective, n_trials=50)

print(f"\n=== æœ€é©åŒ–çµæœ ===")
print(f"æœ€è‰¯RÂ²: {study.best_value:.3f}")
print(f"æœ€è‰¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:")
for key, value in study.best_params.items():
    print(f"  {key}: {value}")

<h1>æœ€è‰¯ãƒ¢ãƒ‡ãƒ«ã§å†è¨“ç·´</h1>
best_model = lgb.LGBMRegressor(**study.best_params)
best_model.fit(X_train, y_train)

y_pred_best = best_model.predict(X_test)
r2_best = r2_score(y_test, y_pred_best)

print(f"\nãƒ†ã‚¹ãƒˆRÂ²ï¼ˆæœ€é©åŒ–å¾Œï¼‰: {r2_best:.3f}")</code></pre>

---

<h2>2.5 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

1. <strong>é…åˆ—ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ</strong>
   - BLASTæ¤œç´¢ã«ã‚ˆã‚‹ç›¸åŒé…åˆ—æ¢ç´¢
   - ãƒ­ãƒ¼ã‚«ãƒ« vs ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ

2. <strong>ç‰¹å¾´é‡æŠ½å‡º</strong>
   - ã‚¢ãƒŸãƒé…¸çµ„æˆ
   - k-merè¡¨ç¾
   - ç‰©ç†åŒ–å­¦çš„è¨˜è¿°å­ï¼ˆç–æ°´æ€§ãªã©ï¼‰

3. <strong>æ©Ÿæ¢°å­¦ç¿’</strong>
   - Random Forestã«ã‚ˆã‚‹å±€åœ¨äºˆæ¸¬
   - LightGBMã«ã‚ˆã‚‹é…µç´ æ´»æ€§äºˆæ¸¬
   - ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

<h3>æ¬¡ã®ç« ã¸</h3>

ç¬¬3ç« ã§ã¯ã€<strong>åˆ†å­ãƒ‰ãƒƒã‚­ãƒ³ã‚°ã¨ç›¸äº’ä½œç”¨è§£æ</strong>ã‚’å­¦ã³ã¾ã™ã€‚

<strong>[ç¬¬3ç« ï¼šåˆ†å­ãƒ‰ãƒƒã‚­ãƒ³ã‚°ã¨ç›¸äº’ä½œç”¨è§£æ â†’](./chapter-3.md)</strong>

---

<h2>å‚è€ƒæ–‡çŒ®</h2>

1. Altschul, S. F. et al. (1990). "Basic local alignment search tool."
   *Journal of Molecular Biology*, 215(3), 403-410.

2. Kyte, J. & Doolittle, R. F. (1982). "A simple method for displaying
   the hydropathic character of a protein." *Journal of Molecular Biology*,
   157(1), 105-132.

---

<h2>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³</h2>

<strong>[â† ç¬¬1ç« ](./chapter-1.md)</strong> | <strong>[ç¬¬3ç«  â†’](./chapter-3.md)</strong> | <strong>[ç›®æ¬¡](./index.md)</strong>
<div class="navigation">
    <a href="chapter-1.html" class="nav-button">â† ç¬¬1ç« </a>
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
    <a href="chapter-3.html" class="nav-button">ç¬¬3ç«  â†’</a>
</div>
    </main>

    <footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ç›£ä¿®</strong>: Dr. Yusuke Hashimotoï¼ˆæ±åŒ—å¤§å­¦ï¼‰</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-17</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mermaidCodeBlocks = document.querySelectorAll('pre.codehilite code.language-mermaid, pre code.language-mermaid');

            mermaidCodeBlocks.forEach(function(codeBlock) {
                const pre = codeBlock.parentElement;
                const mermaidCode = codeBlock.textContent;

                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode.trim();

                pre.parentNode.replaceChild(mermaidDiv, pre);
            });

            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'default'
                });
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }
        });
    </script>
</body>
</html>
