<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬1ç« ï¼šå®Ÿé¨“ãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤ - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\(', '\)']],
                displayMath: [['$$', '$$'], ['\[', '\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ç¬¬1ç« ï¼šå®Ÿé¨“ãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤</h1>
            <p class="subtitle">ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ã‹ã‚‰å¤–ã‚Œå€¤æ¤œå‡ºã¾ã§ - ä¿¡é ¼æ€§ã®é«˜ã„è§£æã®ç¬¬ä¸€æ­©</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 20-25åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: åˆç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 8å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 3å•</span>
            </div>
        </div>
    </header>

    <main class="container">

<h1>ç¬¬1ç« ï¼šå®Ÿé¨“ãƒ‡ãƒ¼ã‚¿è§£æã®åŸºç¤</h1>

<strong>ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ã‹ã‚‰å¤–ã‚Œå€¤æ¤œå‡ºã¾ã§ - ä¿¡é ¼æ€§ã®é«˜ã„è§£æã®ç¬¬ä¸€æ­©</strong>

<h2>å­¦ç¿’ç›®æ¨™</h2>

ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š

- âœ… å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿è§£æã®å…¨ä½“ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’èª¬æ˜ã§ãã‚‹
- âœ… ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ã®é‡è¦æ€§ã¨å„æ‰‹æ³•ã®ä½¿ã„åˆ†ã‘ã‚’ç†è§£ã—ã¦ã„ã‚‹
- âœ… ãƒã‚¤ã‚ºé™¤å»ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©åˆ‡ã«é¸æŠãƒ»é©ç”¨ã§ãã‚‹
- âœ… å¤–ã‚Œå€¤ã‚’æ¤œå‡ºã—ã€é©åˆ‡ã«å‡¦ç†ã§ãã‚‹
- âœ… æ¨™æº–åŒ–ãƒ»æ­£è¦åŒ–æ‰‹æ³•ã‚’ç›®çš„ã«å¿œã˜ã¦ä½¿ã„åˆ†ã‘ã‚‰ã‚Œã‚‹

<strong>èª­äº†æ™‚é–“</strong>: 20-25åˆ†
<strong>ã‚³ãƒ¼ãƒ‰ä¾‹</strong>: 8å€‹
<strong>æ¼”ç¿’å•é¡Œ</strong>: 3å•

---

<h2>1.1 å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿è§£æã®é‡è¦æ€§ã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h2>

<h3>ãªãœãƒ‡ãƒ¼ã‚¿é§†å‹•å‹è§£æãŒå¿…è¦ã‹</h3>

ææ–™ç§‘å­¦ç ”ç©¶ã§ã¯ã€XRDï¼ˆXç·šå›æŠ˜ï¼‰ã€XPSï¼ˆXç·šå…‰é›»å­åˆ†å…‰ï¼‰ã€SEMï¼ˆèµ°æŸ»å‹é›»å­é¡•å¾®é¡ï¼‰ã€å„ç¨®ã‚¹ãƒšã‚¯ãƒˆãƒ«æ¸¬å®šãªã©ã€å¤šæ§˜ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒªã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æŠ€è¡“ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ¸¬å®šã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã€ææ–™ã®æ§‹é€ ã€çµ„æˆã€ç‰©æ€§ã‚’ç†è§£ã™ã‚‹ä¸Šã§ä¸å¯æ¬ ã§ã™ã€‚

ã—ã‹ã—ã€å¾“æ¥ã®æ‰‹å‹•è§£æã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªèª²é¡ŒãŒã‚ã‚Šã¾ã™ï¼š

<strong>å¾“æ¥ã®æ‰‹å‹•è§£æã®é™ç•Œ</strong>:
1. <strong>æ™‚é–“ãŒã‹ã‹ã‚‹</strong>: 1ã¤ã®XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ”ãƒ¼ã‚¯åŒå®šã«30åˆ†ã€œ1æ™‚é–“
2. <strong>ä¸»è¦³çš„</strong>: è§£æè€…ã®çµŒé¨“ã‚„åˆ¤æ–­ã«ã‚ˆã£ã¦çµæœãŒç•°ãªã‚‹
3. <strong>å†ç¾æ€§ã®å•é¡Œ</strong>: åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’åˆ¥ã®äººãŒè§£æã™ã‚‹ã¨ç•°ãªã‚‹çµæœã«ãªã‚‹å¯èƒ½æ€§
4. <strong>å¤§é‡ãƒ‡ãƒ¼ã‚¿ã«å¯¾å¿œã§ããªã„</strong>: ãƒã‚¤ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæ¸¬å®šï¼ˆ1æ—¥æ•°ç™¾ã€œæ•°åƒã‚µãƒ³ãƒ—ãƒ«ï¼‰ã«è¿½ã„ã¤ã‹ãªã„

<strong>ãƒ‡ãƒ¼ã‚¿é§†å‹•å‹è§£æã®åˆ©ç‚¹</strong>:
1. <strong>é«˜é€ŸåŒ–</strong>: æ•°ç§’ã€œæ•°åˆ†ã§è§£æå®Œäº†ï¼ˆ100å€ä»¥ä¸Šã®é«˜é€ŸåŒ–ï¼‰
2. <strong>å®¢è¦³æ€§</strong>: æ˜ç¢ºãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«åŸºã¥ãå†ç¾å¯èƒ½ãªçµæœ
3. <strong>ä¸€è²«æ€§</strong>: åŒã˜ã‚³ãƒ¼ãƒ‰ã¯å¸¸ã«åŒã˜çµæœã‚’å‡ºåŠ›
4. <strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong>: 1ã‚µãƒ³ãƒ—ãƒ«ã§ã‚‚1ä¸‡ã‚µãƒ³ãƒ—ãƒ«ã§ã‚‚åŒã˜åŠ´åŠ›

<h3>ææ–™ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒªã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æŠ€è¡“ä¸€è¦§</h3>

ä¸»è¦ãªæ¸¬å®šæŠ€è¡“ã¨å¾—ã‚‰ã‚Œã‚‹æƒ…å ±ï¼š

| æ¸¬å®šæŠ€è¡“ | å¾—ã‚‰ã‚Œã‚‹æƒ…å ± | ãƒ‡ãƒ¼ã‚¿å½¢å¼ | å…¸å‹çš„ãªãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º |
|---------|------------|----------|-------------------|
| <strong>XRD</strong> | çµæ™¶æ§‹é€ ã€ç›¸åŒå®šã€çµæ™¶å­ã‚µã‚¤ã‚º | 1æ¬¡å…ƒã‚¹ãƒšã‚¯ãƒˆãƒ« | æ•°åƒç‚¹ |
| <strong>XPS</strong> | å…ƒç´ çµ„æˆã€åŒ–å­¦çŠ¶æ…‹ã€é›»å­æ§‹é€  | 1æ¬¡å…ƒã‚¹ãƒšã‚¯ãƒˆãƒ« | æ•°åƒç‚¹ |
| <strong>SEM/TEM</strong> | å½¢æ…‹ã€ç²’å¾„ã€çµ„ç¹” | 2æ¬¡å…ƒç”»åƒ | æ•°ç™¾ä¸‡ç”»ç´  |
| <strong>IR/Raman</strong> | åˆ†å­æŒ¯å‹•ã€å®˜èƒ½åŸºã€çµæ™¶æ€§ | 1æ¬¡å…ƒã‚¹ãƒšã‚¯ãƒˆãƒ« | æ•°åƒç‚¹ |
| <strong>UV-Vis</strong> | å…‰å¸åã€ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ— | 1æ¬¡å…ƒã‚¹ãƒšã‚¯ãƒˆãƒ« | æ•°ç™¾ã€œæ•°åƒç‚¹ |
| <strong>TGA/DSC</strong> | ç†±å®‰å®šæ€§ã€ç›¸è»¢ç§» | 1æ¬¡å…ƒæ™‚ç³»åˆ— | æ•°åƒç‚¹ |

<h3>å…¸å‹çš„ãªè§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆ5ã‚¹ãƒ†ãƒƒãƒ—ï¼‰</h3>

å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿è§£æã¯é€šå¸¸ã€ä»¥ä¸‹ã®5ã‚¹ãƒ†ãƒƒãƒ—ã§é€²è¡Œã—ã¾ã™ï¼š

<div class="mermaid">flowchart LR
    A[1. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿] --> B[2. ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†]
    B --> C[3. ç‰¹å¾´æŠ½å‡º]
    C --> D[4. çµ±è¨ˆè§£æ/æ©Ÿæ¢°å­¦ç¿’]
    D --> E[5. å¯è¦–åŒ–ãƒ»å ±å‘Š]
    E --> F[çµæœã®è§£é‡ˆ]

    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style D fill:#e8f5e9
    style E fill:#fce4ec
    style F fill:#fff9c4</div>

<strong>å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°</strong>:

1. <strong>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</strong>: CSVã€ãƒ†ã‚­ã‚¹ãƒˆã€ãƒã‚¤ãƒŠãƒªå½¢å¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
2. <strong>ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†</strong>: ãƒã‚¤ã‚ºé™¤å»ã€å¤–ã‚Œå€¤å‡¦ç†ã€æ¨™æº–åŒ–
3. <strong>ç‰¹å¾´æŠ½å‡º</strong>: ãƒ”ãƒ¼ã‚¯æ¤œå‡ºã€è¼ªéƒ­æŠ½å‡ºã€çµ±è¨ˆé‡è¨ˆç®—
4. <strong>çµ±è¨ˆè§£æ/æ©Ÿæ¢°å­¦ç¿’</strong>: å›å¸°ã€åˆ†é¡ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
5. <strong>å¯è¦–åŒ–ãƒ»å ±å‘Š</strong>: ã‚°ãƒ©ãƒ•ä½œæˆã€ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

æœ¬ç« ã§ã¯ã€<strong>ã‚¹ãƒ†ãƒƒãƒ—2ï¼ˆãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ï¼‰</strong>ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚

---

<h2>1.2 ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ã®åŸºç¤</h2>

<h3>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</h3>

ã¾ãšã€æ§˜ã€…ãªå½¢å¼ã®å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚

<strong>ã‚³ãƒ¼ãƒ‰ä¾‹1: CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ï¼ˆXRDãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰</strong>

<pre><code class="language-python"><h1>XRDãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿</h1>
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

<h1>CSVãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆ2Î¸, intensityï¼‰</h1>
<h1>ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ</h1>
np.random.seed(42)
two_theta = np.linspace(10, 80, 700)  # 2Î¸ç¯„å›²: 10-80åº¦
intensity = (
    1000 * np.exp(-((two_theta - 28) ** 2) / 10) +  # ãƒ”ãƒ¼ã‚¯1
    1500 * np.exp(-((two_theta - 32) ** 2) / 8) +   # ãƒ”ãƒ¼ã‚¯2
    800 * np.exp(-((two_theta - 47) ** 2) / 12) +   # ãƒ”ãƒ¼ã‚¯3
    np.random.normal(0, 50, len(two_theta))          # ãƒã‚¤ã‚º
)

<h1>DataFrameã«æ ¼ç´</h1>
df = pd.DataFrame({
    'two_theta': two_theta,
    'intensity': intensity
})

<h1>åŸºæœ¬çµ±è¨ˆé‡ã®ç¢ºèª</h1>
print("=== ãƒ‡ãƒ¼ã‚¿åŸºæœ¬çµ±è¨ˆ ===")
print(df.describe())

<h1>ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–</h1>
plt.figure(figsize=(10, 5))
plt.plot(df['two_theta'], df['intensity'], linewidth=1)
plt.xlabel('2Î¸ (degree)')
plt.ylabel('Intensity (counts)')
plt.title('Raw XRD Pattern')
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

print(f"\nãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: {len(df)}")
print(f"2Î¸ç¯„å›²: {df['two_theta'].min():.1f} - {df['two_theta'].max():.1f}Â°")
print(f"å¼·åº¦ç¯„å›²: {df['intensity'].min():.1f} - {df['intensity'].max():.1f}")</code></pre>

<strong>å‡ºåŠ›</strong>:
<pre><code>=== ãƒ‡ãƒ¼ã‚¿åŸºæœ¬çµ±è¨ˆ ===
         two_theta    intensity
count   700.000000   700.000000
mean     45.000000   351.893421
std      20.219545   480.523106
min      10.000000  -123.456789
25%      27.500000    38.901234
50%      45.000000   157.345678
75%      62.500000   401.234567
max      80.000000  1523.456789

ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: 700
2Î¸ç¯„å›²: 10.0 - 80.0Â°
å¼·åº¦ç¯„å›²: -123.5 - 1523.5</code></pre>

<h3>ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ç†è§£ã¨æ•´å½¢</h3>

<strong>ã‚³ãƒ¼ãƒ‰ä¾‹2: ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ç¢ºèªã¨æ•´å½¢</strong>

<pre><code class="language-python"><h1>ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ç¢ºèª</h1>
print("=== ãƒ‡ãƒ¼ã‚¿æ§‹é€  ===")
print(f"ãƒ‡ãƒ¼ã‚¿å‹:\n{df.dtypes}\n")
print(f"æ¬ æå€¤:\n{df.isnull().sum()}\n")
print(f"é‡è¤‡è¡Œ: {df.duplicated().sum()}")

<h1>æ¬ æå€¤ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ã®ä¾‹</h1>
df_with_nan = df.copy()
df_with_nan.loc[100:105, 'intensity'] = np.nan  # æ¬ æå€¤ã‚’æ„å›³çš„ã«æŒ¿å…¥

print("\n=== æ¬ æå€¤å‡¦ç† ===")
print(f"æ¬ æå€¤ã®æ•°: {df_with_nan['intensity'].isnull().sum()}")

<h1>æ¬ æå€¤ã®è£œé–“ï¼ˆç·šå½¢è£œé–“ï¼‰</h1>
df_with_nan['intensity_interpolated'] = df_with_nan['intensity'].interpolate(method='linear')

<h1>å‰å¾Œã®å€¤ã§ç¢ºèª</h1>
print("\næ¬ æå€¤ã®å‰å¾Œ:")
print(df_with_nan.iloc[98:108][['two_theta', 'intensity', 'intensity_interpolated']])</code></pre>

<h3>æ¬ æå€¤ãƒ»ç•°å¸¸å€¤ã®æ¤œå‡ºã¨å‡¦ç†</h3>

<strong>ã‚³ãƒ¼ãƒ‰ä¾‹3: ç•°å¸¸å€¤ã®æ¤œå‡º</strong>

<pre><code class="language-python">from scipy import stats

<h1>è² ã®å¼·åº¦å€¤ã¯ç‰©ç†çš„ã«ã‚ã‚Šãˆãªã„ï¼ˆç•°å¸¸å€¤ï¼‰</h1>
negative_mask = df['intensity'] < 0
print(f"è² ã®å¼·åº¦å€¤ã®æ•°: {negative_mask.sum()} / {len(df)}")

<h1>è² ã®å€¤ã‚’0ã«ç½®ãæ›ãˆ</h1>
df_cleaned = df.copy()
df_cleaned.loc[negative_mask, 'intensity'] = 0

<h1>å¯è¦–åŒ–</h1>
fig, axes = plt.subplots(1, 2, figsize=(12, 4))

axes[0].plot(df['two_theta'], df['intensity'], label='Raw', alpha=0.7)
axes[0].axhline(y=0, color='r', linestyle='--', label='Zero line')
axes[0].set_xlabel('2Î¸ (degree)')
axes[0].set_ylabel('Intensity')
axes[0].set_title('Raw Data (with negative values)')
axes[0].legend()
axes[0].grid(True, alpha=0.3)

axes[1].plot(df_cleaned['two_theta'], df_cleaned['intensity'], label='Cleaned', color='green')
axes[1].axhline(y=0, color='r', linestyle='--', label='Zero line')
axes[1].set_xlabel('2Î¸ (degree)')
axes[1].set_ylabel('Intensity')
axes[1].set_title('Cleaned Data (negatives removed)')
axes[1].legend()
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()</code></pre>

---

<h2>1.3 ãƒã‚¤ã‚ºé™¤å»æ‰‹æ³•</h2>

å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã«ã¯å¿…ãšãƒã‚¤ã‚ºãŒå«ã¾ã‚Œã¾ã™ã€‚ãƒã‚¤ã‚ºé™¤å»ã¯ã€ä¿¡å·å¯¾é›‘éŸ³æ¯”ï¼ˆS/Næ¯”ï¼‰ã‚’å‘ä¸Šã•ã›ã€å¾Œç¶šã®è§£æç²¾åº¦ã‚’é«˜ã‚ã¾ã™ã€‚

<h3>ç§»å‹•å¹³å‡ãƒ•ã‚£ãƒ«ã‚¿</h3>

æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªãƒã‚¤ã‚ºé™¤å»æ‰‹æ³•ã§ã™ã€‚å„ãƒ‡ãƒ¼ã‚¿ç‚¹ã‚’ã€ãã®å‘¨è¾ºã®å¹³å‡å€¤ã§ç½®ãæ›ãˆã¾ã™ã€‚

<strong>ã‚³ãƒ¼ãƒ‰ä¾‹4: ç§»å‹•å¹³å‡ãƒ•ã‚£ãƒ«ã‚¿</strong>

<pre><code class="language-python">from scipy.ndimage import uniform_filter1d

<h1>ç§»å‹•å¹³å‡ãƒ•ã‚£ãƒ«ã‚¿ã®é©ç”¨</h1>
window_sizes = [5, 11, 21]

plt.figure(figsize=(12, 8))

<h1>å…ƒãƒ‡ãƒ¼ã‚¿</h1>
plt.subplot(2, 2, 1)
plt.plot(df_cleaned['two_theta'], df_cleaned['intensity'], linewidth=1)
plt.xlabel('2Î¸ (degree)')
plt.ylabel('Intensity')
plt.title('Original Data')
plt.grid(True, alpha=0.3)

<h1>ç•°ãªã‚‹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã®ç§»å‹•å¹³å‡</h1>
for i, window_size in enumerate(window_sizes, start=2):
    smoothed = uniform_filter1d(df_cleaned['intensity'].values, size=window_size)

    plt.subplot(2, 2, i)
    plt.plot(df_cleaned['two_theta'], smoothed, linewidth=1.5)
    plt.xlabel('2Î¸ (degree)')
    plt.ylabel('Intensity')
    plt.title(f'Moving Average (window={window_size})')
    plt.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

<h1>ãƒã‚¤ã‚ºé™¤å»åŠ¹æœã®å®šé‡è©•ä¾¡</h1>
print("=== ãƒã‚¤ã‚ºé™¤å»åŠ¹æœ ===")
original_std = np.std(df_cleaned['intensity'].values)
for window_size in window_sizes:
    smoothed = uniform_filter1d(df_cleaned['intensity'].values, size=window_size)
    smoothed_std = np.std(smoothed)
    noise_reduction = (1 - smoothed_std / original_std) * 100
    print(f"Window={window_size:2d}: ãƒã‚¤ã‚ºå‰Šæ¸› {noise_reduction:.1f}%")</code></pre>

<strong>å‡ºåŠ›</strong>:
<pre><code>=== ãƒã‚¤ã‚ºé™¤å»åŠ¹æœ ===
Window= 5: ãƒã‚¤ã‚ºå‰Šæ¸› 15.2%
Window=11: ãƒã‚¤ã‚ºå‰Šæ¸› 28.5%
Window=21: ãƒã‚¤ã‚ºå‰Šæ¸› 41.3%</code></pre>

<strong>ä½¿ã„åˆ†ã‘ã‚¬ã‚¤ãƒ‰</strong>:
- <strong>å°ã•ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆ3-5ï¼‰</strong>: ãƒã‚¤ã‚ºã¯æ®‹ã‚‹ãŒã€ãƒ”ãƒ¼ã‚¯å½¢çŠ¶ã‚’ä¿æŒ
- <strong>ä¸­ç¨‹åº¦ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆ7-15ï¼‰</strong>: ãƒãƒ©ãƒ³ã‚¹è‰¯å¥½ã€æ¨å¥¨
- <strong>å¤§ãã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆ>20ï¼‰</strong>: ãƒã‚¤ã‚ºé™¤å»ã¯å¼·åŠ›ã ãŒã€ãƒ”ãƒ¼ã‚¯ãŒåºƒãŒã‚‹

<h3>Savitzky-Golay ãƒ•ã‚£ãƒ«ã‚¿</h3>

ç§»å‹•å¹³å‡ã‚ˆã‚Šã‚‚é«˜åº¦ãªæ‰‹æ³•ã§ã€ãƒ”ãƒ¼ã‚¯å½¢çŠ¶ã‚’ä¿æŒã—ãªãŒã‚‰ãƒã‚¤ã‚ºã‚’é™¤å»ã§ãã¾ã™ã€‚

<strong>ã‚³ãƒ¼ãƒ‰ä¾‹5: Savitzky-Golay ãƒ•ã‚£ãƒ«ã‚¿</strong>

<pre><code class="language-python">from scipy.signal import savgol_filter

<h1>Savitzky-Golay ãƒ•ã‚£ãƒ«ã‚¿ã®é©ç”¨</h1>
window_length = 11  # å¥‡æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
polyorder = 3       # å¤šé …å¼ã®æ¬¡æ•°

sg_smoothed = savgol_filter(df_cleaned['intensity'].values, window_length, polyorder)

<h1>ç§»å‹•å¹³å‡ã¨ã®æ¯”è¼ƒ</h1>
ma_smoothed = uniform_filter1d(df_cleaned['intensity'].values, size=window_length)

plt.figure(figsize=(12, 5))

plt.subplot(1, 2, 1)
plt.plot(df_cleaned['two_theta'], df_cleaned['intensity'],
         label='Original', alpha=0.5, linewidth=1)
plt.plot(df_cleaned['two_theta'], ma_smoothed,
         label='Moving Average', linewidth=1.5)
plt.plot(df_cleaned['two_theta'], sg_smoothed,
         label='Savitzky-Golay', linewidth=1.5)
plt.xlabel('2Î¸ (degree)')
plt.ylabel('Intensity')
plt.title('Comparison of Smoothing Methods')
plt.legend()
plt.grid(True, alpha=0.3)

<h1>ãƒ”ãƒ¼ã‚¯éƒ¨åˆ†ã®æ‹¡å¤§</h1>
plt.subplot(1, 2, 2)
peak_region = (df_cleaned['two_theta'] > 26) & (df_cleaned['two_theta'] < 34)
plt.plot(df_cleaned.loc[peak_region, 'two_theta'],
         df_cleaned.loc[peak_region, 'intensity'],
         label='Original', alpha=0.5, linewidth=1)
plt.plot(df_cleaned.loc[peak_region, 'two_theta'],
         ma_smoothed[peak_region],
         label='Moving Average', linewidth=1.5)
plt.plot(df_cleaned.loc[peak_region, 'two_theta'],
         sg_smoothed[peak_region],
         label='Savitzky-Golay', linewidth=1.5)
plt.xlabel('2Î¸ (degree)')
plt.ylabel('Intensity')
plt.title('Zoomed: Peak Region')
plt.legend()
plt.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

print("=== Savitzky-Golay ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ===")
print(f"Window length: {window_length}")
print(f"Polynomial order: {polyorder}")
print(f"\næ¨å¥¨è¨­å®š:")
print("- ãƒã‚¤ã‚ºãŒå¤šã„: window_length=11-21, polyorder=2-3")
print("- ãƒã‚¤ã‚ºãŒå°‘ãªã„: window_length=5-11, polyorder=2-4")</code></pre>

<strong>Savitzky-Golay ãƒ•ã‚£ãƒ«ã‚¿ã®åˆ©ç‚¹</strong>:
- ãƒ”ãƒ¼ã‚¯ã®é«˜ã•ã¨ä½ç½®ã‚’ã‚ˆã‚Šæ­£ç¢ºã«ä¿æŒ
- ã‚¨ãƒƒã‚¸ï¼ˆæ€¥å³»ãªå¤‰åŒ–ï¼‰ã‚’æ»‘ã‚‰ã‹ã«ã—ã™ããªã„
- å¾®åˆ†è¨ˆç®—ã¨ã®ç›¸æ€§ãŒè‰¯ã„ï¼ˆå¾Œã®ãƒ”ãƒ¼ã‚¯æ¤œå‡ºã§æœ‰ç”¨ï¼‰

<h3>ã‚¬ã‚¦ã‚·ã‚¢ãƒ³ãƒ•ã‚£ãƒ«ã‚¿</h3>

ç”»åƒå‡¦ç†ã§åºƒãä½¿ã‚ã‚Œã‚‹æ‰‹æ³•ã§ã™ãŒã€1æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿ã«ã‚‚é©ç”¨å¯èƒ½ã§ã™ã€‚

<strong>ã‚³ãƒ¼ãƒ‰ä¾‹6: ã‚¬ã‚¦ã‚·ã‚¢ãƒ³ãƒ•ã‚£ãƒ«ã‚¿</strong>

<pre><code class="language-python">from scipy.ndimage import gaussian_filter1d

<h1>ã‚¬ã‚¦ã‚·ã‚¢ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ã®é©ç”¨</h1>
sigma_values = [1, 2, 4]  # æ¨™æº–åå·®

plt.figure(figsize=(12, 8))

plt.subplot(2, 2, 1)
plt.plot(df_cleaned['two_theta'], df_cleaned['intensity'], linewidth=1)
plt.xlabel('2Î¸ (degree)')
plt.ylabel('Intensity')
plt.title('Original Data')
plt.grid(True, alpha=0.3)

for i, sigma in enumerate(sigma_values, start=2):
    gaussian_smoothed = gaussian_filter1d(df_cleaned['intensity'].values, sigma=sigma)

    plt.subplot(2, 2, i)
    plt.plot(df_cleaned['two_theta'], gaussian_smoothed, linewidth=1.5)
    plt.xlabel('2Î¸ (degree)')
    plt.ylabel('Intensity')
    plt.title(f'Gaussian Filter (Ïƒ={sigma})')
    plt.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()</code></pre>

<h3>é©åˆ‡ãªãƒ•ã‚£ãƒ«ã‚¿ã®é¸æŠ</h3>

<div class="mermaid">flowchart TD
    Start[ãƒã‚¤ã‚ºé™¤å»ãŒå¿…è¦] --> Q1{ãƒ”ãƒ¼ã‚¯å½¢çŠ¶ã®ä¿æŒã¯é‡è¦?}
    Q1 -->|éå¸¸ã«é‡è¦| SG[Savitzky-Golay]
    Q1 -->|ã‚„ã‚„é‡è¦| Gauss[Gaussian]
    Q1 -->|ãã‚Œã»ã©é‡è¦ã§ãªã„| MA[Moving Average]

    SG --> Param1[window=11-21<br/>polyorder=2-3]
    Gauss --> Param2[sigma=1-3]
    MA --> Param3[window=7-15]

    style Start fill:#4CAF50,color:#fff
    style SG fill:#2196F3,color:#fff
    style Gauss fill:#FF9800,color:#fff
    style MA fill:#9C27B0,color:#fff</div>

---

<h2>1.4 å¤–ã‚Œå€¤æ¤œå‡º</h2>

å¤–ã‚Œå€¤ï¼ˆoutlierï¼‰ã¯ã€æ¸¬å®šã‚¨ãƒ©ãƒ¼ã€è£…ç½®ã®ä¸èª¿ã€ã‚µãƒ³ãƒ—ãƒ«æ±šæŸ“ãªã©ã«ã‚ˆã‚Šç™ºç”Ÿã—ã¾ã™ã€‚é©åˆ‡ã«æ¤œå‡ºãƒ»å‡¦ç†ã—ãªã„ã¨ã€è§£æçµæœã«é‡å¤§ãªå½±éŸ¿ã‚’åŠã¼ã—ã¾ã™ã€‚

<h3>Z-score æ³•</h3>

çµ±è¨ˆçš„ã«ã€Œå¹³å‡ã‹ã‚‰æ¨™æº–åå·®ã®â—‹å€ä»¥ä¸Šé›¢ã‚Œã¦ã„ã‚‹ã€ãƒ‡ãƒ¼ã‚¿ã‚’å¤–ã‚Œå€¤ã¨ã¿ãªã—ã¾ã™ã€‚

<strong>ã‚³ãƒ¼ãƒ‰ä¾‹7: Z-score ã«ã‚ˆã‚‹å¤–ã‚Œå€¤æ¤œå‡º</strong>

<pre><code class="language-python">from scipy import stats

<h1>å¤–ã‚Œå€¤ã‚’å«ã‚€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿</h1>
data_with_outliers = df_cleaned['intensity'].copy()
<h1>æ„å›³çš„ã«å¤–ã‚Œå€¤ã‚’è¿½åŠ </h1>
outlier_indices = [50, 150, 350, 550]
data_with_outliers.iloc[outlier_indices] = [3000, -500, 4000, 3500]

<h1>Z-scoreè¨ˆç®—</h1>
z_scores = np.abs(stats.zscore(data_with_outliers))
threshold = 3  # 3Ïƒã‚’è¶…ãˆã‚‹ã‚‚ã®ã‚’å¤–ã‚Œå€¤ã¨ã™ã‚‹

outliers = z_scores > threshold

print(f"=== Z-score å¤–ã‚Œå€¤æ¤œå‡º ===")
print(f"å¤–ã‚Œå€¤ã®æ•°: {outliers.sum()} / {len(data_with_outliers)}")
print(f"å¤–ã‚Œå€¤ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: {np.where(outliers)[0]}")

<h1>å¯è¦–åŒ–</h1>
plt.figure(figsize=(12, 5))

plt.subplot(1, 2, 1)
plt.plot(df_cleaned['two_theta'], data_with_outliers, label='Data with outliers')
plt.scatter(df_cleaned['two_theta'][outliers], data_with_outliers[outliers],
            color='red', s=100, zorder=5, label='Detected outliers')
plt.xlabel('2Î¸ (degree)')
plt.ylabel('Intensity')
plt.title('Outlier Detection (Z-score method)')
plt.legend()
plt.grid(True, alpha=0.3)

<h1>å¤–ã‚Œå€¤é™¤å»å¾Œ</h1>
data_cleaned = data_with_outliers.copy()
data_cleaned[outliers] = np.nan
data_cleaned = data_cleaned.interpolate(method='linear')

plt.subplot(1, 2, 2)
plt.plot(df_cleaned['two_theta'], data_cleaned, color='green', label='Cleaned data')
plt.xlabel('2Î¸ (degree)')
plt.ylabel('Intensity')
plt.title('After Outlier Removal')
plt.legend()
plt.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()</code></pre>

<h3>IQRï¼ˆå››åˆ†ä½ç¯„å›²ï¼‰æ³•</h3>

ä¸­å¤®å€¤ãƒ™ãƒ¼ã‚¹ã®é ‘å¥ãªæ‰‹æ³•ã§ã€æ­£è¦åˆ†å¸ƒã§ãªã„ãƒ‡ãƒ¼ã‚¿ã«ã‚‚é©ç”¨å¯èƒ½ã§ã™ã€‚

<strong>ã‚³ãƒ¼ãƒ‰ä¾‹8: IQR æ³•</strong>

<pre><code class="language-python"><h1>IQRæ³•ã«ã‚ˆã‚‹å¤–ã‚Œå€¤æ¤œå‡º</h1>
Q1 = data_with_outliers.quantile(0.25)
Q3 = data_with_outliers.quantile(0.75)
IQR = Q3 - Q1

<h1>å¤–ã‚Œå€¤ã®å®šç¾©: Q1 - 1.5*IQR æœªæº€ã€ã¾ãŸã¯ Q3 + 1.5*IQR è¶…</h1>
lower_bound = Q1 - 1.5 * IQR
upper_bound = Q3 + 1.5 * IQR

outliers_iqr = (data_with_outliers < lower_bound) | (data_with_outliers > upper_bound)

print(f"=== IQR å¤–ã‚Œå€¤æ¤œå‡º ===")
print(f"Q1: {Q1:.1f}")
print(f"Q3: {Q3:.1f}")
print(f"IQR: {IQR:.1f}")
print(f"ä¸‹é™: {lower_bound:.1f}")
print(f"ä¸Šé™: {upper_bound:.1f}")
print(f"å¤–ã‚Œå€¤ã®æ•°: {outliers_iqr.sum()} / {len(data_with_outliers)}")

<h1>ç®±ã²ã’å›³ã§å¯è¦–åŒ–</h1>
fig, axes = plt.subplots(1, 2, figsize=(12, 5))

axes[0].boxplot(data_with_outliers.dropna(), vert=True)
axes[0].set_ylabel('Intensity')
axes[0].set_title('Box Plot (outliers visible)')
axes[0].grid(True, alpha=0.3)

<h1>å¤–ã‚Œå€¤é™¤å»å¾Œ</h1>
data_cleaned_iqr = data_with_outliers.copy()
data_cleaned_iqr[outliers_iqr] = np.nan
data_cleaned_iqr = data_cleaned_iqr.interpolate(method='linear')

axes[1].boxplot(data_cleaned_iqr.dropna(), vert=True)
axes[1].set_ylabel('Intensity')
axes[1].set_title('Box Plot (after outlier removal)')
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()</code></pre>

<strong>Z-score vs IQR ã®ä½¿ã„åˆ†ã‘</strong>:
- <strong>Z-scoreæ³•</strong>: ãƒ‡ãƒ¼ã‚¿ãŒæ­£è¦åˆ†å¸ƒã«è¿‘ã„å ´åˆã«æœ‰åŠ¹ã€è¨ˆç®—ãŒç°¡å˜
- <strong>IQRæ³•</strong>: éæ­£è¦åˆ†å¸ƒã§ã‚‚é ‘å¥ã€æ¥µç«¯ãªå¤–ã‚Œå€¤ã«å¼·ã„

---

<h2>1.5 æ¨™æº–åŒ–ãƒ»æ­£è¦åŒ–</h2>

ç•°ãªã‚‹ã‚¹ã‚±ãƒ¼ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¯”è¼ƒå¯èƒ½ã«ã™ã‚‹ãŸã‚ã€æ¨™æº–åŒ–ãƒ»æ­£è¦åŒ–ãŒå¿…è¦ã§ã™ã€‚

<h3>Min-Max ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°</h3>

ãƒ‡ãƒ¼ã‚¿ã‚’[0, 1]ã®ç¯„å›²ã«å¤‰æ›ã—ã¾ã™ã€‚

$$
X_{\text{normalized}} = \frac{X - X_{\min}}{X_{\max} - X_{\min}}
$$

<h3>Z-score æ¨™æº–åŒ–</h3>

å¹³å‡0ã€æ¨™æº–åå·®1ã«å¤‰æ›ã—ã¾ã™ã€‚

$$
X_{\text{standardized}} = \frac{X - \mu}{\sigma}
$$

<h3>ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³è£œæ­£</h3>

ã‚¹ãƒšã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã§ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’é™¤å»ã—ã¾ã™ã€‚

<strong>å®Ÿè£…ã¯ç¬¬2ç« ã§è©³è¿°</strong>

---

<h2>1.6 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

1. <strong>å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿è§£æã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</strong>
   - ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ â†’ å‰å‡¦ç† â†’ ç‰¹å¾´æŠ½å‡º â†’ è§£æ â†’ å¯è¦–åŒ–
   - å‰å‡¦ç†ã®é‡è¦æ€§ã¨å½±éŸ¿

2. <strong>ãƒã‚¤ã‚ºé™¤å»æ‰‹æ³•</strong>
   - ç§»å‹•å¹³å‡ã€Savitzky-Golayã€ã‚¬ã‚¦ã‚·ã‚¢ãƒ³ãƒ•ã‚£ãƒ«ã‚¿
   - é©åˆ‡ãªæ‰‹æ³•ã®é¸æŠåŸºæº–

3. <strong>å¤–ã‚Œå€¤æ¤œå‡º</strong>
   - Z-scoreæ³•ã€IQRæ³•
   - ç‰©ç†çš„å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯

4. <strong>æ¨™æº–åŒ–ãƒ»æ­£è¦åŒ–</strong>
   - Min-Maxã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã€Z-scoreæ¨™æº–åŒ–
   - ä½¿ã„åˆ†ã‘ã®åŸå‰‡

<h3>é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ</h3>

- âœ… å‰å‡¦ç†ã¯ãƒ‡ãƒ¼ã‚¿è§£æã®æˆå¦ã‚’å·¦å³ã™ã‚‹æœ€é‡è¦ã‚¹ãƒ†ãƒƒãƒ—
- âœ… ãƒã‚¤ã‚ºé™¤å»ã§ã¯ã€ãƒ”ãƒ¼ã‚¯å½¢çŠ¶ä¿æŒã¨ãƒã‚¤ã‚ºå‰Šæ¸›ã®ãƒãƒ©ãƒ³ã‚¹ãŒé‡è¦
- âœ… å¤–ã‚Œå€¤ã¯å¿…ãšç¢ºèªã—ã€ç‰©ç†çš„å¦¥å½“æ€§ã‚’æ¤œè¨¼ã™ã‚‹
- âœ… å¯è¦–åŒ–ã«ã‚ˆã‚Šã€å„å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã®åŠ¹æœã‚’ç¢ºèªã™ã‚‹

<h3>æ¬¡ã®ç« ã¸</h3>

ç¬¬2ç« ã§ã¯ã€ã‚¹ãƒšã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆXRDã€XPSã€IRã€Ramanï¼‰ã®è§£ææ‰‹æ³•ã‚’å­¦ã³ã¾ã™ï¼š
- ãƒ”ãƒ¼ã‚¯æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é™¤å»
- å®šé‡åˆ†æ
- æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹ææ–™åŒå®š

<strong>[ç¬¬2ç« ï¼šã‚¹ãƒšã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿è§£æ â†’](./chapter-2.md)</strong>

---

<h2>æ¼”ç¿’å•é¡Œ</h2>

<h3>å•é¡Œ1ï¼ˆé›£æ˜“åº¦ï¼šeasyï¼‰</h3>

æ¬¡ã®æ–‡ç« ã®æ­£èª¤ã‚’åˆ¤å®šã—ã¦ãã ã•ã„ã€‚

1. ç§»å‹•å¹³å‡ãƒ•ã‚£ãƒ«ã‚¿ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’å¤§ããã™ã‚‹ã¨ã€ãƒã‚¤ã‚ºé™¤å»åŠ¹æœãŒé«˜ã¾ã‚‹ãŒã€ãƒ”ãƒ¼ã‚¯ãŒåºƒãŒã‚‹
2. Savitzky-Golayãƒ•ã‚£ãƒ«ã‚¿ã¯ç§»å‹•å¹³å‡ã‚ˆã‚Šã‚‚ãƒ”ãƒ¼ã‚¯å½¢çŠ¶ã‚’ä¿æŒã™ã‚‹
3. Z-scoreæ³•ã¯éæ­£è¦åˆ†å¸ƒã®ãƒ‡ãƒ¼ã‚¿ã«ã¯é©ç”¨ã§ããªã„

<details>
<summary>ãƒ’ãƒ³ãƒˆ</summary>

1. ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã¨ãƒã‚¤ã‚ºé™¤å»åŠ¹æœã€ãƒ”ãƒ¼ã‚¯å½¢çŠ¶ã®é–¢ä¿‚ã‚’è€ƒãˆã‚‹
2. ä¸¡æ‰‹æ³•ã®æ•°å­¦çš„ãªé•ã„ã‚’æ€ã„å‡ºã™
3. Z-scoreã®å®šç¾©ã¨ã€éæ­£è¦åˆ†å¸ƒã§ã®æŒ™å‹•ã‚’è€ƒãˆã‚‹

</details>

<details>
<summary>è§£ç­”ä¾‹</summary>

<strong>è§£ç­”</strong>:
1. <strong>æ­£</strong> - å¤§ãã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¯ã‚ˆã‚Šå¤šãã®ç‚¹ã‚’å¹³å‡ã™ã‚‹ãŸã‚ã€ãƒã‚¤ã‚ºã¯æ¸›ã‚‹ãŒãƒ”ãƒ¼ã‚¯ã‚‚å¹³æ»‘åŒ–ã•ã‚Œã‚‹
2. <strong>æ­£</strong> - Savitzky-Golayã¯å¤šé …å¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚’ä½¿ã†ãŸã‚ã€æ€¥å³»ãªå¤‰åŒ–ã‚’ä¿æŒã—ã‚„ã™ã„
3. <strong>èª¤</strong> - Z-scoreã¯è¨ˆç®—å¯èƒ½ã ãŒã€3Ïƒãƒ«ãƒ¼ãƒ«ã®è§£é‡ˆã¯æ­£è¦åˆ†å¸ƒã‚’ä»®å®šã—ã¦ã„ã‚‹ã€‚éæ­£è¦åˆ†å¸ƒã§ã¯IQRæ³•ãŒæ¨å¥¨ã•ã‚Œã‚‹

<strong>è§£èª¬</strong>:
ãƒã‚¤ã‚ºé™¤å»ã¯å¸¸ã«ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ãŒã‚ã‚Šã¾ã™ã€‚ãƒã‚¤ã‚ºã‚’å®Œå…¨ã«é™¤å»ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ä¿¡å·ã‚‚æ­ªã¿ã¾ã™ã€‚å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®ç‰¹æ€§ï¼ˆãƒã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã€ãƒ”ãƒ¼ã‚¯ã®é‹­ã•ï¼‰ã«å¿œã˜ã¦ã€é©åˆ‡ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é¸æŠã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

</details>

---

<h3>å•é¡Œ2ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>

ä»¥ä¸‹ã®XRDãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰ã«å¯¾ã—ã¦ã€é©åˆ‡ãªå‰å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã—ã¦ãã ã•ã„ã€‚

<pre><code class="language-python"><h1>ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿</h1>
import numpy as np
import pandas as pd

np.random.seed(100)
two_theta = np.linspace(20, 60, 400)
intensity = (
    800 * np.exp(-((two_theta - 30) ** 2) / 8) +
    1200 * np.exp(-((two_theta - 45) ** 2) / 6) +
    np.random.normal(0, 100, len(two_theta))
)
<h1>å¤–ã‚Œå€¤ã‚’è¿½åŠ </h1>
intensity[50] = 3000
intensity[200] = -500

df = pd.DataFrame({'two_theta': two_theta, 'intensity': intensity})</code></pre>

<strong>è¦æ±‚äº‹é …</strong>:
1. è² ã®å¼·åº¦å€¤ã‚’0ã«ç½®ãæ›ãˆã‚‹
2. Z-scoreã§å¤–ã‚Œå€¤ã‚’æ¤œå‡ºãƒ»é™¤å»ï¼ˆé–¾å€¤3Ïƒï¼‰
3. Savitzky-Golayãƒ•ã‚£ãƒ«ã‚¿ã§ãƒã‚¤ã‚ºé™¤å»ï¼ˆwindow=11, polyorder=3ï¼‰
4. å‡¦ç†å‰å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–

<details>
<summary>ãƒ’ãƒ³ãƒˆ</summary>

<strong>å‡¦ç†ãƒ•ãƒ­ãƒ¼</strong>:
1. è² ã®å€¤ã®ãƒã‚¹ã‚¯ä½œæˆ â†’ 0ã«ç½®ãæ›ãˆ
2. <code>scipy.stats.zscore</code> ã§å¤–ã‚Œå€¤æ¤œå‡º
3. å¤–ã‚Œå€¤ã‚’ç·šå½¢è£œé–“
4. <code>scipy.signal.savgol_filter</code> ã§ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°
5. <code>matplotlib</code> ã§å…ƒãƒ‡ãƒ¼ã‚¿ã¨å‡¦ç†å¾Œãƒ‡ãƒ¼ã‚¿ã‚’æ¯”è¼ƒ

<strong>ä½¿ç”¨ã™ã‚‹é–¢æ•°</strong>:
- <code>df[condition]</code> ã§æ¡ä»¶æŠ½å‡º
- <code>np.abs(stats.zscore())</code> ã§Z-score
- <code>interpolate(method='linear')</code> ã§è£œé–“
- <code>savgol_filter()</code> ã§ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°

</details>

<details>
<summary>è§£ç­”ä¾‹</summary>

<pre><code class="language-python">import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy import stats
from scipy.signal import savgol_filter

<h1>ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿</h1>
np.random.seed(100)
two_theta = np.linspace(20, 60, 400)
intensity = (
    800 * np.exp(-((two_theta - 30) ** 2) / 8) +
    1200 * np.exp(-((two_theta - 45) ** 2) / 6) +
    np.random.normal(0, 100, len(two_theta))
)
intensity[50] = 3000
intensity[200] = -500

df = pd.DataFrame({'two_theta': two_theta, 'intensity': intensity})

<h1>ã‚¹ãƒ†ãƒƒãƒ—1: è² ã®å€¤ã‚’0ã«ç½®ãæ›ãˆ</h1>
df_cleaned = df.copy()
negative_mask = df_cleaned['intensity'] < 0
df_cleaned.loc[negative_mask, 'intensity'] = 0
print(f"è² ã®å€¤ã®æ•°: {negative_mask.sum()}")

<h1>ã‚¹ãƒ†ãƒƒãƒ—2: å¤–ã‚Œå€¤æ¤œå‡ºï¼ˆZ-scoreæ³•ï¼‰</h1>
z_scores = np.abs(stats.zscore(df_cleaned['intensity']))
outliers = z_scores > 3
print(f"å¤–ã‚Œå€¤ã®æ•°: {outliers.sum()}")

<h1>ã‚¹ãƒ†ãƒƒãƒ—3: å¤–ã‚Œå€¤ã‚’è£œé–“</h1>
df_cleaned.loc[outliers, 'intensity'] = np.nan
df_cleaned['intensity'] = df_cleaned['intensity'].interpolate(method='linear')

<h1>ã‚¹ãƒ†ãƒƒãƒ—4: Savitzky-Golayãƒ•ã‚£ãƒ«ã‚¿</h1>
intensity_smoothed = savgol_filter(df_cleaned['intensity'].values, window_length=11, polyorder=3)

<h1>å¯è¦–åŒ–</h1>
fig, axes = plt.subplots(2, 2, figsize=(12, 10))

<h1>å…ƒãƒ‡ãƒ¼ã‚¿</h1>
axes[0, 0].plot(df['two_theta'], df['intensity'], linewidth=1)
axes[0, 0].set_title('Original Data (with outliers)')
axes[0, 0].set_xlabel('2Î¸ (degree)')
axes[0, 0].set_ylabel('Intensity')
axes[0, 0].grid(True, alpha=0.3)

<h1>å¤–ã‚Œå€¤é™¤å»å¾Œ</h1>
axes[0, 1].plot(df_cleaned['two_theta'], df_cleaned['intensity'], linewidth=1, color='orange')
axes[0, 1].set_title('After Outlier Removal')
axes[0, 1].set_xlabel('2Î¸ (degree)')
axes[0, 1].set_ylabel('Intensity')
axes[0, 1].grid(True, alpha=0.3)

<h1>ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°å¾Œ</h1>
axes[1, 0].plot(df_cleaned['two_theta'], intensity_smoothed, linewidth=1.5, color='green')
axes[1, 0].set_title('After Savitzky-Golay Smoothing')
axes[1, 0].set_xlabel('2Î¸ (degree)')
axes[1, 0].set_ylabel('Intensity')
axes[1, 0].grid(True, alpha=0.3)

<h1>å…¨æ¯”è¼ƒ</h1>
axes[1, 1].plot(df['two_theta'], df['intensity'], label='Original', alpha=0.4, linewidth=1)
axes[1, 1].plot(df_cleaned['two_theta'], intensity_smoothed, label='Processed', linewidth=1.5)
axes[1, 1].set_title('Comparison')
axes[1, 1].set_xlabel('2Î¸ (degree)')
axes[1, 1].set_ylabel('Intensity')
axes[1, 1].legend()
axes[1, 1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()</code></pre>

<strong>å‡ºåŠ›</strong>:
<pre><code>è² ã®å€¤ã®æ•°: 1
å¤–ã‚Œå€¤ã®æ•°: 2</code></pre>

<strong>è§£èª¬</strong>:
ã“ã®å‰å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ã€ç‰©ç†çš„ã«ä¸å¯èƒ½ãªè² ã®å€¤ã‚’é™¤å»ã—ã€çµ±è¨ˆçš„å¤–ã‚Œå€¤ã‚’æ¤œå‡ºãƒ»è£œé–“ã—ã€æœ€å¾Œã«ãƒã‚¤ã‚ºã‚’é™¤å»ã—ã¦ã„ã¾ã™ã€‚å‡¦ç†ã®é †åºãŒé‡è¦ã§ã€å¤–ã‚Œå€¤é™¤å»ã‚’ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã®å‰ã«è¡Œã†ã“ã¨ã§ã€å¤–ã‚Œå€¤ã®å½±éŸ¿ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‰ã‚Œã¾ã™ã€‚

</details>

---

<h3>å•é¡Œ3ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>

å®Ÿéš›ã®ææ–™ç ”ç©¶ã‚·ãƒŠãƒªã‚ªï¼šãƒã‚¤ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆXRDæ¸¬å®šã§1000ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸã€‚å„ã‚µãƒ³ãƒ—ãƒ«ã«ã¤ã„ã¦ã€å‰å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’è‡ªå‹•åŒ–ã—ã€å‡¦ç†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¦ãã ã•ã„ã€‚

<strong>èƒŒæ™¯</strong>:
è‡ªå‹•XRDè£…ç½®ã‹ã‚‰æ¯æ—¥100ã‚µãƒ³ãƒ—ãƒ«ã®æ¸¬å®šãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚æ‰‹å‹•å‡¦ç†ã¯ä¸å¯èƒ½ãªãŸã‚ã€è‡ªå‹•åŒ–ãŒå¿…é ˆã§ã™ã€‚

<strong>èª²é¡Œ</strong>:
1. è¤‡æ•°ã‚µãƒ³ãƒ—ãƒ«ã®å‰å‡¦ç†ã‚’ä¸€æ‹¬å®Ÿè¡Œã™ã‚‹é–¢æ•°ã‚’ä½œæˆ
2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆä¸æ­£ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã€æ¥µç«¯ãªå¤–ã‚Œå€¤ï¼‰
3. å‡¦ç†çµæœã®ãƒ­ã‚°å‡ºåŠ›
4. å‡¦ç†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜

<strong>åˆ¶ç´„æ¡ä»¶</strong>:
- å„ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°ã¯ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- ä¸€éƒ¨ã®ã‚µãƒ³ãƒ—ãƒ«ã¯æ¸¬å®šå¤±æ•—ã§ä¸å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ã®å¯èƒ½æ€§
- å‡¦ç†ã¯5ç§’ä»¥å†…/ã‚µãƒ³ãƒ—ãƒ«

<details>
<summary>ãƒ’ãƒ³ãƒˆ</summary>

<strong>ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</strong>:
1. å‰å‡¦ç†ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ãŸé–¢æ•°ã‚’å®šç¾©
2. <code>try-except</code> ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
3. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡¦ç†çµæœã‚’è¨˜éŒ²
4. <code>pandas.to_csv()</code> ã§ä¿å­˜

<strong>è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³</strong>:
<pre><code class="language-python">def preprocess_xrd(data, params):
    """XRDãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†"""
    # 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    # 2. è² ã®å€¤é™¤å»
    # 3. å¤–ã‚Œå€¤æ¤œå‡º
    # 4. ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°
    # 5. çµæœã‚’è¿”ã™
    pass

def batch_process(file_list):
    """è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€æ‹¬å‡¦ç†"""
    for file in file_list:
        try:
            # ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            # å‰å‡¦ç†å®Ÿè¡Œ
            # ä¿å­˜
        except Exception as e:
            # ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
            pass</code></pre>

</details>

<details>
<summary>è§£ç­”ä¾‹</summary>

<strong>è§£ç­”ã®æ¦‚è¦</strong>:
è¤‡æ•°ã‚µãƒ³ãƒ—ãƒ«ã®XRDãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å‡¦ç†ã™ã‚‹å …ç‰¢ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ­ã‚°å‡ºåŠ›ã€å‡¦ç†æ™‚é–“æ¸¬å®šã‚’å«ã¿ã¾ã™ã€‚

<strong>å®Ÿè£…ã‚³ãƒ¼ãƒ‰</strong>:

<pre><code class="language-python">import numpy as np
import pandas as pd
from scipy import stats
from scipy.signal import savgol_filter
import time
import logging
from pathlib import Path

<h1>ãƒ­ã‚®ãƒ³ã‚°è¨­å®š</h1>
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('xrd_processing.log'),
        logging.StreamHandler()
    ]
)

def validate_data(df):
    """ãƒ‡ãƒ¼ã‚¿ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯"""
    if df.empty:
        raise ValueError("Empty DataFrame")

    if 'two_theta' not in df.columns or 'intensity' not in df.columns:
        raise ValueError("Missing required columns")

    if len(df) < 50:
        raise ValueError(f"Insufficient data points: {len(df)}")

    if df['intensity'].isnull().sum() > len(df) * 0.3:
        raise ValueError("Too many missing values (>30%)")

    return True


def preprocess_xrd(df, params=None):
    """
    XRDãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

    Parameters:
    -----------
    df : pd.DataFrame
        ã‚«ãƒ©ãƒ : 'two_theta', 'intensity'
    params : dict
        å‰å‡¦ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        - z_threshold: Z-scoreé–¾å€¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3ï¼‰
        - sg_window: Savitzky-Golayã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 11ï¼‰
        - sg_polyorder: å¤šé …å¼æ¬¡æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3ï¼‰

    Returns:
    --------
    df_processed : pd.DataFrame
        å‰å‡¦ç†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿
    """
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    if params is None:
        params = {
            'z_threshold': 3,
            'sg_window': 11,
            'sg_polyorder': 3
        }

    # ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
    validate_data(df)

    df_processed = df.copy()

    # ã‚¹ãƒ†ãƒƒãƒ—1: è² ã®å€¤ã‚’0ã«
    negative_count = (df_processed['intensity'] < 0).sum()
    df_processed.loc[df_processed['intensity'] < 0, 'intensity'] = 0

    # ã‚¹ãƒ†ãƒƒãƒ—2: å¤–ã‚Œå€¤æ¤œå‡ºãƒ»è£œé–“
    z_scores = np.abs(stats.zscore(df_processed['intensity']))
    outliers = z_scores > params['z_threshold']
    outlier_count = outliers.sum()

    df_processed.loc[outliers, 'intensity'] = np.nan
    df_processed['intensity'] = df_processed['intensity'].interpolate(method='linear')

    # ã‚¹ãƒ†ãƒƒãƒ—3: Savitzky-Golayãƒ•ã‚£ãƒ«ã‚¿
    try:
        intensity_smoothed = savgol_filter(
            df_processed['intensity'].values,
            window_length=params['sg_window'],
            polyorder=params['sg_polyorder']
        )
        df_processed['intensity'] = intensity_smoothed
    except Exception as e:
        logging.warning(f"Savitzky-Golay failed: {e}. Using moving average.")
        from scipy.ndimage import uniform_filter1d
        df_processed['intensity'] = uniform_filter1d(
            df_processed['intensity'].values,
            size=params['sg_window']
        )

    # å‡¦ç†çµ±è¨ˆ
    stats_dict = {
        'negative_values': negative_count,
        'outliers': outlier_count,
        'data_points': len(df_processed)
    }

    return df_processed, stats_dict


def batch_process_xrd(input_files, output_dir, params=None):
    """
    è¤‡æ•°ã®XRDãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€æ‹¬å‡¦ç†

    Parameters:
    -----------
    input_files : list
        å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ãƒªã‚¹ãƒˆ
    output_dir : str or Path
        å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    params : dict
        å‰å‡¦ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

    Returns:
    --------
    results : dict
        å‡¦ç†çµæœã‚µãƒãƒªãƒ¼
    """
    output_dir = Path(output_dir)
    output_dir.mkdir(parents=True, exist_ok=True)

    results = {
        'total': len(input_files),
        'success': 0,
        'failed': 0,
        'processing_times': []
    }

    logging.info(f"Starting batch processing of {len(input_files)} files")

    for i, file_path in enumerate(input_files, 1):
        file_path = Path(file_path)
        start_time = time.time()

        try:
            # ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            df = pd.read_csv(file_path)

            # å‰å‡¦ç†å®Ÿè¡Œ
            df_processed, stats_dict = preprocess_xrd(df, params)

            # ä¿å­˜
            output_file = output_dir / f"processed_{file_path.name}"
            df_processed.to_csv(output_file, index=False)

            # å‡¦ç†æ™‚é–“
            processing_time = time.time() - start_time
            results['processing_times'].append(processing_time)
            results['success'] += 1

            logging.info(
                f"[{i}/{len(input_files)}] SUCCESS: {file_path.name} "
                f"({processing_time:.2f}s) - "
                f"Negatives: {stats_dict['negative_values']}, "
                f"Outliers: {stats_dict['outliers']}"
            )

        except Exception as e:
            results['failed'] += 1
            logging.error(f"[{i}/{len(input_files)}] FAILED: {file_path.name} - {str(e)}")

    # ã‚µãƒãƒªãƒ¼
    avg_time = np.mean(results['processing_times']) if results['processing_times'] else 0
    logging.info(
        f"\n=== Batch Processing Complete ===\n"
        f"Total: {results['total']}\n"
        f"Success: {results['success']}\n"
        f"Failed: {results['failed']}\n"
        f"Average processing time: {avg_time:.2f}s"
    )

    return results


<h1>==================== ãƒ‡ãƒ¢å®Ÿè¡Œ ====================</h1>

if __name__ == "__main__":
    # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆå®Ÿéš›ã¯å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼‰
    np.random.seed(42)

    # 10ã‚µãƒ³ãƒ—ãƒ«åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
    sample_dir = Path("sample_xrd_data")
    sample_dir.mkdir(exist_ok=True)

    for i in range(10):
        two_theta = np.linspace(20, 60, 400)
        intensity = (
            800 * np.exp(-((two_theta - 30) ** 2) / 8) +
            1200 * np.exp(-((two_theta - 45) ** 2) / 6) +
            np.random.normal(0, 100, len(two_theta))
        )

        # ãƒ©ãƒ³ãƒ€ãƒ ã«å¤–ã‚Œå€¤ã‚’è¿½åŠ 
        if np.random.rand() > 0.5:
            outlier_idx = np.random.randint(0, len(intensity), size=2)
            intensity[outlier_idx] = np.random.choice([3000, -500], size=2)

        df = pd.DataFrame({'two_theta': two_theta, 'intensity': intensity})
        df.to_csv(sample_dir / f"sample_{i:03d}.csv", index=False)

    # ãƒãƒƒãƒå‡¦ç†å®Ÿè¡Œ
    input_files = list(sample_dir.glob("sample_*.csv"))
    output_dir = Path("processed_xrd_data")

    params = {
        'z_threshold': 3,
        'sg_window': 11,
        'sg_polyorder': 3
    }

    results = batch_process_xrd(input_files, output_dir, params)

    print(f"\nå‡¦ç†å®Œäº†: {results['success']}/{results['total']} files")</code></pre>

<strong>çµæœ</strong>:
<pre><code>2025-10-17 10:30:15 - INFO - Starting batch processing of 10 files
2025-10-17 10:30:15 - INFO - [1/10] SUCCESS: sample_000.csv (0.15s) - Negatives: 1, Outliers: 2
2025-10-17 10:30:15 - INFO - [2/10] SUCCESS: sample_001.csv (0.12s) - Negatives: 0, Outliers: 1
...
2025-10-17 10:30:16 - INFO -
=== Batch Processing Complete ===
Total: 10
Success: 10
Failed: 0
Average processing time: 0.13s</code></pre>

<strong>è©³ç´°ãªè§£èª¬</strong>:
1. <strong>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</strong>: <code>validate_data()</code> ã§äº‹å‰ãƒã‚§ãƒƒã‚¯ã€<code>try-except</code> ã§å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼æ•æ‰
2. <strong>ãƒ­ã‚®ãƒ³ã‚°</strong>: å‡¦ç†çŠ¶æ³ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸¡æ–¹ã«å‡ºåŠ›
3. <strong>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–</strong>: å‰å‡¦ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤–éƒ¨ã‹ã‚‰æŒ‡å®šå¯èƒ½
4. <strong>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</strong>: å‡¦ç†æ™‚é–“ã‚’æ¸¬å®šã—ã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š
5. <strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong>: ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã«ä¾ã‚‰ãšå‹•ä½œ

<strong>è¿½åŠ ã®æ¤œè¨äº‹é …</strong>:
- ä¸¦åˆ—å‡¦ç†ï¼ˆ<code>multiprocessing</code>ï¼‰ã§é«˜é€ŸåŒ–
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆSQLiteï¼‰ã¸ã®ä¿å­˜
- Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å‡¦ç†çŠ¶æ³ã‚’å¯è¦–åŒ–
- ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆS3ã€GCSï¼‰ã¨ã®é€£æº

</details>

---

<h2>å‚è€ƒæ–‡çŒ®</h2>

1. VanderPlas, J. (2016). "Python Data Science Handbook." O'Reilly Media. ISBN: 978-1491912058

2. Savitzky, A., & Golay, M. J. (1964). "Smoothing and Differentiation of Data by Simplified Least Squares Procedures." *Analytical Chemistry*, 36(8), 1627-1639. DOI: [10.1021/ac60214a047](https://doi.org/10.1021/ac60214a047)

3. Stein, H. S. et al. (2019). "Progress and prospects for accelerating materials science with automated and autonomous workflows." *Chemical Science*, 10(42), 9640-9649. DOI: [10.1039/C9SC03766G](https://doi.org/10.1039/C9SC03766G)

4. SciPy Documentation: Signal Processing. URL: [https://docs.scipy.org/doc/scipy/reference/signal.html](https://docs.scipy.org/doc/scipy/reference/signal.html)

5. pandas Documentation: Data Cleaning. URL: [https://pandas.pydata.org/docs/user_guide/missing_data.html](https://pandas.pydata.org/docs/user_guide/missing_data.html)

---

<h2>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³</h2>

<h3>å‰ã®ç« </h3>
ãªã—ï¼ˆç¬¬1ç« ï¼‰

<h3>æ¬¡ã®ç« </h3>
<strong>[ç¬¬2ç« ï¼šã‚¹ãƒšã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿è§£æ â†’](./chapter-2.md)</strong>

<h3>ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡</h3>
<strong>[â† ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹](./index.md)</strong>

---

<h2>è‘—è€…æƒ…å ±</h2>

<strong>ä½œæˆè€…</strong>: AI Terakoya Content Team
<strong>ç›£ä¿®</strong>: Dr. Yusuke Hashimotoï¼ˆæ±åŒ—å¤§å­¦ï¼‰
<strong>ä½œæˆæ—¥</strong>: 2025-10-17
<strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0

<strong>æ›´æ–°å±¥æ­´</strong>:
- 2025-10-17: v1.0 åˆç‰ˆå…¬é–‹

<strong>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</strong>:
- GitHub Issues: [ãƒªãƒã‚¸ãƒˆãƒªURL]/issues
- Email: yusuke.hashimoto.b8@tohoku.ac.jp

<strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0

---

<strong>æ¬¡ã®ç« ã§å­¦ç¿’ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ï¼</strong>
<div class="navigation">
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
    <a href="chapter-2.html" class="nav-button">ç¬¬2ç«  â†’</a>
</div>
    </main>

    <footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ç›£ä¿®</strong>: Dr. Yusuke Hashimotoï¼ˆæ±åŒ—å¤§å­¦ï¼‰</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-17</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mermaidCodeBlocks = document.querySelectorAll('pre.codehilite code.language-mermaid, pre code.language-mermaid');

            mermaidCodeBlocks.forEach(function(codeBlock) {
                const pre = codeBlock.parentElement;
                const mermaidCode = codeBlock.textContent;

                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode.trim();

                pre.parentNode.replaceChild(mermaidDiv, pre);
            });

            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'default'
                });
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }
        });
    </script>
</body>
</html>
