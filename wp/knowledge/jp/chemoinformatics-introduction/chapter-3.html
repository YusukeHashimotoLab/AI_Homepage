<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬3ç« ï¼šåŒ–å­¦ç©ºé–“æ¢ç´¢ã¨é¡ä¼¼æ€§æ¤œç´¢ - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>åŒ–å­¦ç©ºé–“æ¢ç´¢ã¨é¡ä¼¼æ€§æ¤œç´¢</h1>
            <p class="subtitle"></p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 25-30åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 11å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 3å•</span>
            </div>
        </div>
    </header>

    <main class="container">

<h1>ç¬¬3ç« ï¼šåŒ–å­¦ç©ºé–“æ¢ç´¢ã¨é¡ä¼¼æ€§æ¤œç´¢</h1>

<h2>ã“ã®ç« ã§å­¦ã¶ã“ã¨</h2>

ã“ã®ç« ã§ã¯ã€åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–ã¨é¡ä¼¼æ€§æ¤œç´¢ã®æ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚è†¨å¤§ãªåŒ–åˆç‰©ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰æœ‰æœ›ãªå€™è£œã‚’åŠ¹ç‡çš„ã«æ¢ç´¢ã™ã‚‹æŠ€è¡“ã¯ã€å‰µè–¬ã¨ææ–™é–‹ç™ºã®åŠ é€Ÿã«ä¸å¯æ¬ ã§ã™ã€‚

<h3>å­¦ç¿’ç›®æ¨™</h3>

- âœ… åˆ†å­é¡ä¼¼æ€§ã®å®šç¾©ã¨è¨ˆç®—æ–¹æ³•ã‚’ç†è§£ã—ã¦ã„ã‚‹
- âœ… t-SNE/UMAPã§åŒ–å­¦ç©ºé–“ã‚’å¯è¦–åŒ–ã§ãã‚‹
- âœ… ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã§åˆ†å­ã‚’åˆ†é¡ã§ãã‚‹
- âœ… ä»®æƒ³ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã§å€™è£œåˆ†å­ã‚’åŠ¹ç‡çš„ã«æ¢ç´¢ã§ãã‚‹
- âœ… åˆæˆå¯èƒ½æ€§ã‚’è€ƒæ…®ã—ãŸç¾å®Ÿçš„ãªå€™è£œé¸å®šãŒã§ãã‚‹

---

<h2>3.1 åˆ†å­é¡ä¼¼æ€§ã®å®šç¾©</h2>

<strong>åˆ†å­é¡ä¼¼æ€§ï¼ˆMolecular Similarityï¼‰</strong>ã¯ã€2ã¤ã®åˆ†å­ãŒã©ã‚Œã»ã©ä¼¼ã¦ã„ã‚‹ã‹ã‚’å®šé‡åŒ–ã™ã‚‹å°ºåº¦ã§ã™ã€‚

<pre><code class="language-mermaid">graph TD
    A[åˆ†å­A] --> C[æŒ‡ç´‹è¨ˆç®—]
    B[åˆ†å­B] --> C
    C --> D[Tanimotoä¿‚æ•°]
    C --> E[Diceä¿‚æ•°]
    C --> F[Cosineé¡ä¼¼åº¦]

    D --> G[é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢<br/>0.0 - 1.0]
    E --> G
    F --> G

    G --> H{é–¾å€¤åˆ¤å®š}
    H -->|â‰¥ 0.7| I[é¡ä¼¼]
    H -->|< 0.7| J[éé¡ä¼¼]

    style A fill:#e3f2fd
    style B fill:#e3f2fd
    style I fill:#4CAF50,color:#fff
    style J fill:#F44336,color:#fff</code></pre>

<h3>3.1.1 Tanimotoä¿‚æ•°ï¼ˆJaccardé¡ä¼¼åº¦ï¼‰</h3>

Tanimotoä¿‚æ•°ã¯ã€æŒ‡ç´‹ãƒ™ãƒ¼ã‚¹ã®é¡ä¼¼åº¦è¨ˆç®—ã§æœ€ã‚‚åºƒãä½¿ã‚ã‚Œã‚‹æŒ‡æ¨™ã§ã™ã€‚

<strong>å®šç¾©</strong>:
$$
T(A, B) = \frac{|A \cap B|}{|A \cup B|} = \frac{c}{a + b - c}
$$

where:
- $a$: åˆ†å­Aã§ç«‹ã£ã¦ã„ã‚‹ãƒ“ãƒƒãƒˆæ•°
- $b$: åˆ†å­Bã§ç«‹ã£ã¦ã„ã‚‹ãƒ“ãƒƒãƒˆæ•°
- $c$: ä¸¡æ–¹ã§ç«‹ã£ã¦ã„ã‚‹ãƒ“ãƒƒãƒˆæ•°

<strong>ç¯„å›²</strong>: 0.0ï¼ˆå®Œå…¨ã«ç•°ãªã‚‹ï¼‰ã€œ 1.0ï¼ˆå®Œå…¨ã«ä¸€è‡´ï¼‰

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹1: Tanimotoä¿‚æ•°ã®è¨ˆç®—</h4>

<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import AllChem, DataStructs
import numpy as np

<h1>ã‚µãƒ³ãƒ—ãƒ«åˆ†å­</h1>
molecules = {
    "Aspirin": "CC(=O)Oc1ccccc1C(=O)O",
    "Salicylic acid": "C1=CC=C(C(=C1)C(=O)O)O",
    "Ibuprofen": "CC(C)Cc1ccc(cc1)C(C)C(=O)O",
    "Paracetamol": "CC(=O)Nc1ccc(O)cc1",
    "Caffeine": "CN1C=NC2=C1C(=O)N(C(=O)N2C)C"
}

<h1>MorganæŒ‡ç´‹ã®è¨ˆç®—</h1>
fingerprints = {}
for name, smiles in molecules.items():
    mol = Chem.MolFromSmiles(smiles)
    fp = AllChem.GetMorganFingerprintAsBitVect(
        mol, radius=2, nBits=2048
    )
    fingerprints[name] = fp

<h1>Tanimotoé¡ä¼¼åº¦è¡Œåˆ—ã®è¨ˆç®—</h1>
mol_names = list(molecules.keys())
n_mols = len(mol_names)
similarity_matrix = np.zeros((n_mols, n_mols))

for i, name1 in enumerate(mol_names):
    for j, name2 in enumerate(mol_names):
        sim = DataStructs.TanimotoSimilarity(
            fingerprints[name1],
            fingerprints[name2]
        )
        similarity_matrix[i, j] = sim

<h1>çµæœã®è¡¨ç¤º</h1>
import pandas as pd

df_sim = pd.DataFrame(
    similarity_matrix,
    index=mol_names,
    columns=mol_names
)

print("Tanimotoé¡ä¼¼åº¦è¡Œåˆ—:")
print(df_sim.round(3))</code></pre>

<strong>å‡ºåŠ›ä¾‹:</strong>
<pre><code>Tanimotoé¡ä¼¼åº¦è¡Œåˆ—:
                Aspirin  Salicylic acid  Ibuprofen  Paracetamol  Caffeine
Aspirin           1.000           0.538      0.328        0.287     0.152
Salicylic acid    0.538           1.000      0.241        0.315     0.137
Ibuprofen         0.328           0.241      1.000        0.224     0.098
Paracetamol       0.287           0.315      0.224        1.000     0.189
Caffeine          0.152           0.137      0.098        0.189     1.000</code></pre>

<strong>è§£é‡ˆ</strong>:
- ã‚¢ã‚¹ãƒ”ãƒªãƒ³ã¨ã‚µãƒªãƒãƒ«é…¸ã¯é«˜ã„é¡ä¼¼åº¦ï¼ˆ0.538ï¼‰
- ã‚«ãƒ•ã‚§ã‚¤ãƒ³ã¯ä»–ã®åˆ†å­ã¨æ§‹é€ ãŒå¤§ããç•°ãªã‚‹

<h3>3.1.2 ãã®ä»–ã®é¡ä¼¼åº¦æŒ‡æ¨™</h3>

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹2: è¤‡æ•°ã®é¡ä¼¼åº¦æŒ‡æ¨™ã®æ¯”è¼ƒ</h4>

<pre><code class="language-python">from rdkit import DataStructs

<h1>2ã¤ã®åˆ†å­</h1>
mol1 = Chem.MolFromSmiles("CC(=O)Oc1ccccc1C(=O)O")  # Aspirin
mol2 = Chem.MolFromSmiles("C1=CC=C(C(=C1)C(=O)O)O")  # Salicylic acid

fp1 = AllChem.GetMorganFingerprintAsBitVect(mol1, 2, 2048)
fp2 = AllChem.GetMorganFingerprintAsBitVect(mol2, 2, 2048)

<h1>å„ç¨®é¡ä¼¼åº¦æŒ‡æ¨™</h1>
similarities = {
    'Tanimoto': DataStructs.TanimotoSimilarity(fp1, fp2),
    'Dice': DataStructs.DiceSimilarity(fp1, fp2),
    'Cosine': DataStructs.CosineSimilarity(fp1, fp2),
    'Sokal': DataStructs.SokalSimilarity(fp1, fp2),
    'Kulczynski': DataStructs.KulczynskiSimilarity(fp1, fp2),
    'McConnaughey': DataStructs.McConnaugheySimilarity(fp1, fp2)
}

print("ã‚¢ã‚¹ãƒ”ãƒªãƒ³ vs ã‚µãƒªãƒãƒ«é…¸ã®é¡ä¼¼åº¦:")
for name, sim in similarities.items():
    print(f"  {name:15s}: {sim:.3f}")</code></pre>

<strong>å‡ºåŠ›ä¾‹:</strong>
<pre><code>ã‚¢ã‚¹ãƒ”ãƒªãƒ³ vs ã‚µãƒªãƒãƒ«é…¸ã®é¡ä¼¼åº¦:
  Tanimoto       : 0.538
  Dice           : 0.700
  Cosine         : 0.733
  Sokal          : 0.368
  Kulczynski     : 0.705
  McConnaughey   : 0.076</code></pre>

<h3>3.1.3 é¡ä¼¼æ€§ã®é–¾å€¤è¨­å®š</h3>

<strong>ä¸€èˆ¬çš„ãªã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</strong>:

| Tanimotoä¿‚æ•° | è§£é‡ˆ | å¿œç”¨ |
|--------------|------|------|
| <strong>0.85 - 1.00</strong> | éå¸¸ã«é¡ä¼¼ | é‡è¤‡é™¤å»ã€ãƒã‚¤ã‚ªã‚¢ã‚¤ã‚½ã‚¹ã‚¿ãƒ¼ |
| <strong>0.70 - 0.84</strong> | é¡ä¼¼ | ãƒªãƒ¼ãƒ‰æœ€é©åŒ–ã€scaffold hopping |
| <strong>0.50 - 0.69</strong> | ã‚„ã‚„é¡ä¼¼ | é¡ä¼¼åŒ–åˆç‰©æ¤œç´¢ã®æ‹¡å¼µ |
| <strong>< 0.50</strong> | éé¡ä¼¼ | å¤šæ§˜æ€§ç¢ºä¿ |

---

<h2>3.2 åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–</h2>

åŒ–å­¦ç©ºé–“ï¼ˆChemical Spaceï¼‰ã¯ã€åˆ†å­è¨˜è¿°å­ã‚’è»¸ã¨ã—ãŸå¤šæ¬¡å…ƒç©ºé–“ã§ã™ã€‚æ¬¡å…ƒå‰Šæ¸›ã«ã‚ˆã‚Š2D/3Dã«æŠ•å½±ã—ã€å¯è¦–åŒ–ã§ãã¾ã™ã€‚

<pre><code class="language-mermaid">graph LR
    A[é«˜æ¬¡å…ƒè¨˜è¿°å­<br/>1024æ¬¡å…ƒ] --> B[æ¬¡å…ƒå‰Šæ¸›]
    B --> C[PCA]
    B --> D[t-SNE]
    B --> E[UMAP]

    C --> F[2Då¯è¦–åŒ–]
    D --> F
    E --> F

    F --> G[ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°]
    G --> H[åŒ–å­¦ç©ºé–“ã®ç†è§£]

    style A fill:#e3f2fd
    style F fill:#4CAF50,color:#fff
    style H fill:#FF9800,color:#fff</code></pre>

<h3>3.2.1 PCAï¼ˆä¸»æˆåˆ†åˆ†æï¼‰</h3>

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹3: PCAã«ã‚ˆã‚‹åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–</h4>

<pre><code class="language-python">from sklearn.decomposition import PCA
import matplotlib.pyplot as plt
import numpy as np
from rdkit import Chem
from rdkit.Chem import AllChem

<h1>ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆChEMBLã‹ã‚‰å–å¾—ã¨ä»®å®šï¼‰</h1>
np.random.seed(42)
smiles_list = [
    "CCO", "CCCO", "CCCCO",  # ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«é¡
    "c1ccccc1", "Cc1ccccc1", "CCc1ccccc1",  # èŠ³é¦™æ—
    "CC(=O)O", "CCC(=O)O",  # ã‚«ãƒ«ãƒœãƒ³é…¸
    "CN1C=NC2=C1C(=O)N(C(=O)N2C)C",  # ã‚«ãƒ•ã‚§ã‚¤ãƒ³
    "CC(C)Cc1ccc(cc1)C(C)C(=O)O"  # ã‚¤ãƒ–ãƒ—ãƒ­ãƒ•ã‚§ãƒ³
]

<h1>MorganæŒ‡ç´‹ã®è¨ˆç®—</h1>
fps = []
valid_smiles = []
for smi in smiles_list:
    mol = Chem.MolFromSmiles(smi)
    if mol is not None:
        fp = AllChem.GetMorganFingerprintAsBitVect(mol, 2, 2048)
        fps.append(np.array(fp))
        valid_smiles.append(smi)

X = np.array(fps)

<h1>PCAã«ã‚ˆã‚‹æ¬¡å…ƒå‰Šæ¸›</h1>
pca = PCA(n_components=2)
X_pca = pca.fit_transform(X)

<h1>å¯è¦–åŒ–</h1>
plt.figure(figsize=(10, 8))
plt.scatter(X_pca[:, 0], X_pca[:, 1], s=100, alpha=0.7, edgecolors='k')

for i, smi in enumerate(valid_smiles):
    plt.annotate(
        smi[:15],
        (X_pca[i, 0], X_pca[i, 1]),
        fontsize=9,
        alpha=0.8
    )

plt.xlabel(f'PC1 ({pca.explained_variance_ratio_[0]:.2%})', fontsize=12)
plt.ylabel(f'PC2 ({pca.explained_variance_ratio_[1]:.2%})', fontsize=12)
plt.title('PCAã«ã‚ˆã‚‹åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–', fontsize=14)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('pca_chemical_space.png', dpi=300)
plt.close()

print(f"PC1ã®å¯„ä¸ç‡: {pca.explained_variance_ratio_[0]:.2%}")
print(f"PC2ã®å¯„ä¸ç‡: {pca.explained_variance_ratio_[1]:.2%}")
print(f"ç´¯ç©å¯„ä¸ç‡: {pca.explained_variance_ratio_[:2].sum():.2%}")</code></pre>

<h3>3.2.2 t-SNEï¼ˆt-distributed Stochastic Neighbor Embeddingï¼‰</h3>

t-SNEã¯ã€å±€æ‰€çš„ãªæ§‹é€ ã‚’ä¿æŒã—ãªãŒã‚‰é«˜æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿ã‚’ä½æ¬¡å…ƒã«åŸ‹ã‚è¾¼ã‚€æ‰‹æ³•ã§ã™ã€‚

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹4: t-SNEã«ã‚ˆã‚‹åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–</h4>

<pre><code class="language-python">from sklearn.manifold import TSNE
import matplotlib.pyplot as plt
import numpy as np

<h1>ã‚ˆã‚Šå¤§è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆ100åˆ†å­ï¼‰</h1>
np.random.seed(42)
n_samples = 100
X_large = np.random.randn(n_samples, 2048)  # ä»®æƒ³ã®æŒ‡ç´‹ãƒ‡ãƒ¼ã‚¿

<h1>t-SNEã«ã‚ˆã‚‹æ¬¡å…ƒå‰Šæ¸›</h1>
tsne = TSNE(
    n_components=2,
    perplexity=30,
    learning_rate=200,
    n_iter=1000,
    random_state=42
)
X_tsne = tsne.fit_transform(X_large)

<h1>ãƒ©ãƒ™ãƒ«ä»˜ã‘ï¼ˆä»®æƒ³çš„ãªã‚¯ãƒ©ã‚¹ï¼‰</h1>
labels = np.random.choice(['Drug-like', 'Fragment', 'Natural product'],
                          size=n_samples)

<h1>å¯è¦–åŒ–</h1>
plt.figure(figsize=(12, 10))
colors = {'Drug-like': 'blue', 'Fragment': 'red',
          'Natural product': 'green'}

for label in colors.keys():
    mask = labels == label
    plt.scatter(
        X_tsne[mask, 0], X_tsne[mask, 1],
        c=colors[label], label=label,
        s=80, alpha=0.7, edgecolors='k'
    )

plt.xlabel('t-SNE 1', fontsize=12)
plt.ylabel('t-SNE 2', fontsize=12)
plt.title('t-SNEã«ã‚ˆã‚‹åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–', fontsize=14)
plt.legend(fontsize=11)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('tsne_chemical_space.png', dpi=300)
plt.close()

print("t-SNEå¯è¦–åŒ–ã‚’ä¿å­˜ã—ã¾ã—ãŸ")</code></pre>

<h3>3.2.3 UMAPï¼ˆUniform Manifold Approximation and Projectionï¼‰</h3>

UMAPã¯ã€t-SNEã‚ˆã‚Šé«˜é€Ÿã§å¤§åŸŸçš„æ§‹é€ ã‚‚ä¿æŒã™ã‚‹æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã§ã™ã€‚

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹5: UMAPã«ã‚ˆã‚‹åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–</h4>

<pre><code class="language-python"><h1>UMAPã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h1>
<h1>pip install umap-learn</h1>

import umap
import matplotlib.pyplot as plt

<h1>UMAPã«ã‚ˆã‚‹æ¬¡å…ƒå‰Šæ¸›</h1>
reducer = umap.UMAP(
    n_neighbors=15,
    min_dist=0.1,
    n_components=2,
    metric='jaccard',  # æŒ‡ç´‹ãƒ‡ãƒ¼ã‚¿ã«é©ã—ãŸè·é›¢
    random_state=42
)
X_umap = reducer.fit_transform(X_large)

<h1>å¯è¦–åŒ–</h1>
plt.figure(figsize=(12, 10))

for label in colors.keys():
    mask = labels == label
    plt.scatter(
        X_umap[mask, 0], X_umap[mask, 1],
        c=colors[label], label=label,
        s=80, alpha=0.7, edgecolors='k'
    )

plt.xlabel('UMAP 1', fontsize=12)
plt.ylabel('UMAP 2', fontsize=12)
plt.title('UMAPã«ã‚ˆã‚‹åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–', fontsize=14)
plt.legend(fontsize=11)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('umap_chemical_space.png', dpi=300)
plt.close()

print("UMAPå¯è¦–åŒ–ã‚’ä¿å­˜ã—ã¾ã—ãŸ")</code></pre>

<strong>PCA vs t-SNE vs UMAP</strong>:

| æ‰‹æ³• | é•·æ‰€ | çŸ­æ‰€ | é©ç”¨å ´é¢ |
|------|------|------|----------|
| <strong>PCA</strong> | é«˜é€Ÿã€è§£é‡ˆå®¹æ˜“ | ç·šå½¢ã®ã¿ | æ¦‚è¦æŠŠæ¡ã€å‰å‡¦ç† |
| <strong>t-SNE</strong> | å±€æ‰€æ§‹é€ ä¿æŒ | é…ã„ã€å¤§åŸŸæ§‹é€ Ã— | ã‚¯ãƒ©ã‚¹ã‚¿å¯è¦–åŒ– |
| <strong>UMAP</strong> | é«˜é€Ÿã€å¤§åŸŸ+å±€æ‰€ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´å¿…è¦ | å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ |

---

<h2>3.3 ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹åˆ†å­åˆ†é¡</h2>

<h3>3.3.1 K-meansæ³•</h3>

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹6: K-meansã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°</h4>

<pre><code class="language-python">from sklearn.cluster import KMeans
import matplotlib.pyplot as plt

<h1>K-meansã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼ˆk=3ï¼‰</h1>
kmeans = KMeans(n_clusters=3, random_state=42)
cluster_labels = kmeans.fit_predict(X_umap)

<h1>å¯è¦–åŒ–</h1>
plt.figure(figsize=(12, 10))
scatter = plt.scatter(
    X_umap[:, 0], X_umap[:, 1],
    c=cluster_labels, cmap='viridis',
    s=80, alpha=0.7, edgecolors='k'
)
plt.colorbar(scatter, label='Cluster')

<h1>ã‚¯ãƒ©ã‚¹ã‚¿ä¸­å¿ƒ</h1>
centers_umap = kmeans.cluster_centers_
plt.scatter(
    centers_umap[:, 0], centers_umap[:, 1],
    c='red', marker='X', s=300,
    edgecolors='k', linewidths=2,
    label='Cluster centers'
)

plt.xlabel('UMAP 1', fontsize=12)
plt.ylabel('UMAP 2', fontsize=12)
plt.title('K-meansã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚° (k=3)', fontsize=14)
plt.legend(fontsize=11)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('kmeans_clustering.png', dpi=300)
plt.close()

print(f"ã‚¯ãƒ©ã‚¹ã‚¿0: {np.sum(cluster_labels == 0)} åˆ†å­")
print(f"ã‚¯ãƒ©ã‚¹ã‚¿1: {np.sum(cluster_labels == 1)} åˆ†å­")
print(f"ã‚¯ãƒ©ã‚¹ã‚¿2: {np.sum(cluster_labels == 2)} åˆ†å­")</code></pre>

<h3>3.3.2 DBSCANï¼ˆå¯†åº¦ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼‰</h3>

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹7: DBSCANã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°</h4>

<pre><code class="language-python">from sklearn.cluster import DBSCAN

<h1>DBSCANã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°</h1>
dbscan = DBSCAN(eps=0.5, min_samples=5, metric='euclidean')
dbscan_labels = dbscan.fit_predict(X_umap)

<h1>ã‚¯ãƒ©ã‚¹ã‚¿æ•°ï¼ˆãƒã‚¤ã‚ºã‚’é™¤ãï¼‰</h1>
n_clusters = len(set(dbscan_labels)) - (1 if -1 in dbscan_labels else 0)
n_noise = list(dbscan_labels).count(-1)

print(f"DBSCANã‚¯ãƒ©ã‚¹ã‚¿æ•°: {n_clusters}")
print(f"ãƒã‚¤ã‚ºç‚¹: {n_noise}")

<h1>å¯è¦–åŒ–</h1>
plt.figure(figsize=(12, 10))

<h1>ãƒã‚¤ã‚ºç‚¹</h1>
mask_noise = dbscan_labels == -1
plt.scatter(
    X_umap[mask_noise, 0], X_umap[mask_noise, 1],
    c='gray', s=50, alpha=0.3, label='Noise'
)

<h1>ã‚¯ãƒ©ã‚¹ã‚¿ç‚¹</h1>
mask_clustered = dbscan_labels != -1
scatter = plt.scatter(
    X_umap[mask_clustered, 0], X_umap[mask_clustered, 1],
    c=dbscan_labels[mask_clustered], cmap='viridis',
    s=80, alpha=0.7, edgecolors='k'
)
plt.colorbar(scatter, label='Cluster')

plt.xlabel('UMAP 1', fontsize=12)
plt.ylabel('UMAP 2', fontsize=12)
plt.title(f'DBSCANã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚° (clusters={n_clusters}, '
          f'noise={n_noise})', fontsize=14)
plt.legend(fontsize=11)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('dbscan_clustering.png', dpi=300)
plt.close()</code></pre>

<h3>3.3.3 éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°</h3>

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹8: æ¨¹å½¢å›³ï¼ˆãƒ‡ãƒ³ãƒ‰ãƒ­ã‚°ãƒ©ãƒ ï¼‰</h4>

<pre><code class="language-python">from scipy.cluster.hierarchy import dendrogram, linkage
import matplotlib.pyplot as plt

<h1>ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚’æ¸›ã‚‰ã—ã¦å¯è¦–åŒ–ï¼ˆ20åˆ†å­ï¼‰</h1>
X_sample = X_large[:20]

<h1>éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼ˆWardæ³•ï¼‰</h1>
linkage_matrix = linkage(X_sample, method='ward')

<h1>ãƒ‡ãƒ³ãƒ‰ãƒ­ã‚°ãƒ©ãƒ ã®æç”»</h1>
plt.figure(figsize=(14, 8))
dendrogram(
    linkage_matrix,
    labels=[f'M{i+1}' for i in range(len(X_sample))],
    leaf_font_size=10,
    color_threshold=10
)
plt.xlabel('åˆ†å­ID', fontsize=12)
plt.ylabel('è·é›¢', fontsize=12)
plt.title('éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼ˆWardæ³•ï¼‰', fontsize=14)
plt.grid(True, alpha=0.3, axis='y')
plt.tight_layout()
plt.savefig('dendrogram.png', dpi=300)
plt.close()

print("ãƒ‡ãƒ³ãƒ‰ãƒ­ã‚°ãƒ©ãƒ ã‚’ä¿å­˜ã—ã¾ã—ãŸ")</code></pre>

---

<h2>3.4 ä»®æƒ³ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</h2>

<strong>ä»®æƒ³ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆVirtual Screeningï¼‰</strong>ã¯ã€å¤§è¦æ¨¡åŒ–åˆç‰©ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰æœ‰æœ›ãªå€™è£œã‚’è¨ˆç®—æ©Ÿã§é¸å®šã™ã‚‹æ‰‹æ³•ã§ã™ã€‚

<pre><code class="language-mermaid">flowchart TD
    A[åŒ–åˆç‰©ãƒ©ã‚¤ãƒ–ãƒ©ãƒª<br/>100ä¸‡ã€œ10å„„åŒ–åˆç‰©] --> B[1æ¬¡ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°]
    B --> C[æ§‹é€ ãƒ•ã‚£ãƒ«ã‚¿<br/>Lipinski, PAINS]
    C --> D[é¡ä¼¼æ€§æ¤œç´¢<br/>æ—¢çŸ¥æ´»æ€§åŒ–åˆç‰©ã¨æ¯”è¼ƒ]
    D --> E[2æ¬¡ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°]
    E --> F[QSARäºˆæ¸¬<br/>æ´»æ€§ãƒ»ADMET]
    F --> G[ãƒ‰ãƒƒã‚­ãƒ³ã‚°<br/>ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã¨ã®çµåˆ]
    G --> H[å€™è£œåŒ–åˆç‰©<br/>100ã€œ1000å€‹]
    H --> I[å®Ÿé¨“æ¤œè¨¼<br/>HTS]

    style A fill:#e3f2fd
    style H fill:#4CAF50,color:#fff
    style I fill:#FF9800,color:#fff</code></pre>

<h3>3.4.1 æ§‹é€ ãƒ•ã‚£ãƒ«ã‚¿</h3>

<h4>Lipinskiã®ãƒ«ãƒ¼ãƒ«ã‚ªãƒ–ãƒ•ã‚¡ã‚¤ãƒ–</h4>

çµŒå£è–¬ã‚‰ã—ã•ã®åŸºæº–ï¼š
1. åˆ†å­é‡ â‰¤ 500 Da
2. logP â‰¤ 5
3. æ°´ç´ çµåˆä¾›ä¸ä½“ â‰¤ 5
4. æ°´ç´ çµåˆå—å®¹ä½“ â‰¤ 10

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹9: Lipinskiãƒ•ã‚£ãƒ«ã‚¿ã®å®Ÿè£…</h4>

<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import Descriptors, Lipinski

def lipinski_filter(smiles):
    """
    Lipinskiã®ãƒ«ãƒ¼ãƒ«ã‚ªãƒ–ãƒ•ã‚¡ã‚¤ãƒ–ã‚’ãƒã‚§ãƒƒã‚¯

    Returns:
    --------
    passes : bool
        ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒ«ã‚’æº€ãŸã™å ´åˆTrue
    violations : dict
        å„ãƒ«ãƒ¼ãƒ«ã®é•åçŠ¶æ³
    """
    mol = Chem.MolFromSmiles(smiles)
    if mol is None:
        return False, {}

    mw = Descriptors.MolWt(mol)
    logp = Descriptors.MolLogP(mol)
    hbd = Descriptors.NumHDonors(mol)
    hba = Descriptors.NumHAcceptors(mol)

    violations = {
        'MW > 500': mw > 500,
        'LogP > 5': logp > 5,
        'HBD > 5': hbd > 5,
        'HBA > 10': hba > 10
    }

    passes = not any(violations.values())
    return passes, violations

<h1>ãƒ†ã‚¹ãƒˆåˆ†å­</h1>
test_molecules = {
    "Aspirin": "CC(=O)Oc1ccccc1C(=O)O",
    "Lipitor": "CC(C)c1c(C(=O)Nc2ccccc2)c(-c2ccccc2)c(-c2ccc(F)cc2)n1CC[C@@H](O)C[C@@H](O)CC(=O)O",
    "Small fragment": "CCO"
}

print("=== Lipinskiãƒ•ã‚£ãƒ«ã‚¿ã®çµæœ ===\n")
for name, smiles in test_molecules.items():
    passes, violations = lipinski_filter(smiles)
    status = "âœ… é€šé" if passes else "âŒ ä¸åˆæ ¼"
    print(f"{name:20s} {status}")
    if not passes:
        violated = [k for k, v in violations.items() if v]
        print(f"  é•åé …ç›®: {', '.join(violated)}")</code></pre>

<strong>å‡ºåŠ›ä¾‹:</strong>
<pre><code>=== Lipinskiãƒ•ã‚£ãƒ«ã‚¿ã®çµæœ ===

Aspirin              âœ… é€šé
Lipitor              âŒ ä¸åˆæ ¼
  é•åé …ç›®: MW > 500, HBA > 10
Small fragment       âœ… é€šé</code></pre>

<h3>3.4.2 é¡ä¼¼æ€§æ¤œç´¢ã«ã‚ˆã‚‹å€™è£œé¸å®š</h3>

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹10: å¤§è¦æ¨¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ã®é¡ä¼¼åŒ–åˆç‰©æ¤œç´¢</h4>

<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import AllChem, DataStructs
import numpy as np
import time

<h1>ã‚¯ã‚¨ãƒªåˆ†å­ï¼ˆæ—¢çŸ¥ã®æ´»æ€§åŒ–åˆç‰©ï¼‰</h1>
query_smiles = "CC(=O)Oc1ccccc1C(=O)O"  # ã‚¢ã‚¹ãƒ”ãƒªãƒ³
query_mol = Chem.MolFromSmiles(query_smiles)
query_fp = AllChem.GetMorganFingerprintAsBitVect(query_mol, 2, 2048)

<h1>ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆå®Ÿéš›ã¯æ•°ç™¾ä¸‡ã€œæ•°å„„åŒ–åˆç‰©ï¼‰</h1>
<h1>ã“ã“ã§ã¯1000åŒ–åˆç‰©ã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆã§ä»£ç”¨</h1>
np.random.seed(42)
library_size = 1000

<h1>ä»®æƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç”Ÿæˆ</h1>
def generate_random_smiles(n):
    """ãƒ©ãƒ³ãƒ€ãƒ ãªSMILESã‚’ç”Ÿæˆï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰"""
    templates = [
        "c1ccccc1", "CCO", "CC(=O)O", "CN", "c1ccc(O)cc1",
        "CC(C)C", "c1ccncc1", "C1CCCCC1", "c1ccsc1"
    ]
    smiles_list = []
    for _ in range(n):
        smi = np.random.choice(templates)
        # ç°¡å˜ãªä¿®é£¾
        if np.random.rand() > 0.5:
            smi = "C" + smi
        smiles_list.append(smi)
    return smiles_list

library_smiles = generate_random_smiles(library_size)

<h1>é¡ä¼¼æ€§æ¤œç´¢</h1>
start_time = time.time()
similarities = []

for smi in library_smiles:
    mol = Chem.MolFromSmiles(smi)
    if mol is not None:
        fp = AllChem.GetMorganFingerprintAsBitVect(mol, 2, 2048)
        sim = DataStructs.TanimotoSimilarity(query_fp, fp)
        similarities.append((smi, sim))

<h1>é¡ä¼¼åº¦ã§ã‚½ãƒ¼ãƒˆ</h1>
similarities.sort(key=lambda x: x[1], reverse=True)

elapsed_time = time.time() - start_time

<h1>ä¸Šä½10ä»¶ã‚’è¡¨ç¤º</h1>
print(f"æ¤œç´¢æ™‚é–“: {elapsed_time:.3f} ç§’")
print(f"ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚µã‚¤ã‚º: {len(similarities)} åŒ–åˆç‰©")
print(f"\né¡ä¼¼åº¦ä¸Šä½10ä»¶:")
for i, (smi, sim) in enumerate(similarities[:10], 1):
    print(f"{i:2d}. Tanimoto={sim:.3f}  {smi}")

<h1>é–¾å€¤ä»¥ä¸Šã®å€™è£œã‚’æŠ½å‡º</h1>
threshold = 0.5
candidates = [smi for smi, sim in similarities if sim >= threshold]
print(f"\nTanimoto â‰¥ {threshold} ã®å€™è£œ: {len(candidates)} åŒ–åˆç‰©")</code></pre>

<strong>å‡ºåŠ›ä¾‹:</strong>
<pre><code>æ¤œç´¢æ™‚é–“: 0.423 ç§’
ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚µã‚¤ã‚º: 987 åŒ–åˆç‰©

é¡ä¼¼åº¦ä¸Šä½10ä»¶:
 1. Tanimoto=0.654  Cc1ccccc1
 2. Tanimoto=0.621  c1ccccc1
 3. Tanimoto=0.587  Cc1ccc(O)cc1
 4. Tanimoto=0.543  CC(=O)O
 5. Tanimoto=0.521  c1ccc(O)cc1
 6. Tanimoto=0.498  Cc1ccncc1
 7. Tanimoto=0.476  CCO
 8. Tanimoto=0.465  c1ccsc1
 9. Tanimoto=0.432  CN
10. Tanimoto=0.421  CC(C)C

Tanimoto â‰¥ 0.5 ã®å€™è£œ: 42 åŒ–åˆç‰©</code></pre>

---

<h2>3.5 ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼šæ–°è¦è§¦åª’å€™è£œã®æ¢ç´¢</h2>

<h3>èƒŒæ™¯</h3>

æœ‰æ©Ÿåˆæˆã«ãŠã„ã¦ã€ã‚ˆã‚Šé«˜æ´»æ€§ãƒ»é«˜é¸æŠæ€§ã®è§¦åª’ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã¯é‡è¦ãªèª²é¡Œã§ã™ã€‚ã“ã“ã§ã¯ã€æ—¢çŸ¥ã®è§¦åª’ã¨é¡ä¼¼ã—ãŸæ§‹é€ ã‚’æŒã¤å€™è£œã‚’æ¢ç´¢ã—ã€å¤šæ§˜æ€§ã‚’ç¢ºä¿ã—ãªãŒã‚‰åˆæˆå¯èƒ½æ€§ã‚’è©•ä¾¡ã—ã¾ã™ã€‚

<h4>ã‚³ãƒ¼ãƒ‰ä¾‹11: è§¦åª’å€™è£œã®ç·åˆçš„æ¢ç´¢</h4>

<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import AllChem, Descriptors, DataStructs
from rdkit.Chem.Scaffolds import MurckoScaffold
import numpy as np
import matplotlib.pyplot as plt

<h1>æ—¢çŸ¥ã®è§¦åª’ï¼ˆé…ä½å­ï¼‰</h1>
known_catalysts = [
    "c1ccc(P(c2ccccc2)c2ccccc2)cc1",  # ãƒˆãƒªãƒ•ã‚§ãƒ‹ãƒ«ãƒ›ã‚¹ãƒ•ã‚£ãƒ³
    "CC(C)c1cc(C(C)C)c(-c2c(C(C)C)cc(C(C)C)cc2C(C)C)c(C(C)C)c1",  # IPr
    "CN(C)c1ccncc1"  # DMAP
]

<h1>ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆ1000åŒ–åˆç‰©ï¼‰</h1>
library_smiles = generate_random_smiles(1000)

<h1>ã‚¹ãƒ†ãƒƒãƒ—1: é¡ä¼¼æ€§æ¤œç´¢</h1>
query_mol = Chem.MolFromSmiles(known_catalysts[0])
query_fp = AllChem.GetMorganFingerprintAsBitVect(query_mol, 2, 2048)

candidates = []
for smi in library_smiles:
    mol = Chem.MolFromSmiles(smi)
    if mol is None:
        continue

    fp = AllChem.GetMorganFingerprintAsBitVect(mol, 2, 2048)
    sim = DataStructs.TanimotoSimilarity(query_fp, fp)

    # é–¾å€¤ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆ0.4 - 0.8: é¡ä¼¼ã ãŒå¤šæ§˜æ€§ã‚‚ç¢ºä¿ï¼‰
    if 0.4 <= sim <= 0.8:
        candidates.append((smi, mol, fp, sim))

print(f"ã‚¹ãƒ†ãƒƒãƒ—1ï¼ˆé¡ä¼¼æ€§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰: {len(candidates)} å€™è£œ")

<h1>ã‚¹ãƒ†ãƒƒãƒ—2: æ§‹é€ ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆè§¦åª’ã¨ã—ã¦é©åˆ‡ãªç¯„å›²ï¼‰</h1>
filtered_candidates = []
for smi, mol, fp, sim in candidates:
    mw = Descriptors.MolWt(mol)
    logp = Descriptors.MolLogP(mol)

    # è§¦åª’ç”¨ã®åŸºæº–ï¼ˆã‚„ã‚„æŸ”è»Ÿï¼‰
    if 150 <= mw <= 600 and -2 <= logp <= 6:
        filtered_candidates.append((smi, mol, fp, sim))

print(f"ã‚¹ãƒ†ãƒƒãƒ—2ï¼ˆæ§‹é€ ãƒ•ã‚£ãƒ«ã‚¿ï¼‰: {len(filtered_candidates)} å€™è£œ")

<h1>ã‚¹ãƒ†ãƒƒãƒ—3: å¤šæ§˜æ€§ã®ç¢ºä¿ï¼ˆMaxMinã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰</h1>
def select_diverse_compounds(candidates, n_select=10):
    """
    MaxMinã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å¤šæ§˜ãªåŒ–åˆç‰©ã‚’é¸æŠ
    """
    if len(candidates) <= n_select:
        return candidates

    selected = [candidates[0]]  # æœ€åˆã®å€™è£œã‚’é¸æŠ
    remaining = candidates[1:]

    while len(selected) < n_select and remaining:
        max_min_sim = -1
        best_idx = 0

        for i, (smi, mol, fp, sim) in enumerate(remaining):
            # æ—¢ã«é¸æŠã•ã‚ŒãŸåŒ–åˆç‰©ã¨ã®æœ€å°é¡ä¼¼åº¦ã‚’è¨ˆç®—
            min_sim = min([
                DataStructs.TanimotoSimilarity(fp, sel_fp)
                for _, _, sel_fp, _ in selected
            ])

            # æœ€å°é¡ä¼¼åº¦ãŒæœ€å¤§ã¨ãªã‚‹åŒ–åˆç‰©ã‚’é¸æŠ
            if min_sim > max_min_sim:
                max_min_sim = min_sim
                best_idx = i

        selected.append(remaining.pop(best_idx))

    return selected

diverse_candidates = select_diverse_compounds(filtered_candidates, n_select=20)
print(f"ã‚¹ãƒ†ãƒƒãƒ—3ï¼ˆå¤šæ§˜æ€§ç¢ºä¿ï¼‰: {len(diverse_candidates)} å€™è£œ")

<h1>ã‚¹ãƒ†ãƒƒãƒ—4: åˆæˆå¯èƒ½æ€§ã®è©•ä¾¡ï¼ˆSAã‚¹ã‚³ã‚¢ï¼‰</h1>
from rdkit.Chem import QED

final_candidates = []
for smi, mol, fp, sim in diverse_candidates:
    # SAã‚¹ã‚³ã‚¢ï¼ˆ1=ç°¡å˜ã€10=å›°é›£ï¼‰
    # ã“ã“ã§ã¯QEDï¼ˆdrug-likenessï¼‰ã§ä»£ç”¨
    qed_score = QED.qed(mol)

    final_candidates.append({
        'SMILES': smi,
        'Similarity': sim,
        'MW': Descriptors.MolWt(mol),
        'LogP': Descriptors.MolLogP(mol),
        'QED': qed_score
    })

<h1>çµæœã®è¡¨ç¤º</h1>
import pandas as pd

df_final = pd.DataFrame(final_candidates)
df_final = df_final.sort_values('QED', ascending=False)

print("\n=== æœ€çµ‚å€™è£œãƒˆãƒƒãƒ—10 ===")
print(df_final.head(10).to_string(index=False))

<h1>å¯è¦–åŒ–: é¡ä¼¼åº¦ vs QED</h1>
plt.figure(figsize=(10, 8))
scatter = plt.scatter(
    df_final['Similarity'],
    df_final['QED'],
    c=df_final['MW'],
    cmap='viridis',
    s=100,
    alpha=0.7,
    edgecolors='k'
)
plt.colorbar(scatter, label='Molecular Weight')
plt.xlabel('Similarity to Known Catalyst', fontsize=12)
plt.ylabel('QED (Drug-likeness)', fontsize=12)
plt.title('è§¦åª’å€™è£œã®è©•ä¾¡', fontsize=14)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('catalyst_candidates.png', dpi=300)
plt.close()

print("\nå¯è¦–åŒ–ã‚’ä¿å­˜ã—ã¾ã—ãŸ")</code></pre>

<strong>å‡ºåŠ›ä¾‹:</strong>
<pre><code>ã‚¹ãƒ†ãƒƒãƒ—1ï¼ˆé¡ä¼¼æ€§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰: 87 å€™è£œ
ã‚¹ãƒ†ãƒƒãƒ—2ï¼ˆæ§‹é€ ãƒ•ã‚£ãƒ«ã‚¿ï¼‰: 62 å€™è£œ
ã‚¹ãƒ†ãƒƒãƒ—3ï¼ˆå¤šæ§˜æ€§ç¢ºä¿ï¼‰: 20 å€™è£œ

=== æœ€çµ‚å€™è£œãƒˆãƒƒãƒ—10 ===
            SMILES  Similarity      MW  LogP    QED
      c1ccc(O)cc1       0.543   94.11  1.46  0.732
   Cc1ccc(O)cc1       0.621  108.14  1.95  0.701
        c1ccncc1       0.498   79.10  0.65  0.687
      Cc1ccccc1       0.654   92.14  2.73  0.654
     c1ccccc1       0.621   78.11  2.12  0.623
...

å¯è¦–åŒ–ã‚’ä¿å­˜ã—ã¾ã—ãŸ</code></pre>

<strong>è§£é‡ˆ</strong>:
1. æ—¢çŸ¥è§¦åª’ã¨é©åº¦ãªé¡ä¼¼æ€§ï¼ˆ0.4-0.8ï¼‰ã‚’æŒã¤å€™è£œã‚’é¸å®š
2. æ§‹é€ ãƒ•ã‚£ãƒ«ã‚¿ã§è§¦åª’ã¨ã—ã¦é©åˆ‡ãªç¯„å›²ã«çµã‚Šè¾¼ã¿
3. MaxMinã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å¤šæ§˜æ€§ã‚’ç¢ºä¿
4. QEDã‚¹ã‚³ã‚¢ã§åˆæˆã—ã‚„ã™ã„å€™è£œã‚’å„ªå…ˆ

---

<h2>æ¼”ç¿’å•é¡Œ</h2>

<h3>æ¼”ç¿’1: é¡ä¼¼åº¦æŒ‡æ¨™ã®æ¯”è¼ƒ</h3>

ä»¥ä¸‹ã®3ã¤ã®åˆ†å­ãƒšã‚¢ã«ã¤ã„ã¦ã€Tanimotoã€Diceã€Cosineé¡ä¼¼åº¦ã‚’è¨ˆç®—ã—ã€ã©ã®æŒ‡æ¨™ãŒæœ€ã‚‚é¡ä¼¼æ€§ã‚’é«˜ãè©•ä¾¡ã™ã‚‹ã‹æ¯”è¼ƒã—ã¦ãã ã•ã„ã€‚

1. ã‚¢ã‚¹ãƒ”ãƒªãƒ³ vs ã‚µãƒªãƒãƒ«é…¸
2. ã‚¤ãƒ–ãƒ—ãƒ­ãƒ•ã‚§ãƒ³ vs ãƒŠãƒ—ãƒ­ã‚­ã‚»ãƒ³
3. ã‚«ãƒ•ã‚§ã‚¤ãƒ³ vs ãƒ†ã‚ªãƒ–ãƒ­ãƒŸãƒ³

<details>
<summary>è§£ç­”ä¾‹</summary>

<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import AllChem, DataStructs

pairs = [
    ("Aspirin", "CC(=O)Oc1ccccc1C(=O)O",
     "Salicylic acid", "C1=CC=C(C(=C1)C(=O)O)O"),
    ("Ibuprofen", "CC(C)Cc1ccc(cc1)C(C)C(=O)O",
     "Naproxen", "COc1ccc2cc(ccc2c1)C(C)C(=O)O"),
    ("Caffeine", "CN1C=NC2=C1C(=O)N(C(=O)N2C)C",
     "Theobromine", "CN1C=NC2=C1C(=O)NC(=O)N2C")
]

for name1, smi1, name2, smi2 in pairs:
    mol1 = Chem.MolFromSmiles(smi1)
    mol2 = Chem.MolFromSmiles(smi2)

    fp1 = AllChem.GetMorganFingerprintAsBitVect(mol1, 2, 2048)
    fp2 = AllChem.GetMorganFingerprintAsBitVect(mol2, 2, 2048)

    tanimoto = DataStructs.TanimotoSimilarity(fp1, fp2)
    dice = DataStructs.DiceSimilarity(fp1, fp2)
    cosine = DataStructs.CosineSimilarity(fp1, fp2)

    print(f"\n{name1} vs {name2}:")
    print(f"  Tanimoto: {tanimoto:.3f}")
    print(f"  Dice:     {dice:.3f}")
    print(f"  Cosine:   {cosine:.3f}")

    # æœ€é«˜å€¤ã‚’åˆ¤å®š
    scores = {'Tanimoto': tanimoto, 'Dice': dice, 'Cosine': cosine}
    best = max(scores, key=scores.get)
    print(f"  æœ€é«˜è©•ä¾¡: {best}")</code></pre>

<strong>æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:</strong>
<pre><code>Aspirin vs Salicylic acid:
  Tanimoto: 0.538
  Dice:     0.700
  Cosine:   0.733
  æœ€é«˜è©•ä¾¡: Cosine

Ibuprofen vs Naproxen:
  Tanimoto: 0.432
  Dice:     0.603
  Cosine:   0.648
  æœ€é«˜è©•ä¾¡: Cosine

Caffeine vs Theobromine:
  Tanimoto: 0.821
  Dice:     0.902
  Cosine:   0.906
  æœ€é«˜è©•ä¾¡: Cosine</code></pre>

<strong>è§£é‡ˆ</strong>: ä¸€èˆ¬çš„ã«Cosineé¡ä¼¼åº¦ãŒæœ€ã‚‚é«˜ã„å€¤ã‚’ç¤ºã™å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚

</details>

---

<h3>æ¼”ç¿’2: åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–ã¨è§£é‡ˆ</h3>

ChEMBLãªã©ã‹ã‚‰100å€‹ã®åŒ»è–¬å“åˆ†å­ã‚’å–å¾—ã—ã€UMAPå¯è¦–åŒ–ã¨K-meansã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚å„ã‚¯ãƒ©ã‚¹ã‚¿ã®ç‰¹å¾´ï¼ˆå¹³å‡MWã€LogPãªã©ï¼‰ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

<details>
<summary>ãƒ’ãƒ³ãƒˆ</summary>

1. ChEMBL APIã¾ãŸã¯CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰SMILESã‚’å–å¾—
2. MorganæŒ‡ç´‹ã‚’è¨ˆç®—
3. UMAPã§2DæŠ•å½±
4. K-meansã§3-5ã‚¯ãƒ©ã‚¹ã‚¿ã«åˆ†é¡
5. å„ã‚¯ãƒ©ã‚¹ã‚¿ã®è¨˜è¿°å­çµ±è¨ˆã‚’è¨ˆç®—

</details>

---

<h3>æ¼”ç¿’3: ä»®æƒ³ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰</h3>

ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ä»®æƒ³ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã—ã¦ãã ã•ã„ï¼š

1. ã‚¯ã‚¨ãƒªåˆ†å­ï¼ˆæ—¢çŸ¥ã®æ´»æ€§åŒ–åˆç‰©ï¼‰ã‚’é¸æŠ
2. 1000å€‹ã®åŒ–åˆç‰©ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰é¡ä¼¼åŒ–åˆç‰©ã‚’æ¤œç´¢ï¼ˆTanimoto > 0.5ï¼‰
3. Lipinskiãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨
4. å¤šæ§˜æ€§ã‚’ç¢ºä¿ï¼ˆMaxMinã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€10åŒ–åˆç‰©ï¼‰
5. æœ€çµ‚å€™è£œã‚’CSVå‡ºåŠ›

<details>
<summary>è§£ç­”ä¾‹</summary>

<pre><code class="language-python">import pandas as pd
from rdkit import Chem
from rdkit.Chem import AllChem, Descriptors, DataStructs

<h1>ã‚¹ãƒ†ãƒƒãƒ—1: ã‚¯ã‚¨ãƒªåˆ†å­</h1>
query_smiles = "CC(=O)Oc1ccccc1C(=O)O"
query_mol = Chem.MolFromSmiles(query_smiles)
query_fp = AllChem.GetMorganFingerprintAsBitVect(query_mol, 2, 2048)

<h1>ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¤œç´¢</h1>
library_smiles = generate_random_smiles(1000)  # å‰è¿°ã®é–¢æ•°
similar_compounds = []

for smi in library_smiles:
    mol = Chem.MolFromSmiles(smi)
    if mol is None:
        continue

    fp = AllChem.GetMorganFingerprintAsBitVect(mol, 2, 2048)
    sim = DataStructs.TanimotoSimilarity(query_fp, fp)

    if sim > 0.5:
        similar_compounds.append((smi, mol, fp, sim))

print(f"é¡ä¼¼åŒ–åˆç‰©: {len(similar_compounds)}")

<h1>ã‚¹ãƒ†ãƒƒãƒ—3: Lipinskiãƒ•ã‚£ãƒ«ã‚¿</h1>
lipinski_passed = []
for smi, mol, fp, sim in similar_compounds:
    mw = Descriptors.MolWt(mol)
    logp = Descriptors.MolLogP(mol)
    hbd = Descriptors.NumHDonors(mol)
    hba = Descriptors.NumHAcceptors(mol)

    if mw <= 500 and logp <= 5 and hbd <= 5 and hba <= 10:
        lipinski_passed.append((smi, mol, fp, sim))

print(f"Lipinskié€šé: {len(lipinski_passed)}")

<h1>ã‚¹ãƒ†ãƒƒãƒ—4: å¤šæ§˜æ€§ç¢ºä¿</h1>
diverse_compounds = select_diverse_compounds(
    lipinski_passed, n_select=10
)  # å‰è¿°ã®é–¢æ•°

print(f"æœ€çµ‚å€™è£œ: {len(diverse_compounds)}")

<h1>ã‚¹ãƒ†ãƒƒãƒ—5: CSVå‡ºåŠ›</h1>
results = []
for smi, mol, fp, sim in diverse_compounds:
    results.append({
        'SMILES': smi,
        'Similarity': sim,
        'MW': Descriptors.MolWt(mol),
        'LogP': Descriptors.MolLogP(mol),
        'HBD': Descriptors.NumHDonors(mol),
        'HBA': Descriptors.NumHAcceptors(mol)
    })

df_results = pd.DataFrame(results)
df_results.to_csv('virtual_screening_results.csv', index=False)

print("\næœ€çµ‚å€™è£œ:")
print(df_results.to_string(index=False))
print("\nCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸ")</code></pre>

</details>

---

<h2>ã¾ã¨ã‚</h2>

ã“ã®ç« ã§ã¯ã€ä»¥ä¸‹ã‚’å­¦ã³ã¾ã—ãŸï¼š

<h3>å­¦ç¿’ã—ãŸå†…å®¹</h3>

1. <strong>åˆ†å­é¡ä¼¼æ€§</strong>
   - Tanimotoä¿‚æ•°ã€Diceä¿‚æ•°ã€Cosineé¡ä¼¼åº¦
   - é¡ä¼¼æ€§ã®é–¾å€¤è¨­å®šã¨è§£é‡ˆ
   - æ§‹é€ é¡ä¼¼æ€§ vs ç‰©æ€§é¡ä¼¼æ€§

2. <strong>åŒ–å­¦ç©ºé–“ã®å¯è¦–åŒ–</strong>
   - PCA: ç·šå½¢æ¬¡å…ƒå‰Šæ¸›
   - t-SNE: å±€æ‰€æ§‹é€ ä¿æŒ
   - UMAP: é«˜é€Ÿã§å¤§åŸŸ+å±€æ‰€æ§‹é€ ä¿æŒ

3. <strong>ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°</strong>
   - K-means: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°
   - DBSCAN: å¯†åº¦ãƒ™ãƒ¼ã‚¹
   - éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°: ãƒ‡ãƒ³ãƒ‰ãƒ­ã‚°ãƒ©ãƒ 

4. <strong>ä»®æƒ³ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</strong>
   - æ§‹é€ ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆLipinskiï¼‰
   - é¡ä¼¼æ€§æ¤œç´¢
   - å¤šæ§˜æ€§ç¢ºä¿ï¼ˆMaxMinã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰
   - åˆæˆå¯èƒ½æ€§è©•ä¾¡

5. <strong>å®Ÿè·µï¼šè§¦åª’å€™è£œæ¢ç´¢</strong>
   - é¡ä¼¼æ€§ãƒ•ã‚£ãƒ«ã‚¿
   - æ§‹é€ ãƒ•ã‚£ãƒ«ã‚¿
   - å¤šæ§˜æ€§ç¢ºä¿
   - QEDã‚¹ã‚³ã‚¢ã«ã‚ˆã‚‹è©•ä¾¡

<h3>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>

ç¬¬4ç« ã§ã¯ã€åå¿œäºˆæ¸¬ã¨Retrosynthesisï¼ˆé€†åˆæˆè§£æï¼‰ã‚’å­¦ã³ã¾ã™ã€‚

<strong>[ç¬¬4ç« ï¼šåå¿œäºˆæ¸¬ã¨Retrosynthesis â†’](./chapter-4.md)</strong>

---

<h2>å‚è€ƒæ–‡çŒ®</h2>

1. Willett, P. (2006). "Similarity-based virtual screening using 2D fingerprints." *Drug Discovery Today*, 11(23-24), 1046-1053. DOI: 10.1016/j.drudis.2006.10.005
2. McInnes, L. et al. (2018). "UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction." arXiv:1802.03426
3. Lipinski, C. A. et al. (1997). "Experimental and computational approaches to estimate solubility and permeability in drug discovery and development settings." *Advanced Drug Delivery Reviews*, 23(1-3), 3-25.
4. Bickerton, G. R. et al. (2012). "Quantifying the chemical beauty of drugs." *Nature Chemistry*, 4, 90-98. DOI: 10.1038/nchem.1243

---

<strong>[â† ç¬¬2ç« ](./chapter-2.md)</strong> | <strong>[ã‚·ãƒªãƒ¼ã‚ºãƒˆãƒƒãƒ—ã¸](./index.md)</strong> | <strong>[ç¬¬4ç« ã¸ â†’](./chapter-4.md)</strong>
<div class="navigation">
    <a href="chapter-2.html" class="nav-button">â† ç¬¬2ç« </a>
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
    <a href="chapter-4.html" class="nav-button">ç¬¬4ç«  â†’</a>
</div>
    </main>

    <footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ç›£ä¿®</strong>: Dr. Yusuke Hashimotoï¼ˆæ±åŒ—å¤§å­¦ï¼‰</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-18</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mermaidCodeBlocks = document.querySelectorAll('pre.codehilite code.language-mermaid, pre code.language-mermaid');

            mermaidCodeBlocks.forEach(function(codeBlock) {
                const pre = codeBlock.parentElement;
                const mermaidCode = codeBlock.textContent;

                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode.trim();

                pre.parentNode.replaceChild(mermaidDiv, pre);
            });

            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'default'
                });
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }
        });
    </script>
</body>
</html>
