<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬5ç« ï¼šã‚¯ãƒ©ã‚¦ãƒ‰HPCæ´»ç”¨ã¨æœ€é©åŒ– - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\(', '\)']],
                displayMath: [['$$', '$$'], ['\[', '\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ç¬¬5ç« ï¼šã‚¯ãƒ©ã‚¦ãƒ‰HPCæ´»ç”¨ã¨æœ€é©åŒ–</h1>
            <p class="subtitle"></p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 15-20åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´šã€œä¸Šç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 5å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 0å•</span>
            </div>
        </div>
    </header>

    <main class="container">

<h1>ç¬¬5ç« ï¼šã‚¯ãƒ©ã‚¦ãƒ‰HPCæ´»ç”¨ã¨æœ€é©åŒ–</h1>

<h2>å­¦ç¿’ç›®æ¨™</h2>

ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š

- âœ… AWS Parallel Clusterã‚’æ§‹ç¯‰ã§ãã‚‹
- âœ… ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚³ã‚¹ãƒˆã‚’50%å‰Šæ¸›ã§ãã‚‹
- âœ… Dockerã§è¨ˆç®—ç’°å¢ƒã‚’å®Œå…¨å†ç¾ã§ãã‚‹
- âœ… 10,000ææ–™è¦æ¨¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­è¨ˆãƒ»å®Ÿè¡Œã§ãã‚‹
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚’ç†è§£ã—ã¦ã„ã‚‹

---

<h2>5.1 ã‚¯ãƒ©ã‚¦ãƒ‰HPCã®é¸æŠè‚¢</h2>

<h3>ä¸»è¦ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¯”è¼ƒ</h3>

| ã‚µãƒ¼ãƒ“ã‚¹ | ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ | ç‰¹å¾´ | åˆæœŸè²»ç”¨ | æ¨å¥¨ç”¨é€” |
|---------|-----------|------|---------|---------|
| <strong>AWS Parallel Cluster</strong> | Amazon | æœ€å¤§è¦æ¨¡ã€è±Šå¯Œãªå®Ÿç¸¾ | $0 | å¤§è¦æ¨¡HPC |
| <strong>Google Cloud HPC Toolkit</strong> | Google | AI/MLçµ±åˆãŒå¼·åŠ› | $0 | æ©Ÿæ¢°å­¦ç¿’é€£æº |
| <strong>Azure CycleCloud</strong> | Microsoft | Windowsçµ±åˆ | $0 | ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º |
| <strong>TSUBAME</strong> | æ±å·¥å¤§ | å›½å†…ãƒˆãƒƒãƒ—ã€å­¦è¡“åˆ©ç”¨ | ç”³è«‹åˆ¶ | å­¦è¡“ç ”ç©¶ |
| <strong>å¯Œå²³</strong> | ç†ç ” | ä¸–ç•Œãƒˆãƒƒãƒ—500 | ç”³è«‹åˆ¶ | è¶…å¤§è¦æ¨¡è¨ˆç®— |

<h3>ã‚³ã‚¹ãƒˆæ¯”è¼ƒï¼ˆ10,000ææ–™ã€1ææ–™=12 CPUæ™‚é–“ã€48ã‚³ã‚¢ï¼‰</h3>

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | è¨ˆç®—æ™‚é–“ | ã‚³ã‚¹ãƒˆ | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|----------|---------|-------|---------|---------|
| ã‚ªãƒ³ãƒ—ãƒ¬HPC | 5,760,000 CPUæ™‚é–“ | $0ï¼ˆæ—¢å­˜è¨­å‚™ï¼‰ | ç„¡æ–™ï¼ˆåˆ©ç”¨æ å†…ï¼‰ | å¾…ã¡æ™‚é–“ã€åˆ¶é™ |
| AWS ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ | åŒä¸Š | $4,000-6,000 | å³æ™‚åˆ©ç”¨å¯èƒ½ | é«˜ã‚³ã‚¹ãƒˆ |
| AWS ã‚¹ãƒãƒƒãƒˆ | åŒä¸Š | $800-1,500 | 70%ã‚³ã‚¹ãƒˆå‰Šæ¸› | ä¸­æ–­ãƒªã‚¹ã‚¯ |
| Google Cloud Preemptible | åŒä¸Š | $900-1,600 | å®‰ä¾¡ | 24æ™‚é–“åˆ¶é™ |

---

<h2>5.2 AWS Parallel Clusterã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h2>

<h3>å‰ææ¡ä»¶</h3>

<pre><code class="language-bash"><h1>AWS CLIã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h1>
pip install awscli

<h1>AWSè¨­å®š</h1>
aws configure
<h1>AWS Access Key ID: [YOUR_KEY]</h1>
<h1>AWS Secret Access Key: [YOUR_SECRET]</h1>
<h1>Default region: us-east-1</h1>
<h1>Default output format: json</h1>

<h1>Parallel Cluster CLIã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h1>
pip install aws-parallelcluster</code></pre>

<h3>ã‚¯ãƒ©ã‚¹ã‚¿è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«</h3>

<strong>config.yaml</strong>:

<pre><code class="language-yaml">Region: us-east-1
Image:
  Os: alinux2

HeadNode:
  InstanceType: c5.2xlarge  # 8 vCPU, 16 GB RAM
  Networking:
    SubnetId: subnet-12345678
  Ssh:
    KeyName: my-key-pair

Scheduling:
  Scheduler: slurm
  SlurmQueues:
    - Name: compute
      ComputeResources:
        - Name: c5-48xlarge
          InstanceType: c5.24xlarge  # 96 vCPU
          MinCount: 0
          MaxCount: 100  # æœ€å¤§100ãƒãƒ¼ãƒ‰
          DisableSimultaneousMultithreading: true
          Efa:
            Enabled: true  # é«˜é€Ÿãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
      Networking:
        SubnetIds:
          - subnet-12345678
        PlacementGroup:
          Enabled: true  # ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·é…ç½®

SharedStorage:
  - MountDir: /shared
    Name: ebs-shared
    StorageType: Ebs
    EbsSettings:
      VolumeType: gp3
      Size: 1000  # 1 TB
      Encrypted: true

  - MountDir: /fsx
    Name: lustre-fs
    StorageType: FsxLustre
    FsxLustreSettings:
      StorageCapacity: 1200  # 1.2 TB
      DeploymentType: SCRATCH_2</code></pre>

<h3>ã‚¯ãƒ©ã‚¹ã‚¿ä½œæˆ</h3>

<pre><code class="language-bash"><h1>ã‚¯ãƒ©ã‚¹ã‚¿ä½œæˆ</h1>
pcluster create-cluster \
  --cluster-name vasp-cluster \
  --cluster-configuration config.yaml

<h1>ä½œæˆçŠ¶æ…‹ç¢ºèª</h1>
pcluster describe-cluster --cluster-name vasp-cluster

<h1>SSHæ¥ç¶š</h1>
pcluster ssh --cluster-name vasp-cluster -i ~/.ssh/my-key-pair.pem</code></pre>

<h3>VASPç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h3>

<pre><code class="language-bash"><h1>ã‚¯ãƒ©ã‚¹ã‚¿ã«SSHæ¥ç¶šå¾Œ</h1>

<h1>Intel OneAPI Toolkitï¼ˆVASPã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã«å¿…è¦ï¼‰</h1>
wget https://registrationcenter-download.intel.com/...
bash l_BaseKit_p_2023.0.0.25537_offline.sh

<h1>VASPã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒå¿…è¦ï¼‰</h1>
cd /shared
tar -xzf vasp.6.3.0.tar.gz
cd vasp.6.3.0

<h1>makefile.includeç·¨é›†ï¼ˆIntel compilerç”¨ï¼‰</h1>
cp arch/makefile.include.intel makefile.include

<h1>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«</h1>
make all

<h1>å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®</h1>
cp bin/vasp_std /shared/bin/</code></pre>

---

<h2>5.3 ã‚³ã‚¹ãƒˆæœ€é©åŒ–</h2>

<h3>ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ´»ç”¨</h3>

<strong>ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹</strong>ã¯ã€ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã®60-90%å‰²å¼•ã§åˆ©ç”¨ã§ãã‚‹ä½™å‰°è¨ˆç®—ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚

<strong>config.yamlï¼ˆã‚¹ãƒãƒƒãƒˆè¨­å®šï¼‰</strong>:

<pre><code class="language-yaml">Scheduling:
  Scheduler: slurm
  SlurmQueues:
    - Name: spot-queue
      CapacityType: SPOT  # ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
      ComputeResources:
        - Name: c5-spot
          InstanceType: c5.24xlarge
          MinCount: 0
          MaxCount: 200
          SpotPrice: 2.50  # æœ€å¤§å…¥æœ­ä¾¡æ ¼ï¼ˆ$/æ™‚ï¼‰
      Networking:
        SubnetIds:
          - subnet-12345678</code></pre>

<strong>ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</strong>:

1. <strong>ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ</strong>: è¨ˆç®—ã‚’å®šæœŸçš„ã«ä¿å­˜
2. <strong>è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—</strong>: ä»£æ›¿ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®š
3. <strong>ãƒªãƒˆãƒ©ã‚¤è¨­å®š</strong>: ä¸­æ–­æ™‚ã®è‡ªå‹•ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ

<h3>è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°</h3>

<pre><code class="language-yaml">Scheduling:
  SlurmSettings:
    ScaledownIdletime: 5  # 5åˆ†ã‚¢ã‚¤ãƒ‰ãƒ«ã§çµ‚äº†
  SlurmQueues:
    - Name: compute
      ComputeResources:
        - Name: c5-instances
          MinCount: 0      # ã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ã¯0ãƒãƒ¼ãƒ‰
          MaxCount: 100    # æœ€å¤§100ãƒãƒ¼ãƒ‰</code></pre>

<h3>ã‚³ã‚¹ãƒˆç›£è¦–</h3>

<pre><code class="language-python">import boto3
from datetime import datetime, timedelta

def get_cluster_cost(cluster_name, days=7):
    """
    ã‚¯ãƒ©ã‚¹ã‚¿ã®ã‚³ã‚¹ãƒˆã‚’å–å¾—

    Parameters:
    -----------
    cluster_name : str
        ã‚¯ãƒ©ã‚¹ã‚¿å
    days : int
        éå»ä½•æ—¥åˆ†

    Returns:
    --------
    cost : float
        ç·ã‚³ã‚¹ãƒˆï¼ˆUSDï¼‰
    """
    ce_client = boto3.client('ce', region_name='us-east-1')

    # æœŸé–“è¨­å®š
    end_date = datetime.now().date()
    start_date = end_date - timedelta(days=days)

    # Cost Explorer API
    response = ce_client.get_cost_and_usage(
        TimePeriod={
            'Start': start_date.strftime('%Y-%m-%d'),
            'End': end_date.strftime('%Y-%m-%d')
        },
        Granularity='DAILY',
        Metrics=['UnblendedCost'],
        Filter={
            'Tags': {
                'Key': 'parallelcluster:cluster-name',
                'Values': [cluster_name]
            }
        }
    )

    total_cost = 0
    for result in response['ResultsByTime']:
        cost = float(result['Total']['UnblendedCost']['Amount'])
        total_cost += cost
        print(f"{result['TimePeriod']['Start']}: ${cost:.2f}")

    print(f"\nç·ã‚³ã‚¹ãƒˆï¼ˆ{days}æ—¥é–“ï¼‰: ${total_cost:.2f}")
    return total_cost

<h1>ä½¿ç”¨ä¾‹</h1>
get_cluster_cost('vasp-cluster', days=7)</code></pre>

---

<h2>5.4 Docker/Singularityã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ãƒŠåŒ–</h2>

<h3>Dockerfileã®ä½œæˆ</h3>

<strong>Dockerfile</strong>:

<pre><code class="language-dockerfile">FROM ubuntu:20.04

<h1>åŸºæœ¬ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</h1>
RUN apt-get update && apt-get install -y \
    build-essential \
    gfortran \
    openmpi-bin \
    libopenmpi-dev \
    python3 \
    python3-pip \
    wget \
    && rm -rf /var/lib/apt/lists/*

<h1>Pythonç’°å¢ƒ</h1>
RUN pip3 install --upgrade pip && \
    pip3 install numpy scipy matplotlib \
    ase pymatgen fireworks

<h1>Intel MKLï¼ˆæ•°å€¤è¨ˆç®—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰</h1>
RUN wget https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB && \
    apt-key add GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB && \
    echo "deb https://apt.repos.intel.com/oneapi all main" > /etc/apt/sources.list.d/oneAPI.list && \
    apt-get update && \
    apt-get install -y intel-oneapi-mkl

<h1>VASPï¼ˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä¿æŒè€…ã®ã¿ï¼‰</h1>
<h1>COPY vasp.6.3.0.tar.gz /tmp/</h1>
<h1>RUN cd /tmp && tar -xzf vasp.6.3.0.tar.gz && \</h1>
<h1>    cd vasp.6.3.0 && make all && \</h1>
<h1>    cp bin/vasp_std /usr/local/bin/</h1>

<h1>ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª</h1>
WORKDIR /calculations

<h1>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒãƒ³ãƒ‰</h1>
CMD ["/bin/bash"]</code></pre>

<h3>Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã¨ãƒ—ãƒƒã‚·ãƒ¥</h3>

<pre><code class="language-bash"><h1>ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰</h1>
docker build -t my-vasp-env:latest .

<h1>Docker Hubã«ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆå…±æœ‰ç”¨ï¼‰</h1>
docker tag my-vasp-env:latest username/my-vasp-env:latest
docker push username/my-vasp-env:latest

<h1>Amazon ECRã«ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆAWSç”¨ï¼‰</h1>
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 123456789012.dkr.ecr.us-east-1.amazonaws.com

docker tag my-vasp-env:latest 123456789012.dkr.ecr.us-east-1.amazonaws.com/my-vasp-env:latest
docker push 123456789012.dkr.ecr.us-east-1.amazonaws.com/my-vasp-env:latest</code></pre>

<h3>Singularityã§HPCå®Ÿè¡Œ</h3>

HPCã‚·ã‚¹ãƒ†ãƒ ã§ã¯Dockerã®ä»£ã‚ã‚Šã«Singularityã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

<pre><code class="language-bash"><h1>Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰Singularityã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆ</h1>
singularity build vasp-env.sif docker://username/my-vasp-env:latest

<h1>Singularityã‚³ãƒ³ãƒ†ãƒŠã§å®Ÿè¡Œ</h1>
singularity exec vasp-env.sif mpirun -np 48 vasp_std</code></pre>

<strong>SLURMã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆSingularityä½¿ç”¨ï¼‰</strong>:

<pre><code class="language-bash">#!/bin/bash
#SBATCH --job-name=vasp-singularity
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=48
#SBATCH --time=24:00:00

<h1>Singularityã‚¤ãƒ¡ãƒ¼ã‚¸</h1>
IMAGE=/shared/containers/vasp-env.sif

<h1>ã‚³ãƒ³ãƒ†ãƒŠå†…ã§VASPå®Ÿè¡Œ</h1>
singularity exec $IMAGE mpirun -np 48 vasp_std</code></pre>

---

<h2>5.5 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹</h2>

<h3>ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆIAMï¼‰</h3>

<strong>æœ€å°æ¨©é™ã®åŸå‰‡</strong>:

<pre><code class="language-json">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeInstances",
        "ec2:DescribeVolumes",
        "ec2:RunInstances",
        "ec2:TerminateInstances"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "aws:RequestedRegion": "us-east-1"
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::my-vasp-bucket/*"
    }
  ]
}</code></pre>

<h3>ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–</h3>

<pre><code class="language-yaml"><h1>config.yamlï¼ˆæš—å·åŒ–è¨­å®šï¼‰</h1>
SharedStorage:
  - MountDir: /shared
    Name: ebs-encrypted
    StorageType: Ebs
    EbsSettings:
      VolumeType: gp3
      Size: 1000
      Encrypted: true  # æš—å·åŒ–æœ‰åŠ¹
      KmsKeyId: arn:aws:kms:us-east-1:123456789012:key/12345678-1234-1234-1234-123456789012</code></pre>

<h3>å­¦è¡“ãƒ©ã‚¤ã‚»ãƒ³ã‚¹éµå®ˆ</h3>

<strong>VASP</strong>ç­‰ã®å•†ç”¨ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã§ä½¿ç”¨ã™ã‚‹å ´åˆã®æ³¨æ„ç‚¹ï¼š

1. <strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç¢ºèª</strong>: ã‚¯ãƒ©ã‚¦ãƒ‰ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹
2. <strong>ãƒãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯</strong>: ç‰¹å®šãƒãƒ¼ãƒ‰ã§ã®å®Ÿè¡Œåˆ¶é™
3. <strong>åŒæ™‚å®Ÿè¡Œæ•°</strong>: ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ•°ã®åˆ¶é™
4. <strong>ç›£æŸ»ãƒ­ã‚°</strong>: ä½¿ç”¨å±¥æ­´ã®è¨˜éŒ²

---

<h2>5.6 ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£: 10,000ææ–™ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</h2>

<h3>è¦ä»¶å®šç¾©</h3>

<strong>ç›®æ¨™</strong>: 10,000å€‹ã®é…¸åŒ–ç‰©ææ–™ã®ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã‚’6ãƒ¶æœˆä»¥å†…ã«è¨ˆç®—

<strong>åˆ¶ç´„</strong>:
- äºˆç®—: $5,000
- 1ææ–™ã‚ãŸã‚Šè¨ˆç®—æ™‚é–“: 12æ™‚é–“ï¼ˆ48ã‚³ã‚¢ï¼‰
- ç·CPUæ™‚é–“: 5,760,000 CPUæ™‚é–“

<h3>ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ</h3>

<div class="mermaid">graph TD
    A[ææ–™ãƒªã‚¹ãƒˆ<br/>10,000å€‹] --> B[ãƒãƒƒãƒåˆ†å‰²<br/>100ãƒãƒƒãƒ Ã— 100ææ–™]
    B --> C[AWS Parallel Cluster<br/>ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹]
    C --> D[SLURM ã‚¢ãƒ¬ã‚¤ã‚¸ãƒ§ãƒ–<br/>åŒæ™‚20ãƒãƒ¼ãƒ‰]
    D --> E[FireWorks<br/>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç®¡ç†]
    E --> F[MongoDB<br/>çµæœä¿å­˜]
    F --> G[S3<br/>é•·æœŸä¿å­˜]
    G --> H[åˆ†æãƒ»å¯è¦–åŒ–]</div>

<h3>å®Ÿè£…</h3>

<strong>1. ã‚¯ãƒ©ã‚¹ã‚¿è¨­å®š</strong>

<pre><code class="language-yaml"><h1>config-10k-materials.yaml</h1>
Scheduling:
  Scheduler: slurm
  SlurmQueues:
    - Name: spot-compute
      CapacityType: SPOT
      ComputeResources:
        - Name: c5-24xlarge-spot
          InstanceType: c5.24xlarge  # 96 vCPU
          MinCount: 0
          MaxCount: 50  # åŒæ™‚50ãƒãƒ¼ãƒ‰ = 4,800ã‚³ã‚¢
          SpotPrice: 2.00</code></pre>

<strong>2. ã‚¸ãƒ§ãƒ–æŠ•å…¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</strong>

<pre><code class="language-python">def run_10k_project():
    """10,000ææ–™ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Ÿè¡Œ"""

    # ææ–™ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿
    with open('oxide_materials_10k.txt', 'r') as f:
        materials = [line.strip() for line in f]

    print(f"ç·ææ–™æ•°: {len(materials)}")

    # 100ãƒãƒƒãƒã«åˆ†å‰²
    batch_size = 100
    n_batches = len(materials) // batch_size

    manager = SLURMJobManager()

    for batch_id in range(n_batches):
        start = batch_id * batch_size
        end = (batch_id + 1) * batch_size
        batch_materials = materials[start:end]

        # ãƒãƒƒãƒç”¨ææ–™ãƒªã‚¹ãƒˆ
        list_file = f'batch_{batch_id:03d}.txt'
        with open(list_file, 'w') as f:
            for mat in batch_materials:
                f.write(f"{mat}\n")

        # ã‚¢ãƒ¬ã‚¤ã‚¸ãƒ§ãƒ–æŠ•å…¥ï¼ˆ100ææ–™ã€åŒæ™‚20ãƒãƒ¼ãƒ‰ï¼‰
        job_id = manager.submit_array_job(
            'vasp_bandgap.sh',
            n_tasks=100,
            max_concurrent=20
        )

        print(f"ãƒãƒƒãƒ {batch_id+1}/{n_batches} æŠ•å…¥: ã‚¸ãƒ§ãƒ–ID {job_id}")

        # ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆAWS APIåˆ¶é™å¯¾ç­–ï¼‰
        time.sleep(1)

run_10k_project()</code></pre>

<strong>3. ã‚³ã‚¹ãƒˆåˆ†æ</strong>

<pre><code class="language-python">def estimate_project_cost():
    """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š"""

    # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    n_materials = 10000
    cpu_hours_per_material = 12
    cores_per_job = 48

    total_cpu_hours = n_materials * cpu_hours_per_material

    # c5.24xlarge: 96 vCPU, $4.08/æ™‚ï¼ˆã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ï¼‰
    ondemand_cost = total_cpu_hours * (4.08 / 96)
    print(f"ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰: ${ondemand_cost:,.0f}")

    # ã‚¹ãƒãƒƒãƒˆ: 70%å‰²å¼•
    spot_cost = ondemand_cost * 0.3
    print(f"ã‚¹ãƒãƒƒãƒˆ: ${spot_cost:,.0f}")

    # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: EBS 1TB Ã— 6ãƒ¶æœˆ
    storage_cost = 0.10 * 1000 * 6  # $0.10/GB/æœˆ
    print(f"ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: ${storage_cost:,.0f}")

    # ãƒ‡ãƒ¼ã‚¿è»¢é€: 500GB
    transfer_cost = 500 * 0.09
    print(f"ãƒ‡ãƒ¼ã‚¿è»¢é€: ${transfer_cost:,.0f}")

    total_cost = spot_cost + storage_cost + transfer_cost
    print(f"\nç·ã‚³ã‚¹ãƒˆ: ${total_cost:,.0f}")

    return total_cost

estimate_project_cost()</code></pre>

<strong>å‡ºåŠ›</strong>:
<pre><code>ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰: $5,100
ã‚¹ãƒãƒƒãƒˆ: $1,530
ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: $600
ãƒ‡ãƒ¼ã‚¿è»¢é€: $45

ç·ã‚³ã‚¹ãƒˆ: $2,175</code></pre>

---

<h2>5.7 æ¼”ç¿’å•é¡Œ</h2>

<h3>å•é¡Œ1ï¼ˆé›£æ˜“åº¦: mediumï¼‰</h3>

<strong>å•é¡Œ</strong>: AWS Parallel Clusterã®ã‚³ã‚¹ãƒˆå‰Šæ¸›ç­–ã‚’3ã¤æŒ™ã’ã€ãã‚Œãã‚Œã®å‰Šæ¸›ç‡ã‚’è¦‹ç©ã‚‚ã£ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

<strong>1. ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½¿ç”¨</strong>
- å‰Šæ¸›ç‡: 70%
- ãƒªã‚¹ã‚¯: ä¸­æ–­ã®å¯èƒ½æ€§

<strong>2. è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆ5åˆ†ã‚¢ã‚¤ãƒ‰ãƒ«ï¼‰</strong>
- å‰Šæ¸›ç‡: 20-30%ï¼ˆã‚¢ã‚¤ãƒ‰ãƒ«æ™‚é–“ã«ã‚ˆã‚‹ï¼‰
- ãƒªã‚¹ã‚¯: ãªã—

<strong>3. ãƒªã‚¶ãƒ¼ãƒ–ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆ1å¹´å¥‘ç´„ï¼‰</strong>
- å‰Šæ¸›ç‡: 40%
- ãƒªã‚¹ã‚¯: é•·æœŸã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆ

<strong>ç·åˆå‰Šæ¸›ç‡</strong>: æœ€å¤§85%ï¼ˆã‚¹ãƒãƒƒãƒˆ + è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰

</details>

<h3>å•é¡Œ2ï¼ˆé›£æ˜“åº¦: hardï¼‰</h3>

<strong>å•é¡Œ</strong>: 5,000ææ–™ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã€äºˆç®—$1,000ã€æœŸé–“3ãƒ¶æœˆã®åˆ¶ç´„ä¸‹ã§æœ€é©ãªå®Ÿè¡Œè¨ˆç”»ã‚’ç«‹ã¦ã¦ãã ã•ã„ã€‚

<details>
<summary>è§£ç­”ä¾‹</summary>

<strong>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</strong>:
- ææ–™æ•°: 5,000
- CPUæ™‚é–“: 5,000 Ã— 12æ™‚é–“ = 60,000æ™‚é–“
- äºˆç®—: $1,000
- æœŸé–“: 3ãƒ¶æœˆ = 90æ—¥

<strong>åˆ¶ç´„ã‹ã‚‰é€†ç®—</strong>:

ã‚³ã‚¹ãƒˆåˆ¶ç´„:
<pre><code>$1,000 = è¨ˆç®—ã‚³ã‚¹ãƒˆ + ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆ + è»¢é€ã‚³ã‚¹ãƒˆ
$1,000 â‰ˆ $800ï¼ˆè¨ˆç®—ï¼‰ + $150ï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰ + $50ï¼ˆè»¢é€ï¼‰</code></pre>

c5.24xlarge ã‚¹ãƒãƒƒãƒˆ: $1.22/æ™‚
<pre><code>ä½¿ç”¨å¯èƒ½æ™‚é–“ = $800 / $1.22 = 656æ™‚é–“
åŒæ™‚ãƒãƒ¼ãƒ‰æ•° = 60,000 / 656 / 24 = 3.8 â‰ˆ 4ãƒãƒ¼ãƒ‰</code></pre>

<strong>å®Ÿè¡Œè¨ˆç”»</strong>:
1. ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: c5.24xlarge Ã— 4ãƒãƒ¼ãƒ‰
2. åŒæ™‚å®Ÿè¡Œ: 16ææ–™ï¼ˆå„48ã‚³ã‚¢ï¼‰
3. 1æ—¥ã‚ãŸã‚Š: 16ææ–™ Ã— 2ãƒãƒƒãƒ = 32ææ–™
4. å®Œäº†æœŸé–“: 5,000 / 32 = 156æ—¥

<strong>å•é¡Œ</strong>: æœŸé–“ãŒ3ãƒ¶æœˆï¼ˆ90æ—¥ï¼‰ã‚’è¶…é

<strong>è§£æ±ºç­–</strong>:
- åŒæ™‚ãƒãƒ¼ãƒ‰æ•°ã‚’8ã«å¢—åŠ  â†’ ã‚³ã‚¹ãƒˆ$1,600ï¼ˆäºˆç®—è¶…éï¼‰
- ã¾ãŸã¯ã€1ææ–™ã‚ãŸã‚ŠCPUæ™‚é–“ã‚’8æ™‚é–“ã«å‰Šæ¸›ï¼ˆç²¾åº¦ã¨ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ï¼‰

</details>

---

<h2>5.8 ã¾ã¨ã‚</h2>

ã“ã®ç« ã§ã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰HPCã®æ´»ç”¨ã¨ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã‚’å­¦ã³ã¾ã—ãŸã€‚

<strong>ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ</strong>:

1. <strong>AWS Parallel Cluster</strong>: å¤§è¦æ¨¡HPCç’°å¢ƒã‚’ç°¡å˜ã«æ§‹ç¯‰
2. <strong>ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹</strong>: 70%ã®ã‚³ã‚¹ãƒˆå‰Šæ¸›
3. <strong>Docker/Singularity</strong>: ç’°å¢ƒã®å®Œå…¨å†ç¾
4. <strong>ã‚³ã‚¹ãƒˆç®¡ç†</strong>: è¦‹ç©ã‚‚ã‚Šã¨ç›£è¦–
5. <strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</strong>: æš—å·åŒ–ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

<strong>ã‚·ãƒªãƒ¼ã‚ºå®Œäº†ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</strong>

ã“ã‚Œã§ã€ãƒã‚¤ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆè¨ˆç®—ã®å…¨5ç« ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚ç¬¬1ç« ã®åŸºç¤æ¦‚å¿µã‹ã‚‰ç¬¬5ç« ã®ã‚¯ãƒ©ã‚¦ãƒ‰å®Ÿè£…ã¾ã§ã€å®Ÿè·µçš„ãªã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã§ããŸã¯ãšã§ã™ã€‚

<strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</strong>:

1. å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ100-1000ææ–™ï¼‰ã‚’å®Ÿè¡Œ
2. ã‚³ã‚¹ãƒˆã‚’æ¸¬å®šãƒ»æœ€é©åŒ–
3. çµæœã‚’NOMADã«å…¬é–‹
4. è«–æ–‡åŸ·ç­†ãƒ»å­¦ä¼šç™ºè¡¨

<strong>[ã‚·ãƒªãƒ¼ã‚ºãƒˆãƒƒãƒ—ã«æˆ»ã‚‹](./index.md)</strong>

---

<h2>å‚è€ƒæ–‡çŒ®</h2>

1. Amazon Web Services (2023). "AWS Parallel Cluster User Guide." https://docs.aws.amazon.com/parallelcluster/

2. Kurtzer, G. M., et al. (2017). "Singularity: Scientific containers for mobility of compute." *PLOS ONE*, 12(5), e0177459.

3. Merkel, D. (2014). "Docker: lightweight Linux containers for consistent development and deployment." *Linux Journal*, 2014(239), 2.

4. NOMAD Laboratory (2023). "NOMAD Repository - FAIR Data Sharing." https://nomad-lab.eu/

5. Jain, A., et al. (2015). "FireWorks: a dynamic workflow system designed for high-throughput applications." *Concurrency and Computation: Practice and Experience*, 27(17), 5037-5059.

---

<strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: CC BY 4.0
<strong>ä½œæˆæ—¥</strong>: 2025-10-17
<strong>ä½œæˆè€…</strong>: Dr. Yusuke Hashimoto, Tohoku University

---

<strong>ãƒã‚¤ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆè¨ˆç®—å…¥é–€ã‚·ãƒªãƒ¼ã‚ºã‚’å®Œäº†ã—ã¾ã—ãŸï¼</strong>

ææ–™æ¢ç´¢ã®åŠ é€ŸåŒ–ã‚’å®Ÿç¾ã—ã€ä¸–ç•Œã«è²¢çŒ®ã™ã‚‹ç ”ç©¶ã‚’æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚
<div class="navigation">
    <a href="chapter-4.html" class="nav-button">â† ç¬¬4ç« </a>
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
</div>
    </main>

    <footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ç›£ä¿®</strong>: Dr. Yusuke Hashimotoï¼ˆæ±åŒ—å¤§å­¦ï¼‰</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-17</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mermaidCodeBlocks = document.querySelectorAll('pre.codehilite code.language-mermaid, pre code.language-mermaid');

            mermaidCodeBlocks.forEach(function(codeBlock) {
                const pre = codeBlock.parentElement;
                const mermaidCode = codeBlock.textContent;

                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode.trim();

                pre.parentNode.replaceChild(mermaidDiv, pre);
            });

            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'default'
                });
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }
        });
    </script>
</body>
</html>
