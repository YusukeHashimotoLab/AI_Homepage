<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á¨¨4Á´†Ôºö„Éá„Éº„ÇøÁÆ°ÁêÜ„Å®„Éù„Çπ„Éà„Éó„É≠„Çª„ÇπÔºàFireWorks, AiiDAÔºâ - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\(', '\)']],
                displayMath: [['$$', '$$'], ['\[', '\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Á¨¨4Á´†Ôºö„Éá„Éº„ÇøÁÆ°ÁêÜ„Å®„Éù„Çπ„Éà„Éó„É≠„Çª„ÇπÔºàFireWorks, AiiDAÔºâ</h1>
            <p class="subtitle"></p>
            <div class="meta">
                <span class="meta-item">üìñ Ë™≠‰∫ÜÊôÇÈñì: 20-25ÂàÜ</span>
                <span class="meta-item">üìä Èõ£ÊòìÂ∫¶: ‰∏äÁ¥ö</span>
                <span class="meta-item">üíª „Ç≥„Éº„Éâ‰æã: 6ÂÄã</span>
                <span class="meta-item">üìù ÊºîÁøíÂïèÈ°å: 0Âïè</span>
            </div>
        </div>
    </header>

    <main class="container">

<h1>Á¨¨4Á´†Ôºö„Éá„Éº„ÇøÁÆ°ÁêÜ„Å®„Éù„Çπ„Éà„Éó„É≠„Çª„ÇπÔºàFireWorks, AiiDAÔºâ</h1>

<h2>Â≠¶ÁøíÁõÆÊ®ô</h2>

„Åì„ÅÆÁ´†„ÇíË™≠„ÇÄ„Åì„Å®„Åß„ÄÅ‰ª•‰∏ã„ÇíÁøíÂæó„Åß„Åç„Åæ„ÅôÔºö

- ‚úÖ FireWorks„ÅßË§áÈõë„Å™„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÊßãÁØâ„Åß„Åç„Çã
- ‚úÖ Atomate„ÅÆÊ®ôÊ∫ñ„ÉØ„Éº„ÇØ„Éï„É≠„Éº„Çí‰Ωø„ÅÑ„Åì„Å™„Åõ„Çã
- ‚úÖ AiiDA„Åß„Éá„Éº„Çø„Éó„É≠„Éì„Éä„É≥„Çπ„ÇíË®òÈå≤„Åß„Åç„Çã
- ‚úÖ Ë®àÁÆóÁµêÊûú„ÇíÊßãÈÄ†Âåñ„Éá„Éº„Çø„Éô„Éº„Çπ„Å´‰øùÂ≠ò„Åß„Åç„Çã
- ‚úÖ ÁµêÊûú„ÇíNOMAD„Å´ÂÖ¨Èñã„Åß„Åç„Çã

---

<h2>4.1 FireWorks„Å´„Çà„Çã„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁÆ°ÁêÜ</h2>

<h3>FireWorks„ÅÆ„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£</h3>

<div class="mermaid">graph TD
    A[Firework] -->|ÈÄ£Èéñ| B[Workflow]
    B --> C[LaunchPad<br/>MongoDB]
    C -->|„Çø„Çπ„ÇØÂâ≤ÂΩì| D[Rocket Launcher]
    D -->|ÂÆüË°å| E[Ë®àÁÆó„Éé„Éº„Éâ]
    E -->|ÁµêÊûú| C

    style C fill:#4ecdc4
    style A fill:#ffe66d
    style B fill:#ff6b6b</div>

<strong>‰∏ªË¶Å„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà</strong>:
- <strong>Firework</strong>: Âçò‰∏Ä„Çø„Çπ„ÇØÔºà1„Å§„ÅÆDFTË®àÁÆóÔºâ
- <strong>Workflow</strong>: Ë§áÊï∞Firework„ÅÆÈÄ£Èéñ
- <strong>LaunchPad</strong>: „Éá„Éº„Çø„Éô„Éº„ÇπÔºàMongoDBÔºâ
- <strong>Rocket</strong>: „Çø„Çπ„ÇØÂÆüË°å„Ç®„É≥„Ç∏„É≥

<h3>„Ç§„É≥„Çπ„Éà„Éº„É´„Å®Ë®≠ÂÆö</h3>

<pre><code class="language-bash"><h1>FireWorks„Ç§„É≥„Çπ„Éà„Éº„É´</h1>
pip install fireworks

<h1>MongoDB„Ç§„É≥„Çπ„Éà„Éº„É´ÔºàmacOSÔºâ</h1>
brew install mongodb-community

<h1>MongoDBËµ∑Âãï</h1>
brew services start mongodb-community

<h1>FireWorksË®≠ÂÆö</h1>
lpad init
<h1>‚Üí my_launchpad.yaml„ÅåÁîüÊàê„Åï„Çå„Çã</h1></code></pre>

<strong>my_launchpad.yaml</strong>:
<pre><code class="language-yaml">host: localhost
port: 27017
name: fireworks
username: null
password: null</code></pre>

<h3>Âü∫Êú¨ÁöÑ„Å™Firework‰ΩúÊàê</h3>

<pre><code class="language-python">from fireworks import Firework, LaunchPad, ScriptTask
from fireworks.core.rocket_launcher import rapidfire

<h1>LaunchPadÔºà„Éá„Éº„Çø„Éô„Éº„ÇπÔºâ„Å´Êé•Á∂ö</h1>
launchpad = LaunchPad(host='localhost', port=27017, name='fireworks')

<h1>TaskÂÆöÁæ©ÔºàVASPÂÆüË°åÔºâ</h1>
vasp_task = ScriptTask.from_str(
    'mpirun -np 48 vasp_std',
    use_shell=True
)

<h1>Firework‰ΩúÊàê</h1>
fw = Firework(
    vasp_task,
    name='VASP relaxation',
    spec={'_category': 'VASP'}
)

<h1>LaunchPad„Å´ËøΩÂä†</h1>
launchpad.add_wf(fw)

<h1>ÂÆüË°å</h1>
rapidfire(launchpad)</code></pre>

<h3>Atomate„ÅÆÊ®ôÊ∫ñ„ÉØ„Éº„ÇØ„Éï„É≠„Éº</h3>

<strong>Atomate</strong>„ÅØ„ÄÅMaterials Project„Åß‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„ÇãÊ®ôÊ∫ñ„ÉØ„Éº„ÇØ„Éï„É≠„Éº„É©„Ç§„Éñ„É©„É™„Åß„Åô„ÄÇ

<pre><code class="language-python">from atomate.vasp.workflows.base.core import get_wf
from pymatgen.core import Structure

<h1>ÊßãÈÄ†Ë™≠„ÅøËæº„Åø</h1>
structure = Structure.from_file("LiCoO2.cif")

<h1>Ê®ôÊ∫ñ„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂèñÂæó</h1>
<h1>optimize_structure_and_properties:</h1>
<h1>  1. ÊßãÈÄ†ÊúÄÈÅ©Âåñ</h1>
<h1>  2. ÈùôÁöÑË®àÁÆó</h1>
<h1>  3. „Éê„É≥„ÉâÊßãÈÄ†</h1>
<h1>  4. DOSË®àÁÆó</h1>
wf = get_wf(
    structure,
    "optimize_structure_and_properties.yaml"
)

<h1>LaunchPad„Å´ËøΩÂä†</h1>
launchpad.add_wf(wf)

<h1>ÂÆüË°å</h1>
rapidfire(launchpad, nlaunches='infinite')</code></pre>

<h3>„Ç´„Çπ„Çø„É†„ÉØ„Éº„ÇØ„Éï„É≠„Éº‰ΩúÊàê</h3>

<pre><code class="language-python">from fireworks import Firework, Workflow
from fireworks.core.firework import FiretaskBase
from atomate.vasp.firetasks.write_inputs import WriteVaspFromIOSet
from atomate.vasp.firetasks.run_calc import RunVaspCustodian
from atomate.vasp.firetasks.parse_outputs import VaspToDb
from pymatgen.io.vasp.sets import MPRelaxSet, MPStaticSet

class CustomWorkflow:
    """„Ç´„Çπ„Çø„É†„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁîüÊàê"""

    @staticmethod
    def bandgap_workflow(structure):
        """
        „Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„ÉóË®àÁÆó„ÉØ„Éº„ÇØ„Éï„É≠„Éº
        1. ÊßãÈÄ†ÊúÄÈÅ©Âåñ ‚Üí 2. ÈùôÁöÑË®àÁÆó ‚Üí 3. „Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„ÉóÊäΩÂá∫
        """
        # Firework 1: ÊßãÈÄ†ÊúÄÈÅ©Âåñ
        fw1 = Firework(
            [
                WriteVaspFromIOSet(structure=structure, vasp_input_set=MPRelaxSet),
                RunVaspCustodian(vasp_cmd="vasp_std"),
                VaspToDb(db_file="db.json", task_label="relax")
            ],
            name="Structural relaxation",
            spec={"_category": "relax"}
        )

        # Firework 2: ÈùôÁöÑË®àÁÆó
        fw2 = Firework(
            [
                WriteVaspFromIOSet(structure=structure, vasp_input_set=MPStaticSet),
                RunVaspCustodian(vasp_cmd="vasp_std"),
                VaspToDb(db_file="db.json", task_label="static")
            ],
            name="Static calculation",
            spec={"_category": "static"}
        )

        # Firework 3: „Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„ÉóÊäΩÂá∫
        fw3 = Firework(
            [ExtractBandgapTask()],
            name="Extract bandgap"
        )

        # „ÉØ„Éº„ÇØ„Éï„É≠„ÉºÊßãÁØâÔºàfw1 ‚Üí fw2 ‚Üí fw3Ôºâ
        wf = Workflow(
            [fw1, fw2, fw3],
            links_dict={fw1: [fw2], fw2: [fw3]},
            name=f"Bandgap workflow: {structure.composition.reduced_formula}"
        )

        return wf


class ExtractBandgapTask(FiretaskBase):
    """„Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„ÉóÊäΩÂá∫„Çø„Çπ„ÇØ"""

    def run_task(self, fw_spec):
        from pymatgen.io.vasp.outputs import Vasprun

        vasprun = Vasprun("vasprun.xml")
        bandgap = vasprun.get_band_structure().get_band_gap()

        print(f"„Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„Éó: {bandgap['energy']:.3f} eV")

        # ÁµêÊûú„Çí„Éá„Éº„Çø„Éô„Éº„Çπ„Å´‰øùÂ≠ò
        return {"bandgap": bandgap['energy']}

<h1>‰ΩøÁî®‰æã</h1>
structure = Structure.from_file("LiCoO2.cif")
wf = CustomWorkflow.bandgap_workflow(structure)

launchpad.add_wf(wf)
rapidfire(launchpad)</code></pre>

<h3>„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„Å®„É™„Çπ„Çø„Éº„Éà</h3>

<pre><code class="language-python">from custodian.custodian import Custodian
from custodian.vasp.handlers import VaspErrorHandler, UnconvergedErrorHandler
from custodian.vasp.jobs import VaspJob

<h1>„Ç®„É©„Éº„Éè„É≥„Éâ„É©„ÉºË®≠ÂÆö</h1>
handlers = [
    VaspErrorHandler(),           # ‰∏ÄËà¨ÁöÑ„Å™VASP„Ç®„É©„Éº
    UnconvergedErrorHandler(),    # ÂèéÊùüÊÄß„Ç®„É©„Éº
]

<h1>VASP„Ç∏„Éß„ÉñÂÆöÁæ©</h1>
jobs = [
    VaspJob(
        vasp_cmd=["mpirun", "-np", "48", "vasp_std"],
        output_file="vasp.out",
        auto_npar=False
    )
]

<h1>CustodianÂÆüË°åÔºàËá™Âãï„Ç®„É©„ÉºÂá¶ÁêÜÔºâ</h1>
c = Custodian(
    handlers=handlers,
    jobs=jobs,
    max_errors=5
)

c.run()</code></pre>

---

<h2>4.2 AiiDA„Å´„Çà„Çã„Éó„É≠„Éì„Éä„É≥„ÇπÁÆ°ÁêÜ</h2>

<h3>„Éá„Éº„Çø„Éó„É≠„Éì„Éä„É≥„ÇπÔºàÊù•Ê≠¥ËøΩË∑°Ôºâ„ÅÆÈáçË¶ÅÊÄß</h3>

<strong>„Éó„É≠„Éì„Éä„É≥„Çπ</strong>„Å®„ÅØ„ÄÅË®àÁÆóÁµêÊûú„Åå„Å©„ÅÆ„Çà„ÅÜ„Å´Âæó„Çâ„Çå„Åü„Åã„ÅÆÂÆåÂÖ®„Å™Ë®òÈå≤„Åß„Åô„ÄÇ

<strong>ËøΩË∑°„Åô„Åπ„ÅçÊÉÖÂ†±</strong>:
- ÂÖ•Âäõ„Éá„Éº„ÇøÔºàÊßãÈÄ†„ÄÅ„Éë„É©„É°„Éº„ÇøÔºâ
- ‰ΩøÁî®„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢ÔºàVASP 6.3.0Á≠âÔºâ
- Ë®àÁÆóÁí∞Â¢ÉÔºà„Éé„Éº„Éâ„ÄÅ„Ç≥„Ç¢Êï∞„ÄÅÊó•ÊôÇÔºâ
- ‰∏≠ÈñìÁµêÊûú
- ÊúÄÁµÇÁµêÊûú

<h3>AiiDA„Ç§„É≥„Çπ„Éà„Éº„É´</h3>

<pre><code class="language-bash"><h1>AiiDA„Ç§„É≥„Çπ„Éà„Éº„É´</h1>
pip install aiida-core aiida-vasp

<h1>„Éá„Éº„Çø„Éô„Éº„ÇπÂàùÊúüÂåñ</h1>
verdi quicksetup

<h1>Âãï‰ΩúÁ¢∫Ë™ç</h1>
verdi status</code></pre>

<h3>AiiDA„Åß„ÅÆË®àÁÆóÂÆüË°å</h3>

<pre><code class="language-python">from aiida import orm, engine
from aiida.plugins import CalculationFactory, DataFactory

<h1>VASPË®àÁÆó„ÇØ„É©„ÇπÂèñÂæó</h1>
VaspCalculation = CalculationFactory('vasp.vasp')

<h1>„Éá„Éº„ÇøÂûã</h1>
StructureData = DataFactory('structure')
KpointsData = DataFactory('array.kpoints')

<h1>ÊßãÈÄ†„Éá„Éº„Çø‰ΩúÊàê</h1>
structure = StructureData()
<h1>ÔºàÊßãÈÄ†„ÇíË®≠ÂÆöÔºâ</h1>

<h1>k-pointsË®≠ÂÆö</h1>
kpoints = KpointsData()
kpoints.set_kpoints_mesh([8, 8, 8])

<h1>Ë®àÁÆó„Éë„É©„É°„Éº„Çø</h1>
parameters = orm.Dict(dict={
    'ENCUT': 520,
    'EDIFF': 1e-5,
    'ISMEAR': 0,
    'SIGMA': 0.05,
})

<h1>Ë®àÁÆó„Éì„É´„ÉÄ„Éº</h1>
builder = VaspCalculation.get_builder()
builder.structure = structure
builder.kpoints = kpoints
builder.parameters = parameters
builder.code = orm.Code.get_from_string('vasp@localhost')

<h1>ÂÆüË°å</h1>
calc_node = engine.submit(builder)
print(f"Ë®àÁÆó„Éé„Éº„Éâ: {calc_node.pk}")</code></pre>

<h3>„Éá„Éº„Çø„ÇØ„Ç®„É™</h3>

<pre><code class="language-python">from aiida.orm import QueryBuilder

<h1>„Åô„Åπ„Å¶„ÅÆVASPË®àÁÆó„ÇíÊ§úÁ¥¢</h1>
qb = QueryBuilder()
qb.append(VaspCalculation, filters={'attributes.exit_status': 0})

for calc in qb.all():
    print(f"PK: {calc[0].pk}, Formula: {calc[0].inputs.structure.get_formula()}")

<h1>„Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„Éó„Åå1.5-2.5 eV„ÅÆÊùêÊñô„ÇíÊ§úÁ¥¢</h1>
qb = QueryBuilder()
qb.append(VaspCalculation, tag='calc')
qb.append(orm.Dict, with_incoming='calc', filters={
    'attributes.band_gap': {'and': [{'>=': 1.5}, {'<=': 2.5}]}
})

results = qb.all()
print(f"Ë©≤ÂΩì„Åô„ÇãÊùêÊñô: {len(results)}ÂÄã")</code></pre>

---

<h2>4.3 Ë®àÁÆó„Éá„Éº„Çø„ÅÆÊßãÈÄ†Âåñ</h2>

<h3>JSON„Çπ„Ç≠„Éº„ÉûË®≠Ë®à</h3>

<pre><code class="language-python">import json
from datetime import datetime

class MaterialsDataSchema:
    """ÊùêÊñôË®àÁÆó„Éá„Éº„Çø„ÅÆ„Çπ„Ç≠„Éº„Éû"""

    @staticmethod
    def create_entry(material_id, formula, structure, calculation_results):
        """
        „Éá„Éº„Çø„Éô„Éº„Çπ„Ç®„É≥„Éà„É™„Çí‰ΩúÊàê

        Returns:
        --------
        entry : dict
            ÊßãÈÄ†Âåñ„Éá„Éº„Çø
        """
        entry = {
            # Ë≠òÂà•ÊÉÖÂ†±
            "material_id": material_id,
            "formula": formula,
            "created_at": datetime.now().isoformat(),

            # ÊßãÈÄ†ÊÉÖÂ†±
            "structure": {
                "lattice": structure.lattice.matrix.tolist(),
                "species": [str(site.specie) for site in structure],
                "coords": [site.frac_coords.tolist() for site in structure],
                "space_group": structure.get_space_group_info()[1]
            },

            # Ë®àÁÆóÁµêÊûú
            "properties": {
                "energy": calculation_results.get("energy"),
                "band_gap": calculation_results.get("band_gap"),
                "formation_energy": calculation_results.get("formation_energy"),
            },

            # Ë®àÁÆó„É°„Çø„Éá„Éº„Çø
            "calculation_metadata": {
                "software": "VASP 6.3.0",
                "functional": "PBE",
                "encut": 520,
                "kpoints": calculation_results.get("kpoints"),
                "converged": calculation_results.get("converged"),
                "calculation_time": calculation_results.get("calculation_time"),
            },

            # „Éó„É≠„Éì„Éä„É≥„Çπ
            "provenance": {
                "input_structure_source": "Materials Project",
                "workflow": "Atomate optimize_structure",
                "hostname": calculation_results.get("hostname"),
                "date": calculation_results.get("date"),
            }
        }

        return entry

<h1>‰ΩøÁî®‰æã</h1>
entry = MaterialsDataSchema.create_entry(
    material_id="custom-0001",
    formula="LiCoO2",
    structure=structure,
    calculation_results={
        "energy": -45.67,
        "band_gap": 2.3,
        "converged": True,
        "kpoints": [12, 12, 8],
        "calculation_time": "2.5 hours",
        "hostname": "hpc.university.edu",
        "date": "2025-10-17",
    }
)

<h1>JSON‰øùÂ≠ò</h1>
with open("data/custom-0001.json", 'w') as f:
    json.dump(entry, f, indent=2)</code></pre>

<h3>MongoDB„Å´„Çà„Çã„Éá„Éº„ÇøÁÆ°ÁêÜ</h3>

<pre><code class="language-python">from pymongo import MongoClient
import json

class MaterialsDatabase:
    """MongoDB„Å´„Çà„ÇãÊùêÊñô„Éá„Éº„Çø„Éô„Éº„Çπ"""

    def __init__(self, host='localhost', port=27017, db_name='materials'):
        self.client = MongoClient(host, port)
        self.db = self.client[db_name]
        self.collection = self.db['calculations']

        # „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ‰ΩúÊàêÔºàÊ§úÁ¥¢È´òÈÄüÂåñÔºâ
        self.collection.create_index("material_id", unique=True)
        self.collection.create_index("formula")
        self.collection.create_index("properties.band_gap")

    def insert(self, entry):
        """„Éá„Éº„Çø„ÇíÊåøÂÖ•"""
        result = self.collection.insert_one(entry)
        return result.inserted_id

    def find_by_formula(self, formula):
        """ÂåñÂ≠¶Âºè„ÅßÊ§úÁ¥¢"""
        return list(self.collection.find({"formula": formula}))

    def find_by_bandgap_range(self, min_gap, max_gap):
        """„Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„ÉóÁØÑÂõ≤„ÅßÊ§úÁ¥¢"""
        query = {
            "properties.band_gap": {
                "$gte": min_gap,
                "$lte": max_gap
            }
        }
        return list(self.collection.find(query))

    def get_statistics(self):
        """Áµ±Ë®àÊÉÖÂ†±"""
        pipeline = [
            {
                "$group": {
                    "_id": None,
                    "total": {"$sum": 1},
                    "avg_bandgap": {"$avg": "$properties.band_gap"},
                    "avg_energy": {"$avg": "$properties.energy"}
                }
            }
        ]

        result = list(self.collection.aggregate(pipeline))
        return result[0] if result else {}

<h1>‰ΩøÁî®‰æã</h1>
db = MaterialsDatabase()

<h1>„Éá„Éº„ÇøÊåøÂÖ•</h1>
db.insert(entry)

<h1>Ê§úÁ¥¢</h1>
licoo2_results = db.find_by_formula("LiCoO2")
print(f"LiCoO2„ÅÆË®àÁÆó: {len(licoo2_results)}‰ª∂")

<h1>„Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„ÉóÊ§úÁ¥¢</h1>
semiconductors = db.find_by_bandgap_range(0.5, 3.0)
print(f"ÂçäÂ∞é‰ΩìÔºà0.5-3.0 eVÔºâ: {len(semiconductors)}‰ª∂")

<h1>Áµ±Ë®à</h1>
stats = db.get_statistics()
print(f"Âπ≥Âùá„Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„Éó: {stats['avg_bandgap']:.2f} eV")</code></pre>

---

<h2>4.4 „Éù„Çπ„Éà„Éó„É≠„Çª„Çπ„ÅÆËá™ÂãïÂåñ</h2>

<h3>DOS/„Éê„É≥„ÉâÊßãÈÄ†„ÅÆËá™Âãï„Éó„É≠„ÉÉ„Éà</h3>

<pre><code class="language-python">from pymatgen.io.vasp.outputs import Vasprun
from pymatgen.electronic_structure.plotter import BSPlotter, DosPlotter
import matplotlib.pyplot as plt

def auto_plot_band_dos(directory):
    """
    „Éê„É≥„ÉâÊßãÈÄ†„Å®DOS„ÇíËá™Âãï„Éó„É≠„ÉÉ„Éà

    Parameters:
    -----------
    directory : str
        vasprun.xml„Åå„ÅÇ„Çã„Éá„Ç£„É¨„ÇØ„Éà„É™
    """
    vasprun = Vasprun(f"{directory}/vasprun.xml")

    # „Éê„É≥„ÉâÊßãÈÄ†
    bs = vasprun.get_band_structure()
    bs_plotter = BSPlotter(bs)

    fig = bs_plotter.get_plot(ylim=[-5, 5])
    fig.savefig(f"{directory}/band_structure.png", dpi=300)
    print(f"„Éê„É≥„ÉâÊßãÈÄ†„Çí‰øùÂ≠ò: {directory}/band_structure.png")

    # DOS
    dos = vasprun.complete_dos
    dos_plotter = DosPlotter()
    dos_plotter.add_dos("Total", dos)

    fig = dos_plotter.get_plot(xlim=[-5, 5])
    fig.savefig(f"{directory}/dos.png", dpi=300)
    print(f"DOS„Çí‰øùÂ≠ò: {directory}/dos.png")

    # „Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„Éó
    bandgap = bs.get_band_gap()
    print(f"„Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„Éó: {bandgap['energy']:.3f} eV ({bandgap['transition']})")

<h1>‰ΩøÁî®‰æã</h1>
auto_plot_band_dos("calculations/LiCoO2")</code></pre>

<h3>„É¨„Éù„Éº„ÉàËá™ÂãïÁîüÊàê</h3>

<pre><code class="language-python">from jinja2 import Template
from datetime import datetime

def generate_report(material_data, output_file="report.html"):
    """
    Ë®àÁÆóÁµêÊûú„É¨„Éù„Éº„Éà„ÇíËá™ÂãïÁîüÊàê

    Parameters:
    -----------
    material_data : dict
        ÊùêÊñô„Éá„Éº„Çø
    output_file : str
        Âá∫ÂäõHTML„Éï„Ç°„Ç§„É´
    """
    template_str = """
<!DOCTYPE html>
<html>
<head>
    <title>Ë®àÁÆó„É¨„Éù„Éº„Éà: {{ material_data.formula }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #4CAF50; color: white; }
        img { max-width: 600px; }
    </style>
</head>
<body>
    <h1>{{ material_data.formula }}</h1>
    <p>ÁîüÊàêÊó•ÊôÇ: {{ generation_time }}</p>

    <h2>ÊßãÈÄ†ÊÉÖÂ†±</h2>
    <table>
        <tr><th>È†ÖÁõÆ</th><th>ÂÄ§</th></tr>
        <tr><td>Á©∫ÈñìÁæ§</td><td>{{ material_data.structure.space_group }}</td></tr>
        <tr><td>Ê†ºÂ≠êÂÆöÊï∞ a</td><td>{{ "%.3f"|format(material_data.structure.lattice[0][0]) }} √Ö</td></tr>
    </table>

    <h2>Ë®àÁÆóÁµêÊûú</h2>
    <table>
        <tr><th>ÁâπÊÄß</th><th>ÂÄ§</th></tr>
        <tr><td>„Ç®„Éç„É´„ÇÆ„Éº</td><td>{{ "%.3f"|format(material_data.properties.energy) }} eV/atom</td></tr>
        <tr><td>„Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„Éó</td><td>{{ "%.3f"|format(material_data.properties.band_gap) }} eV</td></tr>
    </table>

    <h2>„Éê„É≥„ÉâÊßãÈÄ†</h2>
    <img src="band_structure.png" alt="„Éê„É≥„ÉâÊßãÈÄ†">

    <h2>Áä∂ÊÖãÂØÜÂ∫¶</h2>
    <img src="dos.png" alt="DOS">
</body>
</html>
    """

    template = Template(template_str)

    html = template.render(
        material_data=material_data,
        generation_time=datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    )

    with open(output_file, 'w') as f:
        f.write(html)

    print(f"„É¨„Éù„Éº„ÉàÁîüÊàê: {output_file}")

<h1>‰ΩøÁî®‰æã</h1>
generate_report(entry, output_file="LiCoO2_report.html")</code></pre>

---

<h2>4.5 „Éá„Éº„ÇøÂÖ±Êúâ„Å®„Ç¢„Éº„Ç´„Ç§„Éñ</h2>

<h3>NOMAD Repository„Å∏„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</h3>

<pre><code class="language-python">import requests
import json

def upload_to_nomad(data_files, metadata):
    """
    NOMAD Repository„Å´„Éá„Éº„Çø„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ

    Parameters:
    -----------
    data_files : list
        „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„Çã„Éï„Ç°„Ç§„É´„É™„Çπ„Éà
    metadata : dict
        „É°„Çø„Éá„Éº„Çø
    """
    nomad_url = "https://nomad-lab.eu/prod/rae/api/v1/uploads"

    # „É°„Çø„Éá„Éº„ÇøÊ∫ñÂÇô
    upload_metadata = {
        "upload_name": metadata.get("name", "Untitled"),
        "references": metadata.get("references", []),
        "coauthors": metadata.get("coauthors", []),
    }

    # „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
    files = []
    for file_path in data_files:
        files.append(('file', open(file_path, 'rb')))

    response = requests.post(
        nomad_url,
        files=files,
        data={'metadata': json.dumps(upload_metadata)},
        headers={'Authorization': f'Bearer {NOMAD_API_TOKEN}'}
    )

    if response.status_code == 200:
        upload_id = response.json()['upload_id']
        print(f"„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊàêÂäü: {upload_id}")
        print(f"URL: https://nomad-lab.eu/prod/rae/gui/uploads/{upload_id}")
        return upload_id
    else:
        print(f"„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂ§±Êïó: {response.status_code}")
        return None

<h1>‰ΩøÁî®‰æã</h1>
files = [
    "calculations/LiCoO2/vasprun.xml",
    "calculations/LiCoO2/OUTCAR",
    "calculations/LiCoO2/CONTCAR",
]

metadata = {
    "name": "LiCoO2 battery material calculations",
    "references": ["https://doi.org/10.xxxx/xxxxx"],
    "coauthors": ["Dr. Yusuke Hashimoto"]
}

upload_to_nomad(files, metadata)</code></pre>

---

<h2>4.6 ÊºîÁøíÂïèÈ°å</h2>

<h3>ÂïèÈ°å1ÔºàÈõ£ÊòìÂ∫¶: mediumÔºâ</h3>

<strong>ÂïèÈ°å</strong>: FireWorks„Åß„ÄÅÊßãÈÄ†ÊúÄÈÅ©Âåñ‚ÜíÈùôÁöÑË®àÁÆó„ÅÆ2„Çπ„ÉÜ„ÉÉ„Éó„ÉØ„Éº„ÇØ„Éï„É≠„Éº„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

<details>
<summary>Ëß£Á≠î‰æã</summary>

<pre><code class="language-python">from fireworks import Firework, Workflow
from atomate.vasp.firetasks.write_inputs import WriteVaspFromIOSet
from atomate.vasp.firetasks.run_calc import RunVaspCustodian
from pymatgen.io.vasp.sets import MPRelaxSet, MPStaticSet
from pymatgen.core import Structure

structure = Structure.from_file("POSCAR")

<h1>Firework 1: ÊßãÈÄ†ÊúÄÈÅ©Âåñ</h1>
fw1 = Firework(
    [
        WriteVaspFromIOSet(structure=structure, vasp_input_set=MPRelaxSet),
        RunVaspCustodian(vasp_cmd="vasp_std")
    ],
    name="Relax"
)

<h1>Firework 2: ÈùôÁöÑË®àÁÆó</h1>
fw2 = Firework(
    [
        WriteVaspFromIOSet(structure=structure, vasp_input_set=MPStaticSet),
        RunVaspCustodian(vasp_cmd="vasp_std")
    ],
    name="Static"
)

<h1>„ÉØ„Éº„ÇØ„Éï„É≠„Éº</h1>
wf = Workflow([fw1, fw2], links_dict={fw1: [fw2]})

launchpad.add_wf(wf)</code></pre>

</details>

<h3>ÂïèÈ°å2ÔºàÈõ£ÊòìÂ∫¶: hardÔºâ</h3>

<strong>ÂïèÈ°å</strong>: MongoDB„Å´‰øùÂ≠ò„Åï„Çå„Åü1000ÊùêÊñô„ÅÆ„Éá„Éº„Çø„Åã„Çâ„ÄÅ‰ª•‰∏ã„ÇíÊäΩÂá∫„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö
1. „Éê„É≥„Éâ„ÇÆ„É£„ÉÉ„Éó„Åå1.0-2.0 eV„ÅÆÂçäÂ∞é‰Ωì
2. ÂΩ¢Êàê„Ç®„Éç„É´„ÇÆ„Éº„ÅåË≤†ÔºàÂÆâÂÆöÔºâ
3. ÁµêÊûú„ÇíCSV„Å´‰øùÂ≠ò

<details>
<summary>Ëß£Á≠î‰æã</summary>

<pre><code class="language-python">import pandas as pd

db = MaterialsDatabase()

<h1>„ÇØ„Ç®„É™</h1>
query = {
    "properties.band_gap": {"$gte": 1.0, "$lte": 2.0},
    "properties.formation_energy": {"$lt": 0}
}

results = list(db.collection.find(query))

<h1>DataFrameÂåñ</h1>
data = []
for r in results:
    data.append({
        "formula": r["formula"],
        "band_gap": r["properties"]["band_gap"],
        "formation_energy": r["properties"]["formation_energy"],
        "space_group": r["structure"]["space_group"]
    })

df = pd.DataFrame(data)

<h1>CSV‰øùÂ≠ò</h1>
df.to_csv("stable_semiconductors.csv", index=False)
print(f"Ë©≤ÂΩìÊùêÊñô: {len(df)}ÂÄã")
print(df.head())</code></pre>

</details>

---

<h2>4.7 „Åæ„Å®„ÇÅ</h2>

<strong>„Ç≠„Éº„Éù„Ç§„É≥„Éà</strong>:

1. <strong>FireWorks</strong>: Materials ProjectÊ®ôÊ∫ñ„ÅÆ„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁÆ°ÁêÜ
2. <strong>Atomate</strong>: Ê®ôÊ∫ñÂåñ„Åï„Çå„ÅüË®àÁÆó„ÉØ„Éº„ÇØ„Éï„É≠„Éº
3. <strong>AiiDA</strong>: „Éá„Éº„Çø„Éó„É≠„Éì„Éä„É≥„ÇπËøΩË∑°
4. <strong>MongoDB</strong>: Â§ßË¶èÊ®°„Éá„Éº„ÇøÁÆ°ÁêÜ
5. <strong>NOMAD</strong>: „Éá„Éº„ÇøÂÖ¨Èñã„Å®FAIRÂéüÂâá

<strong>Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó</strong>: Á¨¨5Á´†„Åß„ÇØ„É©„Ç¶„ÉâHPCÊ¥ªÁî®„ÇíÂ≠¶„Å≥„Åæ„Åô„ÄÇ

<strong>[Á¨¨5Á´†: „ÇØ„É©„Ç¶„ÉâHPCÊ¥ªÁî®„Å®ÊúÄÈÅ©Âåñ ‚Üí](./chapter-5.md)</strong>

---

<strong>„É©„Ç§„Çª„É≥„Çπ</strong>: CC BY 4.0
<strong>‰ΩúÊàêÊó•</strong>: 2025-10-17
<strong>‰ΩúÊàêËÄÖ</strong>: Dr. Yusuke Hashimoto, Tohoku University
<div class="navigation">
    <a href="chapter-3.html" class="nav-button">‚Üê Á¨¨3Á´†</a>
    <a href="index.html" class="nav-button">„Ç∑„É™„Éº„Ç∫ÁõÆÊ¨°„Å´Êàª„Çã</a>
    <a href="chapter-5.html" class="nav-button">Á¨¨5Á´† ‚Üí</a>
</div>
    </main>

    <footer>
        <p><strong>‰ΩúÊàêËÄÖ</strong>: AI Terakoya Content Team</p>
        <p><strong>Áõ£‰øÆ</strong>: Dr. Yusuke HashimotoÔºàÊù±ÂåóÂ§ßÂ≠¶Ôºâ</p>
        <p><strong>„Éê„Éº„Ç∏„Éß„É≥</strong>: 1.0 | <strong>‰ΩúÊàêÊó•</strong>: 2025-10-17</p>
        <p><strong>„É©„Ç§„Çª„É≥„Çπ</strong>: Creative Commons BY 4.0</p>
        <p>¬© 2025 AI Terakoya. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mermaidCodeBlocks = document.querySelectorAll('pre.codehilite code.language-mermaid, pre code.language-mermaid');

            mermaidCodeBlocks.forEach(function(codeBlock) {
                const pre = codeBlock.parentElement;
                const mermaidCode = codeBlock.textContent;

                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode.trim();

                pre.parentNode.replaceChild(mermaidDiv, pre);
            });

            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'default'
                });
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }
        });
    </script>
</body>
</html>
