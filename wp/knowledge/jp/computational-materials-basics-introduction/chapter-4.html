<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第4章：フォノン計算と熱力学特性 - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>第4章：フォノン計算と熱力学特性</h1>
            <p class="subtitle">格子振動から熱伝導まで</p>
            <div class="meta">
                <span class="meta-item">📖 読了時間: 20-25分</span>
                <span class="meta-item">📊 難易度: 中級〜上級</span>
                <span class="meta-item">💻 コード例: 6個</span>
            </div>
        </div>
    </header>

    <main class="container">
        
<p><h1>第4章：フォノン計算と熱力学特性</h1></p>

<p><h2>学習目標</h2></p>

<p>この章を読むことで、以下を習得できます：</p>
<ul>
<li>格子振動（フォノン）の理論的基礎を理解する</li>
<li>調和近似と動力学行列の概念を説明できる</li>
<li>Phonopyで実際にフォノン計算を実行できる</li>
<li>フォノンバンド構造と状態密度を解釈できる</li>
<li>熱力学特性（比熱、自由エネルギー、エントロピー）を計算できる</li>
</ul>

<p>---</p>

<p><h2>4.1 格子振動の理論</h2></p>

<p><h3>調和振動子モデル</h3></p>

<p>結晶中の原子は平衡位置$\mathbf{R}_I^0$の周りで振動します。変位を$\mathbf{u}_I$とすると：</p>

<p>$$</p>
<p>\mathbf{R}_I = \mathbf{R}_I^0 + \mathbf{u}_I</p>
<p>$$</p>

<p>ポテンシャルエネルギーをTaylor展開（調和近似）：</p>

<p>$$</p>
<p>U = U_0 + \sum_I \frac{\partial U}{\partial \mathbf{u}_I}\Bigg|_0 \mathbf{u}_I + \frac{1}{2}\sum_{I,J} \mathbf{u}_I \cdot \frac{\partial^2 U}{\partial \mathbf{u}_I \partial \mathbf{u}_J}\Bigg|_0 \cdot \mathbf{u}_J + O(\mathbf{u}^3)</p>
<p>$$</p>

<p>平衡位置では第1項がゼロなので：</p>

<p>$$</p>
<p>U \approx U_0 + \frac{1}{2}\sum_{I,J} \mathbf{u}_I \cdot \mathbf{\Phi}_{IJ} \cdot \mathbf{u}_J</p>
<p>$$</p>

<p>$\mathbf{\Phi}_{IJ}$は<strong>力定数行列</strong>（force constant matrix）：</p>

<p>$$</p>
<p>\Phi_{IJ}^{\alpha\beta} = \frac{\partial^2 U}{\partial u_I^\alpha \partial u_J^\beta}\Bigg|_0</p>
<p>$$</p>

<p><h3>運動方程式</h3></p>

<p>原子$I$の運動方程式：</p>

<p>$$</p>
<p>M_I \frac{d^2 u_I^\alpha}{dt^2} = -\sum_{J,\beta} \Phi_{IJ}^{\alpha\beta} u_J^\beta</p>
<p>$$</p>

<p>平面波解を仮定：</p>

<p>$$</p>
<p>u_I^\alpha = \frac{1}{\sqrt{M_I}} e_I^\alpha(\mathbf{k}) e^{i(\mathbf{k}\cdot\mathbf{R}_I - \omega t)}</p>
<p>$$</p>

<p><strong>動力学行列</strong>（dynamical matrix）を導入：</p>

<p>$$</p>
<p>D_{IJ}^{\alpha\beta}(\mathbf{k}) = \frac{1}{\sqrt{M_I M_J}} \Phi_{IJ}^{\alpha\beta} e^{i\mathbf{k}\cdot(\mathbf{R}_I - \mathbf{R}_J)}</p>
<p>$$</p>

<p><h3>固有値問題</h3></p>

<p>$$</p>
<p>\sum_{J,\beta} D_{IJ}^{\alpha\beta}(\mathbf{k}) e_J^\beta(\mathbf{k}) = \omega^2(\mathbf{k}) e_I^\alpha(\mathbf{k})</p>
<p>$$</p>

<ul>
<li>$\omega(\mathbf{k})$: フォノンの角振動数（フォノン分散）</li>
<li>$\mathbf{e}(\mathbf{k})$: フォノンの固有ベクトル（偏極ベクトル）</li>
</ul>

<p><strong>フォノンバンドの数</strong>: $3N_{\text{atom}}$本（単位胞内原子数$N_{\text{atom}}$に対して）</p>

<p>---</p>

<p><h2>4.2 フォノンの分類</h2></p>

<p><h3>音響モード（Acoustic modes）</h3></p>

<ul>
<li>$\omega(\mathbf{k}) \to 0$ as $\mathbf{k} \to 0$</li>
<li>Γ点（$\mathbf{k}=0$）で周波数がゼロ</li>
<li>3本（1本の縦波LA、2本の横波TA）</li>
<li>物理的意味: 並進運動</li>
</ul>

<p><h3>光学モード（Optical modes）</h3></p>

<ul>
<li>$\omega(\mathbf{k}) \neq 0$ at $\mathbf{k} = 0$</li>
<li>Γ点で有限の周波数</li>
<li>$3(N_{\text{atom}} - 1)$本</li>
<li>物理的意味: 単位胞内の相対運動</li>
</ul>

<p><h3>縦波（Longitudinal）vs 横波（Transverse）</h3></p>

<ul>
<li><strong>縦波（L）</strong>: 振動方向が波の進行方向と平行</li>
<li><strong>横波（T）</strong>: 振動方向が波の進行方向と垂直</li>
</ul>

<p><strong>単原子結晶（Si, Cuなど）</strong>:</p>
<ul>
<li>音響モード: 3本（1 LA + 2 TA）</li>
<li>光学モード: なし</li>
</ul>

<p><strong>2原子結晶（NaCl, GaAsなど）</strong>:</p>
<ul>
<li>音響モード: 3本</li>
<li>光学モード: 3本（1 LO + 2 TO）</li>
</ul>

<p>---</p>

<p><h2>4.3 Phonopyによる実践</h2></p>

<p><h3>インストール</h3></p>

<p><pre><code class="language-bash">pip install phonopy</p>
<p><h1>またはcondaで</h1></p>
<p>conda install -c conda-forge phonopy</p>
<p></code></pre></p>

<p><h3>Example 1: Siのフォノン計算（GPAW使用）</h3></p>

<p><strong>Step 1: 基底状態計算</strong></p>

<p><pre><code class="language-python">from ase.build import bulk</p>
<p>from gpaw import GPAW, PW</p>

<p><h1>Si結晶の作成</h1></p>
<p>si = bulk('Si', 'diamond', a=5.43)</p>

<p><h1>DFT計算</h1></p>
<p>calc = GPAW(mode=PW(400),</p>
<p>            xc='PBE',</p>
<p>            kpts=(8, 8, 8),</p>
<p>            txt='si_gs.txt')</p>

<p>si.calc = calc</p>
<p>si.get_potential_energy()</p>
<p>calc.write('si_groundstate.gpw')</p>
<p></code></pre></p>

<p><strong>Step 2: Phonopy用のスーパーセル作成</strong></p>

<p><pre><code class="language-bash"><h1>phonopy_disp.confを作成</h1></p>
<p>cat > phonopy_disp.conf <<EOF</p>
<p>DIM = 2 2 2</p>
<p>ATOM_NAME = Si</p>
<p>EOF</p>

<p><h1>Phonopyで変位構造を生成</h1></p>
<p>phonopy -d --dim="2 2 2" --gpaw</p>
<p></code></pre></p>

<p>これにより<code>supercell-XXX.py</code>ファイルが生成されます。</p>

<p><strong>Step 3: 力の計算</strong></p>

<p><pre><code class="language-python"><h1>supercell-001.pyを実行（各変位構造で）</h1></p>
<p>from gpaw import GPAW</p>

<p>calc = GPAW('si_groundstate.gpw', txt=None)</p>
<p>atoms = calc.get_atoms()</p>
<p>forces = atoms.get_forces()</p>

<p><h1>FORCE_SETSファイルに書き込み（Phonopyが読み込む形式）</h1></p>
<p>import numpy as np</p>
<p>np.savetxt('forces_001.dat', forces)</p>
<p></code></pre></p>

<p><strong>全変位構造に対して繰り返す</strong>（通常はスクリプトで自動化）</p>

<p><strong>Step 4: フォノン計算</strong></p>

<p><pre><code class="language-python">from phonopy import Phonopy</p>
<p>from phonopy.interface.gpaw import read_gpaw</p>
<p>import matplotlib.pyplot as plt</p>

<p><h1>Phonopyオブジェクトの作成</h1></p>
<p>unitcell, calc_forces = read_gpaw('si_groundstate.gpw')</p>
<p>phonon = Phonopy(unitcell, [[2, 0, 0], [0, 2, 0], [0, 0, 2]])</p>

<p><h1>力定数行列の設定（FORCE_SETSから）</h1></p>
<p>phonon.set_displacement_dataset(dataset)</p>
<p>phonon.produce_force_constants()</p>

<p><h1>バンド構造の計算</h1></p>
<p>path = [[[0, 0, 0], [0.5, 0, 0.5], [0.625, 0.25, 0.625],</p>
<p>         [0.375, 0.375, 0.75], [0, 0, 0], [0.5, 0.5, 0.5]]]</p>
<p>labels = ["$\\Gamma$", "X", "U", "K", "$\\Gamma$", "L"]</p>
<p>qpoints, connections = phonon.get_band_structure_plot_data(path)</p>

<p>phonon.plot_band_structure(path, labels=labels)</p>
<p>plt.ylabel('Frequency (THz)')</p>
<p>plt.savefig('si_phonon_band.png', dpi=150)</p>
<p>plt.show()</p>

<p><h1>状態密度（DOS）</h1></p>
<p>phonon.set_mesh([20, 20, 20])</p>
<p>phonon.set_total_DOS()</p>
<p>dos_freq, dos_val = phonon.get_total_DOS()</p>

<p>plt.figure(figsize=(8, 6))</p>
<p>plt.plot(dos_freq, dos_val, linewidth=2)</p>
<p>plt.xlabel('Frequency (THz)', fontsize=12)</p>
<p>plt.ylabel('DOS (states/THz)', fontsize=12)</p>
<p>plt.title('Si Phonon DOS', fontsize=14)</p>
<p>plt.grid(alpha=0.3)</p>
<p>plt.savefig('si_phonon_dos.png', dpi=150)</p>
<p>plt.show()</p>
<p></code></pre></p>

<p>---</p>

<p><h3>Example 2: 完全な自動化スクリプト</h3></p>

<p><pre><code class="language-python">from ase.build import bulk</p>
<p>from gpaw import GPAW, PW</p>
<p>from phonopy import Phonopy</p>
<p>from phonopy.structure.atoms import PhonopyAtoms</p>
<p>import numpy as np</p>

<p>def calculate_phonon(symbol='Si', a=5.43, dim=(2,2,2)):</p>
<p>    """</p>
<p>    完全自動フォノン計算</p>
<p>    """</p>
<p>    <h1>1. 基底状態計算</h1></p>
<p>    print("Step 1: Ground state calculation...")</p>
<p>    atoms = bulk(symbol, 'diamond', a=a)</p>
<p>    calc = GPAW(mode=PW(400), xc='PBE', kpts=(8,8,8), txt=None)</p>
<p>    atoms.calc = calc</p>
<p>    atoms.get_potential_energy()</p>

<p>    <h1>2. Phonopyセットアップ</h1></p>
<p>    print("Step 2: Generate displacements...")</p>
<p>    cell = PhonopyAtoms(symbols=[symbol]*len(atoms),</p>
<p>                       cell=atoms.cell,</p>
<p>                       scaled_positions=atoms.get_scaled_positions())</p>

<p>    phonon = Phonopy(cell, np.diag(dim))</p>
<p>    phonon.generate_displacements(distance=0.01)</p>

<p>    <h1>3. 力の計算</h1></p>
<p>    print(f"Step 3: Calculate forces for {len(phonon.supercells_with_displacements)} supercells...")</p>
<p>    set_of_forces = []</p>

<p>    for i, scell in enumerate(phonon.supercells_with_displacements):</p>
<p>        supercell = bulk(symbol, 'diamond', a=a).repeat(dim)</p>
<p>        supercell.positions = scell.positions</p>
<p>        supercell.calc = calc</p>
<p>        forces = supercell.get_forces()</p>
<p>        drift_force = forces.sum(axis=0)</p>
<p>        for force in forces:</p>
<p>            force -= drift_force / len(forces)  <h1>ドリフト補正</h1></p>
<p>        set_of_forces.append(forces)</p>

<p>    <h1>4. フォノン計算</h1></p>
<p>    print("Step 4: Phonon calculation...")</p>
<p>    phonon.produce_force_constants(forces=set_of_forces)</p>

<p>    <h1>バンド構造</h1></p>
<p>    path = [[[0, 0, 0], [0.5, 0, 0.5], [0.625, 0.25, 0.625],</p>
<p>             [0.375, 0.375, 0.75], [0, 0, 0], [0.5, 0.5, 0.5]]]</p>
<p>    labels = ["$\\Gamma$", "X", "U", "K", "$\\Gamma$", "L"]</p>

<p>    phonon.auto_band_structure(plot=True, labels=labels, filename=f'{symbol}_band.png')</p>

<p>    <h1>DOS</h1></p>
<p>    phonon.auto_total_dos(plot=True, filename=f'{symbol}_dos.png')</p>

<p>    print("Done!")</p>
<p>    return phonon</p>

<p><h1>実行</h1></p>
<p>si_phonon = calculate_phonon('Si', a=5.43, dim=(2,2,2))</p>
<p></code></pre></p>

<p>---</p>

<p><h2>4.4 熱力学特性の計算</h2></p>

<p><h3>自由エネルギー</h3></p>

<p><strong>Helmholtz自由エネルギー</strong>（NVT）:</p>

<p>$$</p>
<p>F(T) = U_0 + k_B T \sum_{\mathbf{q},j} \ln\left[2\sinh\left(\frac{\hbar\omega_{\mathbf{q}j}}{2k_B T}\right)\right]</p>
<p>$$</p>

<ul>
<li>$U_0$: ゼロ点エネルギー</li>
<li>$\omega_{\mathbf{q}j}$: 波数$\mathbf{q}$、バンド$j$のフォノン周波数</li>
</ul>

<p><h3>内部エネルギー</h3></p>

<p>$$</p>
<p>U(T) = U_0 + \sum_{\mathbf{q},j} \hbar\omega_{\mathbf{q}j} \left[\frac{1}{2} + n_B(\omega_{\mathbf{q}j}, T)\right]</p>
<p>$$</p>

<p>$n_B(\omega, T)$はBose-Einstein分布関数：</p>

<p>$$</p>
<p>n_B(\omega, T) = \frac{1}{e^{\hbar\omega/(k_B T)} - 1}</p>
<p>$$</p>

<p><h3>エントロピー</h3></p>

<p>$$</p>
<p>S(T) = -\left(\frac{\partial F}{\partial T}\right)_V = k_B \sum_{\mathbf{q},j} \left[\frac{\hbar\omega_{\mathbf{q}j}}{k_B T} n_B(\omega_{\mathbf{q}j}, T) - \ln(1 - e^{-\hbar\omega_{\mathbf{q}j}/(k_B T)})\right]</p>
<p>$$</p>

<p><h3>比熱（定積）</h3></p>

<p>$$</p>
<p>C_V(T) = \left(\frac{\partial U}{\partial T}\right)_V = k_B \sum_{\mathbf{q},j} \left(\frac{\hbar\omega_{\mathbf{q}j}}{k_B T}\right)^2 \frac{e^{\hbar\omega_{\mathbf{q}j}/(k_B T)}}{(e^{\hbar\omega_{\mathbf{q}j}/(k_B T)} - 1)^2}</p>
<p>$$</p>

<p><h3>Phonopyでの実装</h3></p>

<p><pre><code class="language-python">import numpy as np</p>
<p>import matplotlib.pyplot as plt</p>

<p><h1>温度範囲</h1></p>
<p>temperatures = np.arange(0, 1000, 10)</p>

<p><h1>熱力学特性を計算</h1></p>
<p>si_phonon.set_mesh([20, 20, 20])</p>
<p>si_phonon.set_thermal_properties(t_step=10, t_max=1000, t_min=0)</p>

<p>tp_dict = si_phonon.get_thermal_properties_dict()</p>
<p>temps = tp_dict['temperatures']</p>
<p>free_energy = tp_dict['free_energy']  <h1>kJ/mol</h1></p>
<p>entropy = tp_dict['entropy']  <h1>J/K/mol</h1></p>
<p>heat_capacity = tp_dict['heat_capacity']  <h1>J/K/mol</h1></p>

<p><h1>プロット</h1></p>
<p>fig, axes = plt.subplots(2, 2, figsize=(12, 10))</p>

<p><h1>自由エネルギー</h1></p>
<p>axes[0,0].plot(temps, free_energy, linewidth=2)</p>
<p>axes[0,0].set_xlabel('Temperature (K)', fontsize=12)</p>
<p>axes[0,0].set_ylabel('Free Energy (kJ/mol)', fontsize=12)</p>
<p>axes[0,0].set_title('Helmholtz Free Energy', fontsize=14)</p>
<p>axes[0,0].grid(alpha=0.3)</p>

<p><h1>エントロピー</h1></p>
<p>axes[0,1].plot(temps, entropy, linewidth=2, color='orange')</p>
<p>axes[0,1].set_xlabel('Temperature (K)', fontsize=12)</p>
<p>axes[0,1].set_ylabel('Entropy (J/K/mol)', fontsize=12)</p>
<p>axes[0,1].set_title('Entropy', fontsize=14)</p>
<p>axes[0,1].grid(alpha=0.3)</p>

<p><h1>比熱</h1></p>
<p>axes[1,0].plot(temps, heat_capacity, linewidth=2, color='green')</p>
<p>axes[1,0].axhline(3*8.314, color='red', linestyle='--', label='Dulong-Petit (3R)')</p>
<p>axes[1,0].set_xlabel('Temperature (K)', fontsize=12)</p>
<p>axes[1,0].set_ylabel('Heat Capacity (J/K/mol)', fontsize=12)</p>
<p>axes[1,0].set_title('Heat Capacity at Constant Volume', fontsize=14)</p>
<p>axes[1,0].legend()</p>
<p>axes[1,0].grid(alpha=0.3)</p>

<p><h1>内部エネルギー（F = U - TSから計算）</h1></p>
<p>internal_energy = free_energy + temps * entropy / 1000  <h1>kJ/mol</h1></p>
<p>axes[1,1].plot(temps, internal_energy, linewidth=2, color='purple')</p>
<p>axes[1,1].set_xlabel('Temperature (K)', fontsize=12)</p>
<p>axes[1,1].set_ylabel('Internal Energy (kJ/mol)', fontsize=12)</p>
<p>axes[1,1].set_title('Internal Energy', fontsize=14)</p>
<p>axes[1,1].grid(alpha=0.3)</p>

<p>plt.tight_layout()</p>
<p>plt.savefig('si_thermodynamics.png', dpi=150)</p>
<p>plt.show()</p>

<p><h1>デバイ温度の計算</h1></p>
<p><h1>比熱が3R（Dulong-Petit極限）の63%に達する温度</h1></p>
<p>R = 8.314  <h1>J/K/mol</h1></p>
<p>target_cv = 0.63 <em> 3 </em> R</p>
<p>idx = np.argmin(np.abs(heat_capacity - target_cv))</p>
<p>theta_D = temps[idx]</p>
<p>print(f"デバイ温度: {theta_D:.1f} K")</p>
<p>print(f"実験値（Si）: 645 K")</p>
<p></code></pre></p>

<p>---</p>

<p><h2>4.5 熱膨張係数</h2></p>

<p><h3>準調和近似（Quasi-harmonic approximation）</h3></p>

<p>体積を変えてフォノン計算を複数回実行：</p>

<p>$$</p>
<p>\alpha(T) = \frac{1}{V}\left(\frac{\partial V}{\partial T}\right)_P = -\frac{1}{V}\frac{(\partial^2 F/\partial T \partial V)}{(\partial^2 F/\partial V^2)}</p>
<p>$$</p>

<p><h3>実装例</h3></p>

<p><pre><code class="language-python">import numpy as np</p>
<p>import matplotlib.pyplot as plt</p>

<p><h1>異なる格子定数で計算</h1></p>
<p>lattice_constants = np.linspace(5.35, 5.51, 5)  <h1>Å</h1></p>
<p>phonons = []</p>

<p>for a in lattice_constants:</p>
<p>    print(f"Calculating phonon for a = {a:.3f} Å...")</p>
<p>    phonon = calculate_phonon('Si', a=a, dim=(2,2,2))</p>
<p>    phonons.append(phonon)</p>

<p><h1>各温度、各体積で自由エネルギーを計算</h1></p>
<p>temps = np.arange(0, 1000, 50)</p>
<p>volumes = (lattice_constants / 5.43)**3  <h1>規格化体積</h1></p>
<p>free_energies = np.zeros((len(temps), len(volumes)))</p>

<p>for i, phonon in enumerate(phonons):</p>
<p>    phonon.set_mesh([20, 20, 20])</p>
<p>    phonon.set_thermal_properties(t_step=50, t_max=1000, t_min=0)</p>
<p>    tp = phonon.get_thermal_properties_dict()</p>
<p>    free_energies[:, i] = tp['free_energy']</p>

<p><h1>各温度で平衡体積を見つける（F最小）</h1></p>
<p>V_eq = np.zeros(len(temps))</p>
<p>for i, T in enumerate(temps):</p>
<p>    <h1>2次多項式フィット</h1></p>
<p>    coeffs = np.polyfit(volumes, free_energies[i], 2)</p>
<p>    V_eq[i] = -coeffs[1] / (2 * coeffs[0])  <h1>極値</h1></p>

<p><h1>熱膨張係数</h1></p>
<p>alpha = np.gradient(V_eq, temps) / V_eq</p>

<p><h1>プロット</h1></p>
<p>plt.figure(figsize=(8, 6))</p>
<p>plt.plot(temps, alpha * 1e6, linewidth=2)</p>
<p>plt.xlabel('Temperature (K)', fontsize=12)</p>
<p>plt.ylabel('Thermal expansion coefficient (10$^{-6}$ K$^{-1}$)', fontsize=12)</p>
<p>plt.title('Si Thermal Expansion (QHA)', fontsize=14)</p>
<p>plt.grid(alpha=0.3)</p>
<p>plt.savefig('si_thermal_expansion.png', dpi=150)</p>
<p>plt.show()</p>

<p>print(f"室温（300K）での熱膨張係数: {alpha[6]*1e6:.2f} × 10⁻⁶ K⁻¹")</p>
<p>print(f"実験値: 2.6 × 10⁻⁶ K⁻¹")</p>
<p></code></pre></p>

<p>---</p>

<p><h2>4.6 フォノン計算の応用</h2></p>

<p><h3>1. 格子熱伝導率</h3></p>

<p><strong>Boltzmann輸送方程式</strong>からの推定（簡易版）:</p>

<p>$$</p>
<p>\kappa = \frac{1}{3} \sum_{\mathbf{q},j} C_{\mathbf{q}j} v_{\mathbf{q}j}^2 \tau_{\mathbf{q}j}</p>
<p>$$</p>

<ul>
<li>$C_{\mathbf{q}j}$: モードごとの比熱</li>
<li>$v_{\mathbf{q}j}$: 群速度（$\partial\omega/\partial\mathbf{q}$）</li>
<li>$\tau_{\mathbf{q}j}$: 緩和時間（フォノン散乱）</li>
</ul>

<p><strong>PhonoPyでの群速度計算</strong>:</p>

<p><pre><code class="language-python"><h1>群速度の計算</h1></p>
<p>si_phonon.set_group_velocity()</p>
<p>group_velocities = si_phonon.get_group_velocity()</p>

<p>print("Group velocities at Gamma point:")</p>
<p>print(group_velocities[0])  <h1>[band, cartesian_direction]</h1></p>
<p></code></pre></p>

<p><h3>2. 超伝導の臨界温度（Tc）</h3></p>

<p><strong>McMillan式</strong>（簡易版）:</p>

<p>$$</p>
<p>T_c = \frac{\omega_{\text{log}}}{1.2} \exp\left[-\frac{1.04(1+\lambda)}{\lambda - \mu^*(1+0.62\lambda)}\right]</p>
<p>$$</p>

<ul>
<li>$\omega_{\text{log}}$: 対数平均フォノン周波数</li>
<li>$\lambda$: 電子-フォノン結合定数</li>
<li>$\mu^*$: クーロン擬ポテンシャル</li>
</ul>

<p><h3>3. 相転移の検出</h3></p>

<p><strong>虚数フォノンモード</strong>が存在すると、結晶構造が不安定：</p>

<p><pre><code class="language-python"><h1>負の振動数（虚数モード）のチェック</h1></p>
<p>frequencies = si_phonon.get_frequencies(q=[0, 0, 0])</p>
<p>if np.any(frequencies < -1e-3):</p>
<p>    print("Warning: Imaginary phonon modes detected!")</p>
<p>    print("Structure may be unstable.")</p>
<p></code></pre></p>

<p>---</p>

<p><h2>4.7 本章のまとめ</h2></p>

<p><h3>学んだこと</h3></p>

<ol>
<li><strong>格子振動の理論</strong></li>
</ol>
<p>   - 調和近似</p>
<p>   - 動力学行列</p>
<p>   - フォノン分散関係</p>

<ol>
<li><strong>フォノンの分類</strong></li>
</ol>
<p>   - 音響モード vs 光学モード</p>
<p>   - 縦波 vs 横波</p>

<ol>
<li><strong>Phonopyによる実践</strong></li>
</ol>
<p>   - フォノンバンド構造</p>
<p>   - フォノン状態密度</p>
<p>   - 完全自動化スクリプト</p>

<ol>
<li><strong>熱力学特性</strong></li>
</ol>
<p>   - 自由エネルギー</p>
<p>   - 内部エネルギー</p>
<p>   - エントロピー</p>
<p>   - 比熱</p>
<p>   - デバイ温度</p>

<ol>
<li><strong>応用</strong></li>
</ol>
<p>   - 熱膨張係数（準調和近似）</p>
<p>   - 熱伝導率</p>
<p>   - 相転移の検出</p>

<p><h3>重要なポイント</h3></p>

<ul>
<li>フォノンは量子化された格子振動</li>
<li>調和近似で十分な精度（多くの場合）</li>
<li>熱力学特性はフォノンから計算可能</li>
<li>実験との良い一致（Si: デバイ温度、熱膨張係数）</li>
</ul>

<p><h3>次の章へ</h3></p>

<p>第5章では、DFT計算と機械学習を統合した最新手法を学びます。</p>

<p>---</p>

<p><h2>演習問題</h2></p>

<p><h3>問題1（難易度：easy）</h3></p>

<p>音響モードと光学モードの違いを、物理的意味とともに説明してください。</p>

<p><details></p>
<p><summary>解答例</summary></p>

<p><strong>音響モード（Acoustic modes）</strong>:</p>

<p><strong>数</strong>: 3本（1 LA + 2 TA）</p>
<p><strong>特徴</strong>: Γ点（$\mathbf{k}=0$）で周波数がゼロ（$\omega \to 0$ as $\mathbf{k} \to 0$）</p>
<p><strong>物理的意味</strong>: 結晶全体の並進運動、音波に対応</p>
<ul>
<li>すべての原子が同じ方向・位相で振動</li>
<li>長波長極限で弾性波（音波）になる</li>
</ul>

<p><strong>光学モード（Optical modes）</strong>:</p>

<p><strong>数</strong>: $3(N_{\text{atom}} - 1)$本（単位胞内原子数$N_{\text{atom}}$）</p>
<p><strong>特徴</strong>: Γ点で有限の周波数（$\omega(\mathbf{k}=0) \neq 0$）</p>
<p><strong>物理的意味</strong>: 単位胞内の原子の相対運動、光（赤外線）と結合</p>
<ul>
<li>異なる原子が逆位相で振動</li>
<li>イオン結晶では電気双極子モーメントが生じる → 赤外吸収</li>
</ul>

<p><strong>例（NaCl結晶）</strong>:</p>
<ul>
<li>音響モード: NaとClが同じ方向に動く</li>
<li>光学モード: NaとClが逆方向に動く → 双極子 → 光吸収</li>
</ul>

<p></details></p>

<p><h3>問題2（難易度：medium）</h3></p>

<p>デバイ温度$\theta_D$の物理的意味と、比熱との関係を説明してください。</p>

<p><details></p>
<p><summary>解答例</summary></p>

<p><strong>デバイ温度$\theta_D$の定義</strong>:</p>

<p>デバイモデルでは、すべてのフォノンモードを単一のデバイ周波数$\omega_D$で近似します：</p>

<p>$$</p>
<p>\theta_D = \frac{\hbar\omega_D}{k_B}</p>
<p>$$</p>

<p><strong>物理的意味</strong>:</p>

<ol>
<li><strong>量子効果の境界温度</strong>:</li>
</ol>
<p>   - $T \ll \theta_D$: 量子効果が支配的（低温）</p>
<p>   - $T \gg \theta_D$: 古典的振る舞い（高温）</p>

<ol>
<li><strong>フォノン励起の目安</strong>:</li>
</ol>
<p>   - $\theta_D$は最高フォノン周波数に対応</p>
<p>   - $T < \theta_D$: 高エネルギーフォノンは励起されない</p>
<p>   - $T > \theta_D$: すべてのフォノンモードが励起</p>

<p><strong>比熱との関係</strong>:</p>

<p><strong>低温（$T \ll \theta_D$）</strong>: Debye $T^3$則</p>

<p>$$</p>
<p>C_V \propto T^3</p>
<p>$$</p>

<p>フォノンの量子効果が顕著。</p>

<p><strong>高温（$T \gg \theta_D$）</strong>: Dulong-Petit則</p>

<p>$$</p>
<p>C_V \to 3Nk_B = 3R</p>
<p>$$</p>

<p>すべての自由度が励起され、古典的極限。</p>

<p><strong>典型的な値</strong>:</p>
<ul>
<li>Si: $\theta_D \approx 645$ K</li>
<li>Diamond: $\theta_D \approx 2230$ K（硬い格子 → 高周波）</li>
<li>Pb: $\theta_D \approx 105$ K（柔らかい格子 → 低周波）</li>
</ul>

<p><strong>実用的意味</strong>:</p>
<ul>
<li>$\theta_D$が高い → 室温でも量子効果が重要</li>
<li>$\theta_D$が低い → 室温で古典的</li>
</ul>

<p></details></p>

<p><h3>問題3（難易度：hard）</h3></p>

<p>準調和近似（QHA）で熱膨張係数を計算する際、なぜ複数の体積でフォノン計算が必要なのか説明してください。</p>

<p><details></p>
<p><summary>解答例</summary></p>

<p><strong>調和近似の限界</strong>:</p>

<p>調和近似では、自由エネルギー$F(V, T)$の体積依存性が以下のようになります：</p>

<p>$$</p>
<p>F_{\text{harm}}(V, T) = U_0(V) + k_B T \sum_{\mathbf{q},j} \ln\left[2\sinh\left(\frac{\hbar\omega_{\mathbf{q}j}(V)}{2k_B T}\right)\right]</p>
<p>$$</p>

<p>ここで$\omega_{\mathbf{q}j}(V)$は体積$V$に依存します。</p>

<p>しかし、調和近似では<strong>格子定数が一定</strong>と仮定しているため、以下の問題があります：</p>

<ol>
<li><strong>熱膨張が記述できない</strong>: $(∂V/∂T)_P = 0$</li>
<li><strong>熱容量が定積のみ</strong>: $C_P = C_V$（実際は$C_P > C_V$）</li>
</ol>

<p><strong>準調和近似（QHA）の導入</strong>:</p>

<p>QHAでは、<strong>異なる体積で独立に調和近似を適用</strong>します：</p>

<p><strong>手順</strong>:</p>

<ol>
<li>複数の体積$V_1, V_2, \ldots, V_n$でフォノン計算</li>
<li>各体積で自由エネルギー$F(V_i, T)$を計算</li>
<li>各温度$T$で自由エネルギーを最小化する体積$V_{\text{eq}}(T)$を見つける：</li>
</ol>
<p>   $$\left(\frac{\partial F}{\partial V}\right)_T = 0$$</p>
<ol>
<li>熱膨張係数を計算：</li>
</ol>
<p>   $$\alpha(T) = \frac{1}{V}\left(\frac{\partial V}{\partial T}\right)_P$$</p>

<p><strong>なぜ複数の体積が必要か</strong>:</p>

<ul>
<li>体積依存性$F(V, T)$を知るため</li>
<li>自由エネルギーの曲率$(\partial^2 F/\partial V^2)$が必要</li>
<li>最小値の位置$V_{\text{eq}}(T)$が温度依存</li>
</ul>

<p><strong>QHAの仮定</strong>:</p>

<ul>
<li>フォノン周波数の体積依存性を考慮</li>
<li>しかし、フォノン間の非調和相互作用は無視</li>
<li>各体積で独立に調和近似</li>
</ul>

<p><strong>QHAの限界</strong>:</p>

<ul>
<li>高温（融点近く）では不正確</li>
<li>強い非調和性（例: 負の熱膨張材料）は記述困難</li>
<li>完全な非調和計算（TDEP, SSCHAなど）が必要</li>
</ul>

<p><strong>計算コスト</strong>:</p>

<ul>
<li>5-10個の体積でフォノン計算 → 5-10倍のコスト</li>
<li>しかし、熱膨張係数が得られる利点</li>
</ul>

<p></details></p>

<p>---</p>

<p><h2>参考文献</h2></p>

<ol>
<li>Dove, M. T. (1993). <em>Introduction to Lattice Dynamics</em>. Cambridge University Press.</li>
</ol>

<ol>
<li>Togo, A., & Tanaka, I. (2015). "First principles phonon calculations in materials science." <em>Scripta Materialia</em>, 108, 1-5.</li>
</ol>
<p>   DOI: <a href="https://doi.org/10.1016/j.scriptamat.2015.07.021">10.1016/j.scriptamat.2015.07.021</a></p>

<ol>
<li>Phonopy Documentation: https://phonopy.github.io/phonopy/</li>
</ol>

<ol>
<li>Shulumba, N., et al. (2017). "Temperature-dependent elastic properties of Ti$_x$Zr$_{1-x}$N alloys." <em>Applied Physics Letters</em>, 111, 061901.</li>
</ol>

<p>---</p>

<p><h2>著者情報</h2></p>

<p><strong>作成者</strong>: MI Knowledge Hub Content Team</p>
<p><strong>監修</strong>: Dr. Yusuke Hashimoto（東北大学）</p>
<p><strong>作成日</strong>: 2025-10-17</p>
<p><strong>バージョン</strong>: 1.0</p>
<p><strong>シリーズ</strong>: 計算材料科学基礎入門 v1.0</p>

<p><strong>ライセンス</strong>: Creative Commons BY-NC-SA 4.0</p>


        
        <div class="navigation">
            <a href="chapter-5.html" class="nav-button">次章: 第5章 →</a>
            <a href="index.html" class="nav-button">← シリーズ目次に戻る</a>
            <a href="chapter-3.html" class="nav-button">← 前章: 第3章</a>
        </div>
    
    </main>

    <footer>
        <p><strong>作成者</strong>: AI Terakoya Content Team</p>
        <p><strong>監修</strong>: Dr. Yusuke Hashimoto(東北大学)</p>
        <p><strong>バージョン</strong>: 1.0 | <strong>作成日</strong>: 2025-10-17</p>
        <p><strong>ライセンス</strong>: Creative Commons BY 4.0</p>
        <p>© 2025 AI Terakoya. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mermaidCodeBlocks = document.querySelectorAll('pre.codehilite code.language-mermaid, pre code.language-mermaid');

            mermaidCodeBlocks.forEach(function(codeBlock) {
                const pre = codeBlock.parentElement;
                const mermaidCode = codeBlock.textContent;

                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode.trim();

                pre.parentNode.replaceChild(mermaidDiv, pre);
            });

            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'default'
                });
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }
        });
    </script>
</body>
</html>