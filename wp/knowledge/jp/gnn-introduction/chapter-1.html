<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第1章：なぜ材料科学にGNNが必要か - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>第1章：なぜ材料科学にGNNが必要か</h1>
            <p class="subtitle">従来手法の限界とグラフ表現の革新性</p>
            <div class="meta">
                <span class="meta-item">📖 読了時間: 20-25分</span>
                <span class="meta-item">📊 難易度: 初級〜中級</span>
                <span class="meta-item">💻 コード例: 6個</span>
                <span class="meta-item">📝 演習問題: 3問</span>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="learning-objectives">
            <h2>学習目標</h2>
            <p>この章を読むことで、以下を習得できます：</p>
            <ul>
                <li>従来の材料記述子（ベクトル表現）の3つの限界を理解する</li>
                <li>グラフ理論の基礎（頂点、辺、隣接行列）を学ぶ</li>
                <li>分子・材料をグラフとして表現する方法を習得する</li>
                <li>GNNが材料科学で重要視される理由を説明できる</li>
                <li>実世界のGNN成功事例（OC20、QM9、Materials Project）を知る</li>
                <li>Pythonでグラフ構造を可視化できる</li>
            </ul>
        </div>

        <h2>1.1 従来手法の限界：なぜベクトル表現では不十分か</h2>

        <h3>材料記述子（Descriptor）とは</h3>
        <p>材料科学では、分子や結晶を機械学習で扱うために「<strong>材料記述子</strong>」という数値ベクトルに変換します。</p>

        <p><strong>例：水分子（H₂O）のベクトル表現</strong></p>
        <pre><code class="language-python"># 組成ベースの記述子
water_descriptor = [
    2.0,   # H原子数
    1.0,   # O原子数
    2.55,  # 平均電気陰性度
    0.66,  # 平均原子半径 (Å)
    18.01  # 分子量
]</code></pre>

        <p>このアプローチは<strong>単純で高速</strong>ですが、重大な限界があります。</p>

        <h3>限界1：構造情報の欠落</h3>
        <p><strong>問題点</strong>: 原子の配置・結合関係が失われる</p>

        <p><strong>例：ブタン（C₄H₁₀）の異性体</strong></p>
        <pre><code class="language-python"># ブタン（n-butane）と イソブタン（isobutane）は同じ組成
n_butane = [
    4,    # C原子数
    10,   # H原子数
    2.5   # 平均価電子数
]

iso_butane = [
    4,    # C原子数（同じ）
    10,   # H原子数（同じ）
    2.5   # 平均価電子数（同じ）
]</code></pre>

        <p><strong>同じベクトル → 別の化合物！</strong></p>

        <pre><code>n-butane:     C-C-C-C（線形）
isobutane:       C
                 |
              C-C-C （分岐）</code></pre>

        <p><strong>沸点の違い</strong>：</p>
        <ul>
            <li>n-butane: -0.5°C</li>
            <li>isobutane: -11.7°C</li>
        </ul>

        <p>従来の記述子では、この<strong>11.2°Cの差</strong>を説明できません。</p>

        <h3>限界2：長距離相互作用の無視</h3>
        <p><strong>問題点</strong>: 原子間の距離・角度が考慮されない</p>

        <p><strong>例：タンパク質の折りたたみ</strong></p>
        <pre><code class="language-python">import numpy as np

# アミノ酸配列（1次元ベクトル）
sequence = [1, 5, 3, 8, 2, ...]  # アミノ酸IDの列

# 実際の3D構造は10^300通り以上の可能性
# ベクトル表現では1つの配列 → 無限の3D形状</code></pre>

        <p><strong>触媒活性の例</strong>:</p>
        <ul>
            <li>活性サイト（反応が起こる場所）は3D空間配置で決まる</li>
            <li>配列が同じでも、空間配置が違えば活性が100倍変わることも</li>
        </ul>

        <h3>限界3：置換基の非対称性</h3>
        <p><strong>問題点</strong>: 分子の対称性・非対称性が表現できない</p>

        <p><strong>例：薬剤の鏡像異性体（エナンチオマー）</strong></p>
        <pre><code>L-dopa（パーキンソン病治療薬）
    COOH
     |
  H-C-NH₂  （左手型）
     |
    CH₂-...

D-dopa（効果なし、毒性の可能性）
    COOH
     |
  H₂N-C-H  （右手型、鏡像）
     |
    CH₂-...</code></pre>

        <p><strong>ベクトル表現では同じ</strong>：</p>
        <pre><code class="language-python">L_dopa = [9, 11, 4, 2]  # C, H, O, N数
D_dopa = [9, 11, 4, 2]  # 同じベクトル</code></pre>

        <p>しかし<strong>生理活性は正反対</strong>です。</p>

        <h3>従来手法の限界まとめ</h3>
        <table>
            <thead>
                <tr>
                    <th>限界</th>
                    <th>説明</th>
                    <th>影響</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>構造情報の欠落</td>
                    <td>結合関係が失われる</td>
                    <td>異性体を区別できない</td>
                </tr>
                <tr>
                    <td>長距離相互作用の無視</td>
                    <td>3D空間配置が不明</td>
                    <td>触媒活性予測の失敗</td>
                </tr>
                <tr>
                    <td>置換基の非対称性</td>
                    <td>鏡像異性体を区別不可</td>
                    <td>薬剤の安全性問題</td>
                </tr>
            </tbody>
        </table>

        <p><strong>結論</strong>: 材料・分子の「形」を理解するには、<strong>グラフ表現</strong>が必要です。</p>

        <h2>1.2 グラフ理論の基礎：分子・材料の新しい言語</h2>

        <h3>グラフとは何か</h3>
        <blockquote>
            <p>グラフ（Graph）とは、<strong>頂点（Vertex/Node）</strong>と<strong>辺（Edge）</strong>の集合です。</p>
        </blockquote>

        <p><strong>数学的記法</strong>: G = (V, E)</p>
        <ul>
            <li>V: 頂点の集合</li>
            <li>E: 辺の集合</li>
        </ul>

        <h3>水分子（H₂O）のグラフ表現</h3>
        <pre><code class="language-mermaid">graph LR
    H1[H] ---|結合| O[O]
    O ---|結合| H2[H]

    style H1 fill:#e3f2fd
    style O fill:#ffcdd2
    style H2 fill:#e3f2fd</code></pre>

        <p><strong>Pythonでの表現</strong>:</p>
        <pre><code class="language-python"># NetworkXライブラリを使用
import networkx as nx
import matplotlib.pyplot as plt

# グラフの作成
G = nx.Graph()

# 頂点の追加（原子）
G.add_node('O', element='O', mass=16.0)
G.add_node('H1', element='H', mass=1.0)
G.add_node('H2', element='H', mass=1.0)

# 辺の追加（結合）
G.add_edge('O', 'H1', bond_type='single')
G.add_edge('O', 'H2', bond_type='single')

# 可視化
pos = {'O': (0, 0), 'H1': (-1, -1), 'H2': (1, -1)}
nx.draw(
    G, pos, with_labels=True,
    node_color='lightblue',
    node_size=2000,
    font_size=16,
    font_weight='bold'
)
plt.title('H₂O分子のグラフ表現')
plt.show()</code></pre>

        <p><strong>出力</strong>:</p>
        <pre><code>        O
       / \
      /   \
    H1     H2</code></pre>

        <h3>隣接行列（Adjacency Matrix）</h3>
        <p>グラフをコンピュータで扱うための表現方法です。</p>

        <p><strong>H₂Oの隣接行列</strong>:</p>
        <pre><code class="language-python">import numpy as np

# 頂点の順番: [O, H1, H2]
adjacency_matrix = np.array([
    [0, 1, 1],  # O: H1とH2に結合
    [1, 0, 0],  # H1: Oに結合
    [1, 0, 0]   # H2: Oに結合
])

print(adjacency_matrix)</code></pre>

        <p><strong>出力</strong>:</p>
        <pre><code>[[0 1 1]
 [1 0 0]
 [1 0 0]]</code></pre>

        <p><strong>重要なポイント</strong>:</p>
        <ul>
            <li><strong>対称行列</strong>（無向グラフの場合）</li>
            <li><strong>対角成分は0</strong>（自己ループなし）</li>
            <li><strong>疎行列</strong>（ほとんどの要素が0）</li>
        </ul>

        <h2>1.3 分子・材料のグラフ表現</h2>

        <h3>分子グラフ（Molecular Graph）</h3>
        <p><strong>定義</strong>:</p>
        <ul>
            <li><strong>頂点（Node）</strong>: 原子</li>
            <li><strong>辺（Edge）</strong>: 化学結合</li>
            <li><strong>頂点特徴量</strong>: 原子番号、電荷、混成軌道</li>
            <li><strong>辺特徴量</strong>: 結合次数、結合長、結合角</li>
        </ul>

        <h3>グラフ表現の利点</h3>
        <table>
            <thead>
                <tr>
                    <th>特徴</th>
                    <th>ベクトル表現</th>
                    <th>グラフ表現</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>異性体の区別</td>
                    <td>❌ 不可能</td>
                    <td>✅ 可能</td>
                </tr>
                <tr>
                    <td>空間配置</td>
                    <td>❌ 無視</td>
                    <td>✅ 保持</td>
                </tr>
                <tr>
                    <td>結合情報</td>
                    <td>❌ 欠落</td>
                    <td>✅ 完全</td>
                </tr>
                <tr>
                    <td>長距離相互作用</td>
                    <td>❌ 困難</td>
                    <td>✅ 可能</td>
                </tr>
                <tr>
                    <td>解釈性</td>
                    <td>✅ 高い</td>
                    <td>✅ 高い</td>
                </tr>
            </tbody>
        </table>

        <h2>1.4 GNNの利点：なぜ材料科学で注目されるのか</h2>

        <h3>利点1：End-to-Endの特徴量学習</h3>
        <p><strong>従来手法（手動特徴量設計）</strong>:</p>
        <pre><code class="language-python"># Step 1: 専門家が特徴量を設計（数週間〜数ヶ月）
features = calculate_descriptors(molecule)
# [電気陰性度, 原子半径, イオン化エネルギー, ...]

# Step 2: 機械学習モデル
model.fit(features, target)</code></pre>

        <p><strong>GNN手法（自動特徴量学習）</strong>:</p>
        <pre><code class="language-python"># グラフを入力するだけ
gnn_model.fit(graph, target)
# GNNが最適な特徴量を自動学習</code></pre>

        <p><strong>結果</strong>:</p>
        <ul>
            <li>開発時間: 数ヶ月 → 数日</li>
            <li>性能: 専門家設計を超えることも</li>
        </ul>

        <h2>1.5 成功事例：GNNが変えた材料科学</h2>

        <h3>Case Study 1: OC20 - 触媒発見の加速</h3>
        <p><strong>プロジェクト</strong>: Open Catalyst 2020 (Meta AI Research)</p>
        <p><strong>目標</strong>: クリーンエネルギー触媒の効率的探索</p>

        <p><strong>データセット</strong>:</p>
        <ul>
            <li>規模: 1.3M DFT計算</li>
            <li>対象: 触媒表面での吸着エネルギー</li>
            <li>探索空間: 10^12通りの組み合わせ</li>
        </ul>

        <p><strong>結果</strong>:</p>
        <pre><code>従来手法（DFT計算）: 1材料あたり24時間
GNN予測: 1材料あたり0.01秒（240万倍高速化）

精度: MAE = 0.43 eV（実用レベル）
発見された触媒: 10種類（実験で検証済み）</code></pre>

        <h3>成功事例の比較</h3>
        <table>
            <thead>
                <tr>
                    <th>プロジェクト</th>
                    <th>対象</th>
                    <th>データ規模</th>
                    <th>高速化</th>
                    <th>精度改善</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>OC20</strong></td>
                    <td>触媒</td>
                    <td>1.3M</td>
                    <td>240万倍</td>
                    <td>MAE 0.43 eV</td>
                </tr>
                <tr>
                    <td><strong>QM9</strong></td>
                    <td>有機分子</td>
                    <td>134k</td>
                    <td>1000倍</td>
                    <td>84-97%改善</td>
                </tr>
                <tr>
                    <td><strong>Materials Project</strong></td>
                    <td>結晶</td>
                    <td>140k+</td>
                    <td>360万倍</td>
                    <td>74%改善</td>
                </tr>
            </tbody>
        </table>

        <p><strong>共通点</strong>:</p>
        <ul>
            <li>グラフ表現の採用</li>
            <li>End-to-End学習</li>
            <li>桁違いの高速化</li>
            <li>実用レベルの精度</li>
        </ul>

        <h2>1.7 本章のまとめ</h2>

        <h3>学んだこと</h3>
        <ol>
            <li><strong>従来手法の限界</strong>
                <ul>
                    <li>構造情報の欠落（異性体を区別不可）</li>
                    <li>長距離相互作用の無視（3D配置が不明）</li>
                    <li>置換基の非対称性（鏡像異性体を区別不可）</li>
                </ul>
            </li>
            <li><strong>グラフ理論の基礎</strong>
                <ul>
                    <li>グラフ = 頂点 + 辺</li>
                    <li>隣接行列による数値表現</li>
                    <li>分子・結晶のグラフ表現</li>
                </ul>
            </li>
            <li><strong>GNNの利点</strong>
                <ul>
                    <li>End-to-Endの特徴量学習</li>
                    <li>転移学習（少ないデータで高精度）</li>
                    <li>解釈可能性（重要原子の特定）</li>
                </ul>
            </li>
            <li><strong>成功事例</strong>
                <ul>
                    <li>OC20（触媒、240万倍高速化）</li>
                    <li>QM9（分子特性、84-97%精度改善）</li>
                    <li>Materials Project（結晶、74%精度改善）</li>
                </ul>
            </li>
        </ol>

        <h3>重要なポイント</h3>
        <ul>
            <li>材料・分子は<strong>グラフ</strong>として表現できる</li>
            <li>グラフ表現は従来のベクトル表現より<strong>情報量が多い</strong></li>
            <li>GNNは<strong>構造を理解する</strong>AIである</li>
            <li>実世界で<strong>桁違いの高速化</strong>を実現</li>
            <li>化学・材料科学の<strong>標準ツール</strong>になりつつある</li>
        </ul>

        <div class="navigation">
            <a href="chapter-2.html" class="nav-button">次章: 第2章 GNNの基礎理論 →</a>
            <a href="index.html" class="nav-button">← シリーズ目次に戻る</a>
        </div>
    </main>

    <footer>
        <p><strong>作成者</strong>: AI Terakoya Content Team</p>
        <p><strong>監修</strong>: Dr. Yusuke Hashimoto（東北大学）</p>
        <p><strong>バージョン</strong>: 1.0 | <strong>作成日</strong>: 2025-10-17</p>
        <p><strong>ライセンス</strong>: Creative Commons BY 4.0</p>
        <p>© 2025 AI Terakoya. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mermaidCodeBlocks = document.querySelectorAll('pre.codehilite code.language-mermaid, pre code.language-mermaid');

            mermaidCodeBlocks.forEach(function(codeBlock) {
                const pre = codeBlock.parentElement;
                const mermaidCode = codeBlock.textContent;

                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode.trim();

                pre.parentNode.replaceChild(mermaidDiv, pre);
            });

            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'default'
                });
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }
        });
    </script>
</body>
</html>
